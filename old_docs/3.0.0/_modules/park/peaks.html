<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>park.peaks &mdash; SasView 3.0.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '3.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="SasView 3.0.0 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">SasView 3.0.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for park.peaks</h1><div class="highlight"><pre>
<span class="c"># This program is public domain</span>
<span class="sd">&quot;&quot;&quot;  </span>
<span class="sd">A park model implementing a multipeak fitter.</span>

<span class="sd">*** WARNING *** this example was used to inform the design process,</span>
<span class="sd">and has not yet been updated to correspond to the current implementation.</span>
<span class="sd">Do not use this as a tutorial.</span>

<span class="sd">This is an example model showing how to put together a multi-part</span>
<span class="sd">fit objective function.</span>

<span class="sd">:group main: Peaks</span>
<span class="sd">:group peaks: Gaussian, Lorentzian, Voigt</span>
<span class="sd">:group backgrounds: Constant, Quadratic, Linear</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">park</span>

<div class="viewcode-block" id="Peaks"><a class="viewcode-back" href="../../dev/api/park.html#park.peaks.Peaks">[docs]</a><span class="k">class</span> <span class="nc">Peaks</span><span class="p">(</span><span class="n">park</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot;Peak fitter&quot;&quot;&quot;</span>
    <span class="c"># Increment the minor version when adding new functions</span>
    <span class="c"># Increment the major version if refactoring the class</span>
    <span class="n">__version__</span> <span class="o">=</span> <span class="s">&quot;0.9&quot;</span>
    <span class="n">peak_types</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datafile</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new multipeak model.  If datafile is present it will</span>
<span class="sd">        be loaded directly.  If not, then it can be set later with</span>
<span class="sd">        self.data.load(datafile), or replaced with a specialized</span>
<span class="sd">        data loader for the particular instrument.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># The initializer creates self.parameterset which will hold</span>
        <span class="c"># the set of fitting parameters for all models.  It will also</span>
        <span class="c"># define self.data = park.data.Data1D() which computes the</span>
        <span class="c"># residuals given an eval function.</span>
        <span class="n">park</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">datafile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameterset</span> <span class="o">=</span> <span class="n">park</span><span class="o">.</span><span class="n">ParameterSet</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">peaknum</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="Peaks.eval"><a class="viewcode-back" href="../../dev/api/park.html#park.peaks.Peaks.eval">[docs]</a>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the raw theory value at x, unconvoluted and unweighted.</span>
<span class="sd">        </span>
<span class="sd">        The residuals will be calculated by park.Model.residuals by</span>
<span class="sd">        calling </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">peak</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="n">y</span> <span class="o">+=</span> <span class="n">peak</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">y</span>
        </div>
<div class="viewcode-block" id="Peaks.add_peak"><a class="viewcode-back" href="../../dev/api/park.html#park.peaks.Peaks.add_peak">[docs]</a>    <span class="k">def</span> <span class="nf">add_peak</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Add a peak to the model.</span>
<span class="sd">        </span>
<span class="sd">        The name of the peak is used to distinguish it from other peaks </span>
<span class="sd">        in the model, and appears as part of the parameter name in</span>
<span class="sd">        constraint expressions.  For example, if name is &#39;P3&#39; and this</span>
<span class="sd">        is part of model &#39;M1&#39; then the sigma parameter of a gaussian</span>
<span class="sd">        peak would be &#39;M1.P3.sigma&#39;.</span>

<span class="sd">        The peak can be specified either by peak type and initial arguments</span>
<span class="sd">        or by the peak itself, which is a function of x with a parameters </span>
<span class="sd">        attribute.</span>
<span class="sd">        </span>
<span class="sd">        Available peak types include:</span>
<span class="sd">            gaussian(scale=1, center=0, sigma=1) </span>
<span class="sd">                = scale exp ( -0.5 (x-center)**2 / sigma**2 )</span>
<span class="sd">            lorentzian(scale=1, center=0, gamma=1) </span>
<span class="sd">                = scale/pi gamma / ((x-center)**2 + gamma**2))</span>
<span class="sd">            voigt(scale=1, center=0, sigma=1, gamma=1)</span>
<span class="sd">                = scale (lorentzian(mu,gamma) * gaussian(mu,sigma))(x-center)</span>
<span class="sd">                where * represents convolution</span>
<span class="sd">        </span>
<span class="sd">        Available background functions include:</span>
<span class="sd">            constant(C=0)</span>
<span class="sd">                = C</span>
<span class="sd">            slope(C=0, B=1)</span>
<span class="sd">                = B x + C</span>
<span class="sd">            quadratic(A=1, B=0, C=0)</span>
<span class="sd">                = A x**2 + B x + C</span>

<span class="sd">        Additional peak types can be registered.  The complete dictionary</span>
<span class="sd">        of available types is in Peaks.peak_types.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">peaknum</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;P&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peaknum</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span><span class="nb">basestring</span><span class="p">):</span>
            <span class="n">peak</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peak_types</span><span class="p">[</span><span class="nb">type</span><span class="p">](</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="n">peak</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">peak</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">peak</span><span class="o">.</span><span class="n">parameters</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">peak</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Peaks.remove_peak"><a class="viewcode-back" href="../../dev/api/park.html#park.peaks.Peaks.remove_peak">[docs]</a>    <span class="k">def</span> <span class="nf">remove_peak</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove the named peak from the model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterset</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Peaks.register_peak_generator"><a class="viewcode-back" href="../../dev/api/park.html#park.peaks.Peaks.register_peak_generator">[docs]</a>    <span class="k">def</span> <span class="nf">register_peak_generator</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">factory</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Register a new peak generator.  This will return a callable</span>
<span class="sd">        object with a parameter set that can be used in the peak</span>
<span class="sd">        fitting class.</span>

<span class="sd">        The individual peak functions a number of attributes:</span>
<span class="sd">        </span>
<span class="sd">        __name__</span>
<span class="sd">            the name to be displayed in the list of peaks; the</span>
<span class="sd">            default is __class__.__name__</span>
<span class="sd">        __factory__</span>
<span class="sd">            the name of a factory function in the python</span>
<span class="sd">            namespace which returns a new peak.  These parameters</span>
<span class="sd">            will be set from the stored parameter list when the</span>
<span class="sd">            peak model is reloaded.  This can be omitted if it</span>
<span class="sd">            is simply the module and name of the class.</span>
<span class="sd">        __doc__</span>
<span class="sd">            the tool tip to be displayed with the peak</span>
<span class="sd">        __call__(x)</span>
<span class="sd">            evaluate the peak function at x</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">peak_types</span><span class="p">[</span><span class="nb">type</span><span class="p">]</span><span class="o">=</span><span class="n">factory</span>



<span class="c"># ================== Peaks and backgrounds ===================</span></div></div>
<div class="viewcode-block" id="Gaussian"><a class="viewcode-back" href="../../dev/api/park.html#park.peaks.Gaussian">[docs]</a><span class="k">class</span> <span class="nc">Gaussian</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Gaussian peak: scale exp ( -0.5 (x-center)**2 / sigma**2 )&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">park</span><span class="o">.</span><span class="n">define_parameters</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;scale&#39;</span><span class="p">,</span><span class="s">&#39;center&#39;</span><span class="p">,</span><span class="s">&#39;sigma&#39;</span><span class="p">],</span>
                               <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span><span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;scale&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">deriv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;center&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">deriv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dcenter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;sigma&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">deriv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dsigma</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<div class="viewcode-block" id="Gaussian.dscale"><a class="viewcode-back" href="../../dev/api/park.html#park.peaks.Gaussian.dscale">[docs]</a>    <span class="k">def</span> <span class="nf">dscale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span></div>
<div class="viewcode-block" id="Gaussian.dcenter"><a class="viewcode-back" href="../../dev/api/park.html#park.peaks.Gaussian.dcenter">[docs]</a>    <span class="k">def</span> <span class="nf">dcenter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="o">*</span><span class="bp">self</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>
<div class="viewcode-block" id="Gaussian.dsigma"><a class="viewcode-back" href="../../dev/api/park.html#park.peaks.Gaussian.dsigma">[docs]</a>    <span class="k">def</span> <span class="nf">dsigma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="Lorentzian"><a class="viewcode-back" href="../../dev/api/park.html#park.peaks.Lorentzian">[docs]</a><span class="k">class</span> <span class="nc">Lorentzian</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Lorentzian peak (HWHM): scale/pi  gamma/((x-center)**2 + gamma**2)&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">park</span><span class="o">.</span><span class="n">define_parameters</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;scale&#39;</span><span class="p">,</span><span class="s">&#39;center&#39;</span><span class="p">,</span><span class="s">&#39;gamma&#39;</span><span class="p">],</span>
                               <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span><span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">,</span><span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;scale&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">deriv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;center&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">deriv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dcenter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;gamma&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">deriv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dgamma</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="o">/</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<div class="viewcode-block" id="Lorentzian.dscale"><a class="viewcode-back" href="../../dev/api/park.html#park.peaks.Lorentzian.dscale">[docs]</a>    <span class="k">def</span> <span class="nf">dscale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span></div>
<div class="viewcode-block" id="Lorentzian.dcenter"><a class="viewcode-back" href="../../dev/api/park.html#park.peaks.Lorentzian.dcenter">[docs]</a>    <span class="k">def</span> <span class="nf">dcenter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>
<div class="viewcode-block" id="Lorentzian.dgamma"><a class="viewcode-back" href="../../dev/api/park.html#park.peaks.Lorentzian.dgamma">[docs]</a>    <span class="k">def</span> <span class="nf">dgamma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="o">/</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
</div></div>
<div class="viewcode-block" id="Voigt"><a class="viewcode-back" href="../../dev/api/park.html#park.peaks.Voigt">[docs]</a><span class="k">class</span> <span class="nc">Voigt</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Voigt peak (HWHM,sigma): A [G(sigma) * L(gamma)](x-center)&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">park</span><span class="o">.</span><span class="n">define_parameters</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;scale&#39;</span><span class="p">,</span><span class="s">&#39;center&#39;</span><span class="p">,</span><span class="s">&#39;sigma&#39;</span><span class="p">,</span><span class="s">&#39;gamma&#39;</span><span class="p">],</span>
                               <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span>
                               <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="o">*</span><span class="n">voigt</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">,</span> 
                                <span class="n">sigma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Quadratic"><a class="viewcode-back" href="../../dev/api/park.html#park.peaks.Quadratic">[docs]</a><span class="k">class</span> <span class="nc">Quadratic</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Quadratic background: A x**2 + B x + C&quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Background: quadratic&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">park</span><span class="o">.</span><span class="n">define_parameters</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="s">&#39;C&#39;</span><span class="p">],</span> <span class="n">A</span><span class="o">=</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">deriv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dA</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">deriv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dB</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;C&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">deriv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dC</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">polyval</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">value</span><span class="p">],</span><span class="n">x</span><span class="p">)</span>
<div class="viewcode-block" id="Quadratic.dA"><a class="viewcode-back" href="../../dev/api/park.html#park.peaks.Quadratic.dA">[docs]</a>    <span class="k">def</span> <span class="nf">dA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span></div>
<div class="viewcode-block" id="Quadratic.dB"><a class="viewcode-back" href="../../dev/api/park.html#park.peaks.Quadratic.dB">[docs]</a>    <span class="k">def</span> <span class="nf">dB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span></div>
<div class="viewcode-block" id="Quadratic.dC"><a class="viewcode-back" href="../../dev/api/park.html#park.peaks.Quadratic.dC">[docs]</a>    <span class="k">def</span> <span class="nf">dC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="Linear"><a class="viewcode-back" href="../../dev/api/park.html#park.peaks.Linear">[docs]</a><span class="k">class</span> <span class="nc">Linear</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Linear background: B x**2 + C&quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Background: linear&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">park</span><span class="o">.</span><span class="n">define_parameters</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="s">&#39;C&#39;</span><span class="p">],</span> <span class="n">B</span><span class="o">=</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">deriv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dB</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;C&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">deriv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dC</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">polyval</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">value</span><span class="p">],</span><span class="n">x</span><span class="p">)</span>
<div class="viewcode-block" id="Linear.dB"><a class="viewcode-back" href="../../dev/api/park.html#park.peaks.Linear.dB">[docs]</a>    <span class="k">def</span> <span class="nf">dB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span></div>
<div class="viewcode-block" id="Linear.dC"><a class="viewcode-back" href="../../dev/api/park.html#park.peaks.Linear.dC">[docs]</a>    <span class="k">def</span> <span class="nf">dC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="Constant"><a class="viewcode-back" href="../../dev/api/park.html#park.peaks.Constant">[docs]</a><span class="k">class</span> <span class="nc">Constant</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constant background: C&quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Background: constant&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">park</span><span class="o">.</span><span class="n">define_parameters</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;C&#39;</span><span class="p">],</span> <span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;C&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">deriv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dC</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">polyval</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">value</span><span class="p">],</span><span class="n">x</span><span class="p">)</span>
<div class="viewcode-block" id="Constant.dC"><a class="viewcode-back" href="../../dev/api/park.html#park.peaks.Constant.dC">[docs]</a>    <span class="k">def</span> <span class="nf">dC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="voigt"><a class="viewcode-back" href="../../dev/api/park.html#park.peaks.voigt">[docs]</a><span class="k">def</span> <span class="nf">voigt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the voigt function, which is the convolution of a Lorentz</span>
<span class="sd">    function with a Gaussian.</span>
<span class="sd">    </span>
<span class="sd">    :Parameters:</span>
<span class="sd">     gamma : real</span>
<span class="sd">      The half-width half-maximum of the Lorentzian</span>
<span class="sd">     sigma : real</span>
<span class="sd">      The 1-sigma width of the Gaussian, which is one standard deviation.</span>

<span class="sd">    Ref: W.I.F. David, J. Appl. Cryst. (1986). 19, 63-64</span>
<span class="sd">    </span>
<span class="sd">    Note: adjusted to use stddev and HWHM rather than FWHM parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># wofz function = w(z) = Fad[d][e][y]eva function = exp(-z**2)erfc(-iz)</span>
    <span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">wofz</span>
    <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">1j</span><span class="o">*</span><span class="n">gamma</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sigma</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">wofz</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">sigma</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">V</span><span class="o">.</span><span class="n">real</span>

</div>
<div class="viewcode-block" id="init"><a class="viewcode-back" href="../../dev/api/park.html#park.peaks.init">[docs]</a><span class="k">def</span> <span class="nf">init</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Register peak types with the Peaks model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">cls</span> <span class="ow">in</span> <span class="p">[</span><span class="n">Gaussian</span><span class="p">,</span> <span class="n">Lorentzian</span><span class="p">,</span> <span class="n">Voigt</span><span class="p">,</span> <span class="n">Quadratic</span><span class="p">,</span> <span class="n">Linear</span><span class="p">,</span> <span class="n">Constant</span><span class="p">]:</span>
        <span class="n">Peaks</span><span class="o">.</span><span class="n">register_peak_generator</span><span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span><span class="n">cls</span><span class="p">)</span></div>
<span class="n">init</span><span class="p">()</span>

<span class="c"># ========================================</span>

<div class="viewcode-block" id="test"><a class="viewcode-back" href="../../dev/api/park.html#park.peaks.test">[docs]</a><span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
    
    <span class="k">pass</span>
</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span> <span class="n">test</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">SasView 3.0.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, The SasView Project.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>