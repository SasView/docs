
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>sas.qtgui.Perspectives.Fitting.FittingWidget &#8212; SasView 5.0.1 documentation</title>
    <link rel="stylesheet" href="../../../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">SasView 5.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../../../sas.html" accesskey="U">sas</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for sas.qtgui.Perspectives.Fitting.FittingWidget</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>

<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">threads</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">webbrowser</span>

<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="kn">import</span> <span class="n">QtCore</span>
<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="kn">import</span> <span class="n">QtGui</span>
<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="kn">import</span> <span class="n">QtWidgets</span>

<span class="kn">from</span> <span class="nn">sasmodels</span> <span class="kn">import</span> <span class="n">generate</span>
<span class="kn">from</span> <span class="nn">sasmodels</span> <span class="kn">import</span> <span class="n">modelinfo</span>
<span class="kn">from</span> <span class="nn">sasmodels.sasview_model</span> <span class="kn">import</span> <span class="n">load_standard_models</span>
<span class="kn">from</span> <span class="nn">sasmodels.sasview_model</span> <span class="kn">import</span> <span class="n">MultiplicationModel</span>
<span class="kn">from</span> <span class="nn">sasmodels.weights</span> <span class="kn">import</span> <span class="n">MODELS</span> <span class="k">as</span> <span class="n">POLYDISPERSITY_MODELS</span>

<span class="kn">from</span> <span class="nn">sas.sascalc.fit.BumpsFitting</span> <span class="kn">import</span> <span class="n">BumpsFit</span> <span class="k">as</span> <span class="n">Fit</span>
<span class="kn">from</span> <span class="nn">sas.sascalc.fit.pagestate</span> <span class="kn">import</span> <span class="n">PageState</span>
<span class="kn">from</span> <span class="nn">sas.sascalc.fit</span> <span class="kn">import</span> <span class="n">models</span>

<span class="kn">import</span> <span class="nn">sas.qtgui.Utilities.GuiUtils</span> <span class="k">as</span> <span class="nn">GuiUtils</span>
<span class="kn">import</span> <span class="nn">sas.qtgui.Utilities.LocalConfig</span> <span class="k">as</span> <span class="nn">LocalConfig</span>
<span class="kn">from</span> <span class="nn">sas.qtgui.Utilities.CategoryInstaller</span> <span class="kn">import</span> <span class="n">CategoryInstaller</span>
<span class="kn">from</span> <span class="nn">sas.qtgui.Plotting.PlotterData</span> <span class="kn">import</span> <span class="n">Data1D</span>
<span class="kn">from</span> <span class="nn">sas.qtgui.Plotting.PlotterData</span> <span class="kn">import</span> <span class="n">Data2D</span>
<span class="kn">from</span> <span class="nn">sas.qtgui.Plotting.Plotter</span> <span class="kn">import</span> <span class="n">PlotterWidget</span>

<span class="kn">from</span> <span class="nn">sas.qtgui.Perspectives.Fitting.UI.FittingWidgetUI</span> <span class="kn">import</span> <span class="n">Ui_FittingWidgetUI</span>
<span class="kn">from</span> <span class="nn">sas.qtgui.Perspectives.Fitting.FitThread</span> <span class="kn">import</span> <span class="n">FitThread</span>
<span class="kn">from</span> <span class="nn">sas.qtgui.Perspectives.Fitting.ConsoleUpdate</span> <span class="kn">import</span> <span class="n">ConsoleUpdate</span>

<span class="kn">from</span> <span class="nn">sas.qtgui.Perspectives.Fitting.ModelThread</span> <span class="kn">import</span> <span class="n">Calc1D</span>
<span class="kn">from</span> <span class="nn">sas.qtgui.Perspectives.Fitting.ModelThread</span> <span class="kn">import</span> <span class="n">Calc2D</span>
<span class="kn">from</span> <span class="nn">sas.qtgui.Perspectives.Fitting.FittingLogic</span> <span class="kn">import</span> <span class="n">FittingLogic</span>
<span class="kn">from</span> <span class="nn">sas.qtgui.Perspectives.Fitting</span> <span class="kn">import</span> <span class="n">FittingUtilities</span>
<span class="kn">from</span> <span class="nn">sas.qtgui.Perspectives.Fitting.SmearingWidget</span> <span class="kn">import</span> <span class="n">SmearingWidget</span>
<span class="kn">from</span> <span class="nn">sas.qtgui.Perspectives.Fitting.OptionsWidget</span> <span class="kn">import</span> <span class="n">OptionsWidget</span>
<span class="kn">from</span> <span class="nn">sas.qtgui.Perspectives.Fitting.FitPage</span> <span class="kn">import</span> <span class="n">FitPage</span>
<span class="kn">from</span> <span class="nn">sas.qtgui.Perspectives.Fitting.ViewDelegate</span> <span class="kn">import</span> <span class="n">ModelViewDelegate</span>
<span class="kn">from</span> <span class="nn">sas.qtgui.Perspectives.Fitting.ViewDelegate</span> <span class="kn">import</span> <span class="n">PolyViewDelegate</span>
<span class="kn">from</span> <span class="nn">sas.qtgui.Perspectives.Fitting.ViewDelegate</span> <span class="kn">import</span> <span class="n">MagnetismViewDelegate</span>
<span class="kn">from</span> <span class="nn">sas.qtgui.Perspectives.Fitting.Constraint</span> <span class="kn">import</span> <span class="n">Constraint</span>
<span class="kn">from</span> <span class="nn">sas.qtgui.Perspectives.Fitting.MultiConstraint</span> <span class="kn">import</span> <span class="n">MultiConstraint</span>
<span class="kn">from</span> <span class="nn">sas.qtgui.Perspectives.Fitting.ReportPageLogic</span> <span class="kn">import</span> <span class="n">ReportPageLogic</span>
<span class="kn">from</span> <span class="nn">sas.qtgui.Perspectives.Fitting.OrderWidget</span> <span class="kn">import</span> <span class="n">OrderWidget</span>

<span class="n">TAB_MAGNETISM</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">TAB_POLY</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">TAB_ORDERING</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">CATEGORY_DEFAULT</span> <span class="o">=</span> <span class="s2">&quot;Choose category...&quot;</span>
<span class="n">MODEL_DEFAULT</span> <span class="o">=</span> <span class="s2">&quot;Choose model...&quot;</span>
<span class="n">CATEGORY_STRUCTURE</span> <span class="o">=</span> <span class="s2">&quot;Structure Factor&quot;</span>
<span class="n">CATEGORY_CUSTOM</span> <span class="o">=</span> <span class="s2">&quot;Plugin Models&quot;</span>
<span class="n">STRUCTURE_DEFAULT</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>

<span class="n">DEFAULT_POLYDISP_FUNCTION</span> <span class="o">=</span> <span class="s1">&#39;gaussian&#39;</span>

<span class="c1"># CRUFT: remove when new release of sasmodels is available</span>
<span class="c1"># https://github.com/SasView/sasview/pull/181#discussion_r218135162</span>
<span class="kn">from</span> <span class="nn">sasmodels.sasview_model</span> <span class="kn">import</span> <span class="n">SasviewModel</span>
<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">SasviewModel</span><span class="p">,</span> <span class="s1">&#39;get_weights&#39;</span><span class="p">):</span>
<div class="viewcode-block" id="get_weights"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.get_weights">[docs]</a>    <span class="k">def</span> <span class="nf">get_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the polydispersity distribution for parameter *name* as *value* and *weight* arrays.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># type: (str) -&gt; Tuple(np.ndarray, np.ndarray)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_weights</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_info</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">w</span></div>

    <span class="n">SasviewModel</span><span class="o">.</span><span class="n">get_weights</span> <span class="o">=</span> <span class="n">get_weights</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<div class="viewcode-block" id="ToolTippedItemModel"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.ToolTippedItemModel">[docs]</a><span class="k">class</span> <span class="nc">ToolTippedItemModel</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItemModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Subclass from QStandardItemModel to allow displaying tooltips in</span>
<span class="sd">    QTableView model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItemModel</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

<div class="viewcode-block" id="ToolTippedItemModel.headerData"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.ToolTippedItemModel.headerData">[docs]</a>    <span class="k">def</span> <span class="nf">headerData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section</span><span class="p">,</span> <span class="n">orientation</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displays tooltip for each column&#39;s header</span>
<span class="sd">        :param section:</span>
<span class="sd">        :param orientation:</span>
<span class="sd">        :param role:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ToolTipRole</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">orientation</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header_tooltips</span><span class="p">[</span><span class="n">section</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItemModel</span><span class="o">.</span><span class="n">headerData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section</span><span class="p">,</span> <span class="n">orientation</span><span class="p">,</span> <span class="n">role</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="FittingWidget"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget">[docs]</a><span class="k">class</span> <span class="nc">FittingWidget</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QWidget</span><span class="p">,</span> <span class="n">Ui_FittingWidgetUI</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main widget for selecting form and structure factor models</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">constraintAddedSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">newModelSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">()</span>
    <span class="n">fittingFinishedSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">tuple</span><span class="p">)</span>
    <span class="n">batchFittingFinishedSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">tuple</span><span class="p">)</span>
    <span class="n">Calc1DFinishedSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">Calc2DFinishedSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>

    <span class="n">MAGNETIC_MODELS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sphere&#39;</span><span class="p">,</span> <span class="s1">&#39;core_shell_sphere&#39;</span><span class="p">,</span> <span class="s1">&#39;core_multi_shell&#39;</span><span class="p">,</span> <span class="s1">&#39;cylinder&#39;</span><span class="p">,</span> <span class="s1">&#39;parallelepiped&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tab_id</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">FittingWidget</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Necessary globals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>

        <span class="c1"># Which tab is this widget displayed in?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tab_id</span> <span class="o">=</span> <span class="n">tab_id</span>

        <span class="kn">import</span> <span class="nn">sys</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">excepthook</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span>

        <span class="c1"># Globals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initializeGlobals</span><span class="p">()</span>

        <span class="c1"># data index for the batch set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Main Data[12]D holders</span>
        <span class="c1"># Logics.data contains a single Data1D/Data2D object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logic</span> <span class="o">=</span> <span class="p">[</span><span class="n">FittingLogic</span><span class="p">()]</span>

        <span class="c1"># Main GUI setup up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Fitting&quot;</span><span class="p">)</span>

        <span class="c1"># Set up tabs widgets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initializeWidgets</span><span class="p">()</span>

        <span class="c1"># Set up models and views</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initializeModels</span><span class="p">()</span>

        <span class="c1"># Defaults for the structure factors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setDefaultStructureCombo</span><span class="p">()</span>

        <span class="c1"># Make structure factor and model CBs disabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disableModelCombo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disableStructureCombo</span><span class="p">()</span>

        <span class="c1"># Generate the category list for display</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initializeCategoryCombo</span><span class="p">()</span>

        <span class="c1"># Initial control state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initializeControls</span><span class="p">()</span>

        <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>

        <span class="c1"># Connect signals to controls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initializeSignals</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

        <span class="c1"># New font to display angstrom symbol</span>
        <span class="n">new_font</span> <span class="o">=</span> <span class="s1">&#39;font-family: -apple-system, &quot;Helvetica Neue&quot;, &quot;Ubuntu&quot;;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_17</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="n">new_font</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_19</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="n">new_font</span><span class="p">)</span>

<div class="viewcode-block" id="FittingWidget.info"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">tb</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exception</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">tb</span><span class="p">)))</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">logic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># make sure the logic contains at least one element</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logic</span>
        <span class="c1"># logic connected to the currently shown data</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logic</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_index</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic</span><span class="o">.</span><span class="n">data</span>

    <span class="nd">@data</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; data setter &quot;&quot;&quot;</span>
        <span class="c1"># Value is either a list of indices for batch fitting or a simple index</span>
        <span class="c1"># for standard fitting. Assure we have a list, regardless.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_batch_fitting</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">)</span>

        <span class="c1"># Keep reference to all datasets for batch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_data</span> <span class="o">=</span> <span class="n">value</span>

        <span class="c1"># Create logics with data items</span>
        <span class="c1"># Logics.data contains only a single Data1D/Data2D object</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># single data logic is already defined, update data on it</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logic</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">dataFromItem</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># batch datasets</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logic</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">data_item</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">logic</span> <span class="o">=</span> <span class="n">FittingLogic</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">GuiUtils</span><span class="o">.</span><span class="n">dataFromItem</span><span class="p">(</span><span class="n">data_item</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logic</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">logic</span><span class="p">)</span>
            <span class="c1"># update the ordering tab</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">order_widget</span><span class="o">.</span><span class="n">updateData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_data</span><span class="p">)</span>

        <span class="c1"># Overwrite data type descriptor</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">is2D</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logic</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">Data2D</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span>

        <span class="c1"># Let others know we&#39;re full of data now</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_is_loaded</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Enable/disable UI components</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setEnablementOnDataLoad</span><span class="p">()</span>

<div class="viewcode-block" id="FittingWidget.initializeGlobals"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.initializeGlobals">[docs]</a>    <span class="k">def</span> <span class="nf">initializeGlobals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize global variables used in this class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># SasModel is loaded</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_is_loaded</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Data[12]D passed and set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_is_loaded</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Batch/single fitting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_batch_fitting</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_chain_fitting</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Is the fit job running?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_started</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># The current fit thread</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calc_fit</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Current SasModel in view</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Current SasModel view dimension</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is2D</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Current SasModel is multishell</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_has_shells</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Utility variable to enable unselectable option in category combobox</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_previous_category_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Utility variables for multishell display</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_shells_row</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_shell_params</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Dictionary of {model name: model class} for the current category</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Parameters to fit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_params_to_fit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poly_params_to_fit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">magnet_params_to_fit</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Fit options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q_range_min</span> <span class="o">=</span> <span class="n">OptionsWidget</span><span class="o">.</span><span class="n">QMIN_DEFAULT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q_range_max</span> <span class="o">=</span> <span class="n">OptionsWidget</span><span class="o">.</span><span class="n">QMAX_DEFAULT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">npts</span> <span class="o">=</span> <span class="n">OptionsWidget</span><span class="o">.</span><span class="n">NPTS_DEFAULT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_points</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weighting</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chi2</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Does the control support UNDO/REDO</span>
        <span class="c1"># temporarily off</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">undo_supported</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">page_stack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># custom plugin models</span>
        <span class="c1"># {model.name:model}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom_models</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">customModels</span><span class="p">()</span>
        <span class="c1"># Polydisp widget table default index for function combobox</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orig_poly_index</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="c1"># copy of current kernel model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module_copy</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># dictionaries of current params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poly_params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">magnet_params</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Page id for fitting</span>
        <span class="c1"># To keep with previous SasView values, use 200 as the start offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">page_id</span> <span class="o">=</span> <span class="mi">200</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tab_id</span>

        <span class="c1"># Data for chosen model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_previous_model_index</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Which shell is being currently displayed?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_shell_displayed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># List of all shell-unique parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shell_names</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Error column presence in parameter display</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_error_column</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_poly_error_column</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_magnet_error_column</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Enablement of comboboxes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enabled_cbmodel</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enabled_sfmodel</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># If the widget generated theory item, save it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theory_item</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># list column widths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lstParamHeaderSizes</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Fitting just ran - don&#39;t recalculate chi2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitResults</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># signal communicator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">communicate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">communicate</span></div>

<div class="viewcode-block" id="FittingWidget.initializeWidgets"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.initializeWidgets">[docs]</a>    <span class="k">def</span> <span class="nf">initializeWidgets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize widgets for tabs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Options widget</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options_widget</span> <span class="o">=</span> <span class="n">OptionsWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options_widget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabOptions</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>

        <span class="c1"># Smearing widget</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smearing_widget</span> <span class="o">=</span> <span class="n">SmearingWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smearing_widget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabResolution</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>

        <span class="c1"># Order widget</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">()</span>
        <span class="c1"># pass all data items to access multiple datasets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">order_widget</span> <span class="o">=</span> <span class="n">OrderWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_data</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">order_widget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabOrder</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>

        <span class="c1"># Define bold font for use in various controls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boldFont</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFont</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boldFont</span><span class="o">.</span><span class="n">setBold</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Set data label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boldFont</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;No data loaded&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lblFilename</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Magnetic angles explained in one picture</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">magneticAnglesWidget</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QWidget</span><span class="p">()</span>
        <span class="n">labl</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">magneticAnglesWidget</span><span class="p">)</span>
        <span class="n">pixmap</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPixmap</span><span class="p">(</span><span class="n">GuiUtils</span><span class="o">.</span><span class="n">IMAGES_DIRECTORY_LOCATION</span> <span class="o">+</span> <span class="s1">&#39;/M_angles_pic.png&#39;</span><span class="p">)</span>
        <span class="n">labl</span><span class="o">.</span><span class="n">setPixmap</span><span class="p">(</span><span class="n">pixmap</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">magneticAnglesWidget</span><span class="o">.</span><span class="n">setFixedSize</span><span class="p">(</span><span class="n">pixmap</span><span class="o">.</span><span class="n">width</span><span class="p">(),</span> <span class="n">pixmap</span><span class="o">.</span><span class="n">height</span><span class="p">())</span></div>

<div class="viewcode-block" id="FittingWidget.initializeModels"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.initializeModels">[docs]</a>    <span class="k">def</span> <span class="nf">initializeModels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set up models and views</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Set the main models</span>
        <span class="c1"># We can&#39;t use a single model here, due to restrictions on flattening</span>
        <span class="c1"># the model tree with subclassed QAbstractProxyModel...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span> <span class="o">=</span> <span class="n">ToolTippedItemModel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span> <span class="o">=</span> <span class="n">ToolTippedItemModel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span> <span class="o">=</span> <span class="n">ToolTippedItemModel</span><span class="p">()</span>

        <span class="c1"># Param model displayed in param list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readCategoryInfo</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Delegates for custom editing and display</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">setItemDelegate</span><span class="p">(</span><span class="n">ModelViewDelegate</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">setAlternatingRowColors</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">stylesheet</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>

<span class="s2">            QTreeView {</span>
<span class="s2">                paint-alternating-row-colors-for-empty-area:0;</span>
<span class="s2">            }</span>

<span class="s2">            QTreeView::item {</span>
<span class="s2">                border: 1px;</span>
<span class="s2">                padding: 2px 1px;</span>
<span class="s2">            }</span>

<span class="s2">            QTreeView::item:hover {</span>
<span class="s2">                background: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #e7effd, stop: 1 #cbdaf1);</span>
<span class="s2">                border: 1px solid #bfcde4;</span>
<span class="s2">            }</span>

<span class="s2">            QTreeView::item:selected {</span>
<span class="s2">                border: 1px solid #567dbc;</span>
<span class="s2">            }</span>

<span class="s2">            QTreeView::item:selected:active{</span>
<span class="s2">                background: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #6ea1f1, stop: 1 #567dbc);</span>
<span class="s2">            }</span>

<span class="s2">            QTreeView::item:selected:!active {</span>
<span class="s2">                background: qlineargradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #6b9be8, stop: 1 #577fbf);</span>
<span class="s2">            }</span>
<span class="s2">           &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="n">stylesheet</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">setContextMenuPolicy</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CustomContextMenu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">customContextMenuRequested</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">showModelContextMenu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">WA_MacShowFocusRect</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="c1"># Column resize signals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">header</span><span class="p">()</span><span class="o">.</span><span class="n">sectionResized</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onColumnWidthUpdate</span><span class="p">)</span>

        <span class="c1"># Poly model displayed in poly list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lstPoly</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setPolyModel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setTableProperties</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lstPoly</span><span class="p">)</span>
        <span class="c1"># Delegates for custom editing and display</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lstPoly</span><span class="o">.</span><span class="n">setItemDelegate</span><span class="p">(</span><span class="n">PolyViewDelegate</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="c1"># Polydispersity function combo response</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lstPoly</span><span class="o">.</span><span class="n">itemDelegate</span><span class="p">()</span><span class="o">.</span><span class="n">combo_updated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onPolyComboIndexChange</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lstPoly</span><span class="o">.</span><span class="n">itemDelegate</span><span class="p">()</span><span class="o">.</span><span class="n">filename_updated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onPolyFilenameChange</span><span class="p">)</span>

        <span class="c1"># Magnetism model displayed in magnetism list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lstMagnetic</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMagneticModel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setTableProperties</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lstMagnetic</span><span class="p">)</span>
        <span class="c1"># Delegates for custom editing and display</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lstMagnetic</span><span class="o">.</span><span class="n">setItemDelegate</span><span class="p">(</span><span class="n">MagnetismViewDelegate</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="c1"># Initial status of the ordering tab - invisible</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabFitting</span><span class="o">.</span><span class="n">removeTab</span><span class="p">(</span><span class="n">TAB_ORDERING</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.initializeCategoryCombo"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.initializeCategoryCombo">[docs]</a>    <span class="k">def</span> <span class="nf">initializeCategoryCombo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Model category combo setup</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">category_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">master_category_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbCategory</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">CATEGORY_DEFAULT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbCategory</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="n">category_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">CATEGORY_STRUCTURE</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">category_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbCategory</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">CATEGORY_STRUCTURE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbCategory</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.setEnablementOnDataLoad"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.setEnablementOnDataLoad">[docs]</a>    <span class="k">def</span> <span class="nf">setEnablementOnDataLoad</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable/disable various UI elements based on data loaded</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Tag along functionality</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Data loaded from: &quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">filename</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblFilename</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logic</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblFilename</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logic</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateQRange</span><span class="p">()</span>
        <span class="c1"># Switch off Data2D control</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chk2DView</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chk2DView</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chkMagnetism</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabFitting</span><span class="o">.</span><span class="n">setTabEnabled</span><span class="p">(</span><span class="n">TAB_MAGNETISM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">chkMagnetism</span><span class="o">.</span><span class="n">isChecked</span><span class="p">())</span>
        <span class="c1"># Combo box or label for file name&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_batch_fitting</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblFilename</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">dataitem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_data</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">dataFromItem</span><span class="p">(</span><span class="n">dataitem</span><span class="p">)</span><span class="o">.</span><span class="n">filename</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cbFileNames</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbFileNames</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chkChainFit</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chkChainFit</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># This panel is not designed to view individual fits, so disable plotting</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmdPlot</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># Similarly on other tabs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options_widget</span><span class="o">.</span><span class="n">setEnablementOnDataLoad</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onSelectModel</span><span class="p">()</span>
        <span class="c1"># Smearing tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smearing_widget</span><span class="o">.</span><span class="n">updateData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.acceptsData"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.acceptsData">[docs]</a>    <span class="k">def</span> <span class="nf">acceptsData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Tells the caller this widget can accept new dataset &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_is_loaded</span></div>

<div class="viewcode-block" id="FittingWidget.disableModelCombo"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.disableModelCombo">[docs]</a>    <span class="k">def</span> <span class="nf">disableModelCombo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Disable the combobox &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lblModel</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enabled_cbmodel</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="FittingWidget.enableModelCombo"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.enableModelCombo">[docs]</a>    <span class="k">def</span> <span class="nf">enableModelCombo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Enable the combobox &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lblModel</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enabled_cbmodel</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="FittingWidget.disableStructureCombo"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.disableStructureCombo">[docs]</a>    <span class="k">def</span> <span class="nf">disableStructureCombo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Disable the combobox &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbStructureFactor</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lblStructure</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enabled_sfmodel</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="FittingWidget.enableStructureCombo"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.enableStructureCombo">[docs]</a>    <span class="k">def</span> <span class="nf">enableStructureCombo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Enable the combobox &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbStructureFactor</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lblStructure</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enabled_sfmodel</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="FittingWidget.togglePoly"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.togglePoly">[docs]</a>    <span class="k">def</span> <span class="nf">togglePoly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">isChecked</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Enable/disable the polydispersity tab &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabFitting</span><span class="o">.</span><span class="n">setTabEnabled</span><span class="p">(</span><span class="n">TAB_POLY</span><span class="p">,</span> <span class="n">isChecked</span><span class="p">)</span>
        <span class="c1"># Check if any parameters are ready for fitting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdFit</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">haveParamsToFit</span><span class="p">())</span></div>

<div class="viewcode-block" id="FittingWidget.toggleMagnetism"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.toggleMagnetism">[docs]</a>    <span class="k">def</span> <span class="nf">toggleMagnetism</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">isChecked</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Enable/disable the magnetism tab &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabFitting</span><span class="o">.</span><span class="n">setTabEnabled</span><span class="p">(</span><span class="n">TAB_MAGNETISM</span><span class="p">,</span> <span class="n">isChecked</span><span class="p">)</span>
        <span class="c1"># Check if any parameters are ready for fitting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdFit</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">haveParamsToFit</span><span class="p">())</span></div>

<div class="viewcode-block" id="FittingWidget.toggleChainFit"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.toggleChainFit">[docs]</a>    <span class="k">def</span> <span class="nf">toggleChainFit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">isChecked</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Enable/disable chain fitting &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_chain_fitting</span> <span class="o">=</span> <span class="n">isChecked</span>
        <span class="c1"># show/hide the ordering tab</span>
        <span class="k">if</span> <span class="n">isChecked</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tabFitting</span><span class="o">.</span><span class="n">insertTab</span><span class="p">(</span><span class="n">TAB_ORDERING</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tabOrder</span><span class="p">,</span> <span class="s2">&quot;Order&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tabFitting</span><span class="o">.</span><span class="n">removeTab</span><span class="p">(</span><span class="n">TAB_ORDERING</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.toggle2D"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.toggle2D">[docs]</a>    <span class="k">def</span> <span class="nf">toggle2D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">isChecked</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Enable/disable the controls dependent on 1D/2D data instance &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chkMagnetism</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">isChecked</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is2D</span> <span class="o">=</span> <span class="n">isChecked</span>
        <span class="c1"># Reload the current model</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onSelectModel</span><span class="p">()</span></div>

<div class="viewcode-block" id="FittingWidget.customModels"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.customModels">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">customModels</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Reads in file names in the custom plugin directory &quot;&quot;&quot;</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ModelManager</span><span class="p">()</span>
        <span class="c1"># TODO: Cache plugin models instead of scanning the directory each time.</span>
        <span class="n">manager</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="c1"># TODO: Define plugin_models property in ModelManager.</span>
        <span class="k">return</span> <span class="n">manager</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">plugin_models</span></div>

<div class="viewcode-block" id="FittingWidget.initializeControls"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.initializeControls">[docs]</a>    <span class="k">def</span> <span class="nf">initializeControls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set initial control enablement</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbFileNames</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdFit</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdPlot</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chkPolydispersity</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chkPolydispersity</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chk2DView</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chk2DView</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chkMagnetism</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chkMagnetism</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chkChainFit</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chkChainFit</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># Tabs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabFitting</span><span class="o">.</span><span class="n">setTabEnabled</span><span class="p">(</span><span class="n">TAB_POLY</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabFitting</span><span class="o">.</span><span class="n">setTabEnabled</span><span class="p">(</span><span class="n">TAB_MAGNETISM</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lblChi2Value</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;---&quot;</span><span class="p">)</span>
        <span class="c1"># Smearing tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smearing_widget</span><span class="o">.</span><span class="n">updateData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="c1"># Line edits in the option tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateQRange</span><span class="p">()</span></div>

<div class="viewcode-block" id="FittingWidget.initializeSignals"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.initializeSignals">[docs]</a>    <span class="k">def</span> <span class="nf">initializeSignals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connect GUI element signals</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Comboboxes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbStructureFactor</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onSelectStructureFactor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbCategory</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onSelectCategory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onSelectModel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbFileNames</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onSelectBatchFilename</span><span class="p">)</span>
        <span class="c1"># Checkboxes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chk2DView</span><span class="o">.</span><span class="n">toggled</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle2D</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chkPolydispersity</span><span class="o">.</span><span class="n">toggled</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">togglePoly</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chkMagnetism</span><span class="o">.</span><span class="n">toggled</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggleMagnetism</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chkChainFit</span><span class="o">.</span><span class="n">toggled</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggleChainFit</span><span class="p">)</span>
        <span class="c1"># Buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdFit</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onFit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdPlot</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onPlot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdHelp</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onHelp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdMagneticDisplay</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onDisplayMagneticAngles</span><span class="p">)</span>

        <span class="c1"># Respond to change in parameters from the UI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">dataChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onMainParamsChange</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">dataChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onPolyModelChange</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="o">.</span><span class="n">dataChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onMagnetModelChange</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">selectionModel</span><span class="p">()</span><span class="o">.</span><span class="n">selectionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onSelectionChanged</span><span class="p">)</span>

        <span class="c1"># Local signals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batchFittingFinishedSignal</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batchFitComplete</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fittingFinishedSignal</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fitComplete</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Calc1DFinishedSignal</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">complete1D</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Calc2DFinishedSignal</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">complete2D</span><span class="p">)</span>

        <span class="c1"># Signals from separate tabs asking for replot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options_widget</span><span class="o">.</span><span class="n">plot_signal</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onOptionsUpdate</span><span class="p">)</span>

        <span class="c1"># Signals from other widgets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">communicate</span><span class="o">.</span><span class="n">customModelDirectoryChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onCustomModelChange</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smearing_widget</span><span class="o">.</span><span class="n">smearingChangedSignal</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onSmearingOptionsUpdate</span><span class="p">)</span>

        <span class="c1"># Communicator signal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">communicate</span><span class="o">.</span><span class="n">updateModelCategoriesSignal</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onCategoriesChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">communicate</span><span class="o">.</span><span class="n">updateMaskedDataSignal</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onMaskedData</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.modelName"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.modelName">[docs]</a>    <span class="k">def</span> <span class="nf">modelName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns model name, by default M&lt;tab#&gt;, e.g. M1, M2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;M</span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">tab_id</span></div>

<div class="viewcode-block" id="FittingWidget.nameForFittedData"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.nameForFittedData">[docs]</a>    <span class="k">def</span> <span class="nf">nameForFittedData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate name for the current fit</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is2D</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">+=</span> <span class="s2">&quot;2d&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modelName</span><span class="p">(),</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">name</span></div>

<div class="viewcode-block" id="FittingWidget.showModelContextMenu"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.showModelContextMenu">[docs]</a>    <span class="k">def</span> <span class="nf">showModelContextMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Show context specific menu in the parameter table.</span>
<span class="sd">        When clicked on parameter(s): fitting/constraints options</span>
<span class="sd">        When clicked on white space: model description</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">row</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">selectionModel</span><span class="p">()</span><span class="o">.</span><span class="n">selectedRows</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isCheckable</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">row</span><span class="p">())]</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">showModelDescription</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">rows</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelContextMenu</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">menu</span><span class="o">.</span><span class="n">exec_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">viewport</span><span class="p">()</span><span class="o">.</span><span class="n">mapToGlobal</span><span class="p">(</span><span class="n">position</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error generating context menu: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ex</span><span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="FittingWidget.modelContextMenu"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.modelContextMenu">[docs]</a>    <span class="k">def</span> <span class="nf">modelContextMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rows</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create context menu for the parameter selection</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMenu</span><span class="p">()</span>
        <span class="n">num_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num_rows</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">menu</span>
        <span class="c1"># Select for fitting</span>
        <span class="n">param_string</span> <span class="o">=</span> <span class="s2">&quot;parameter &quot;</span> <span class="k">if</span> <span class="n">num_rows</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;parameters &quot;</span>
        <span class="n">to_string</span> <span class="o">=</span> <span class="s2">&quot;to its current value&quot;</span> <span class="k">if</span> <span class="n">num_rows</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;to their current values&quot;</span>
        <span class="n">has_constraints</span> <span class="o">=</span> <span class="nb">any</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">rowHasConstraint</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">])</span>
        <span class="n">has_real_constraints</span> <span class="o">=</span> <span class="nb">any</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">rowHasActiveConstraint</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">actionSelect</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionSelect</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;actionSelect&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionSelect</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;self&quot;</span><span class="p">,</span> <span class="s2">&quot;Select &quot;</span><span class="o">+</span><span class="n">param_string</span><span class="o">+</span><span class="s2">&quot; for fitting&quot;</span><span class="p">))</span>
        <span class="c1"># Unselect from fitting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionDeselect</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionDeselect</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;actionDeselect&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionDeselect</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;self&quot;</span><span class="p">,</span> <span class="s2">&quot;De-select &quot;</span><span class="o">+</span><span class="n">param_string</span><span class="o">+</span><span class="s2">&quot; from fitting&quot;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">actionConstrain</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionConstrain</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;actionConstrain&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionConstrain</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;self&quot;</span><span class="p">,</span> <span class="s2">&quot;Constrain &quot;</span><span class="o">+</span><span class="n">param_string</span> <span class="o">+</span> <span class="n">to_string</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">actionRemoveConstraint</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionRemoveConstraint</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;actionRemoveConstrain&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionRemoveConstraint</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;self&quot;</span><span class="p">,</span> <span class="s2">&quot;Remove constraint&quot;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">actionEditConstraint</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionEditConstraint</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;actionEditConstrain&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionEditConstraint</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;self&quot;</span><span class="p">,</span> <span class="s2">&quot;Edit constraint&quot;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">actionMultiConstrain</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionMultiConstrain</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;actionMultiConstrain&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionMultiConstrain</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;self&quot;</span><span class="p">,</span> <span class="s2">&quot;Constrain selected parameters to their current values&quot;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">actionMutualMultiConstrain</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionMutualMultiConstrain</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;actionMutualMultiConstrain&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionMutualMultiConstrain</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;self&quot;</span><span class="p">,</span> <span class="s2">&quot;Mutual constrain of selected parameters...&quot;</span><span class="p">))</span>

        <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actionSelect</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actionDeselect</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">has_constraints</span><span class="p">:</span>
            <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actionRemoveConstraint</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">num_rows</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">has_real_constraints</span><span class="p">:</span>
                <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actionEditConstraint</span><span class="p">)</span>
            <span class="c1">#if num_rows == 1:</span>
            <span class="c1">#    menu.addAction(self.actionEditConstraint)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actionConstrain</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">num_rows</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actionMutualMultiConstrain</span><span class="p">)</span>

        <span class="c1"># Define the callbacks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionConstrain</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addSimpleConstraint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionRemoveConstraint</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deleteConstraint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionEditConstraint</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editConstraint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionMutualMultiConstrain</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">showMultiConstraint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionSelect</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selectParameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionDeselect</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deselectParameters</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">menu</span></div>

<div class="viewcode-block" id="FittingWidget.showMultiConstraint"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.showMultiConstraint">[docs]</a>    <span class="k">def</span> <span class="nf">showMultiConstraint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Show the constraint widget and receive the expression</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selected_rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">selectionModel</span><span class="p">()</span><span class="o">.</span><span class="n">selectedRows</span><span class="p">()</span>
        <span class="c1"># There have to be only two rows selected. The caller takes care of that</span>
        <span class="c1"># but let&#39;s check the correctness.</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_rows</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>

        <span class="n">params_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">data</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">selected_rows</span><span class="p">]</span>
        <span class="c1"># Create and display the widget for param1 and param2</span>
        <span class="n">mc_widget</span> <span class="o">=</span> <span class="n">MultiConstraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params_list</span><span class="p">)</span>
        <span class="c1"># Check if any of the parameters are polydisperse</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span><span class="n">FittingUtilities</span><span class="o">.</span><span class="n">isParamPolydisperse</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">,</span> <span class="n">is2D</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is2D</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params_list</span><span class="p">]):</span>
            <span class="c1"># no parameters are pd - reset the text to not show the warning</span>
            <span class="n">mc_widget</span><span class="o">.</span><span class="n">lblWarning</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mc_widget</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span> <span class="o">!=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QDialog</span><span class="o">.</span><span class="n">Accepted</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">constraint</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">()</span>
        <span class="n">c_text</span> <span class="o">=</span> <span class="n">mc_widget</span><span class="o">.</span><span class="n">txtConstraint</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="c1"># widget.params[0] is the parameter we&#39;re constraining</span>
        <span class="n">constraint</span><span class="o">.</span><span class="n">param</span> <span class="o">=</span> <span class="n">mc_widget</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># parameter should have the model name preamble</span>
        <span class="n">model_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">name</span>
        <span class="c1"># param_used is the parameter we&#39;re using in constraining function</span>
        <span class="n">param_used</span> <span class="o">=</span> <span class="n">mc_widget</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Replace param_used with model_name.param_used</span>
        <span class="n">updated_param_used</span> <span class="o">=</span> <span class="n">model_name</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">param_used</span>
        <span class="n">new_func</span> <span class="o">=</span> <span class="n">c_text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">param_used</span><span class="p">,</span> <span class="n">updated_param_used</span><span class="p">)</span>
        <span class="n">constraint</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">new_func</span>
        <span class="n">constraint</span><span class="o">.</span><span class="n">value_ex</span> <span class="o">=</span> <span class="n">updated_param_used</span>
        <span class="c1"># Which row is the constrained parameter in?</span>
        <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRowFromName</span><span class="p">(</span><span class="n">constraint</span><span class="o">.</span><span class="n">param</span><span class="p">)</span>

        <span class="c1"># what is the parameter to constraint to?</span>
        <span class="n">constraint</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">param_used</span>

        <span class="c1"># Should the new constraint be validated?</span>
        <span class="n">constraint</span><span class="o">.</span><span class="n">validate</span> <span class="o">=</span> <span class="n">mc_widget</span><span class="o">.</span><span class="n">validate</span>

        <span class="c1"># Create a new item and add the Constraint object as a child</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addConstraintToRow</span><span class="p">(</span><span class="n">constraint</span><span class="o">=</span><span class="n">constraint</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.getRowFromName"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.getRowFromName">[docs]</a>    <span class="k">def</span> <span class="nf">getRowFromName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given parameter name get the row number in self._model_model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="n">row_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">row_name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">row</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FittingWidget.getParamNames"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.getParamNames">[docs]</a>    <span class="k">def</span> <span class="nf">getParamNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return list of all parameters for the current model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">rowCount</span><span class="p">())</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isCheckable</span><span class="p">(</span><span class="n">row</span><span class="p">)]</span></div>

<div class="viewcode-block" id="FittingWidget.modifyViewOnRow"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.modifyViewOnRow">[docs]</a>    <span class="k">def</span> <span class="nf">modifyViewOnRow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">brush</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change how the given row of the main model is shown</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fields_enabled</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">font</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">font</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFont</span><span class="p">()</span>
            <span class="n">fields_enabled</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">brush</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">brush</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QBrush</span><span class="p">()</span>
            <span class="n">fields_enabled</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Modify font and foreground of affected rows</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">columnCount</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span><span class="o">.</span><span class="n">setForeground</span><span class="p">(</span><span class="n">brush</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span><span class="o">.</span><span class="n">setEditable</span><span class="p">(</span><span class="n">fields_enabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.addConstraintToRow"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.addConstraintToRow">[docs]</a>    <span class="k">def</span> <span class="nf">addConstraintToRow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constraint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds the constraint object to requested row</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create a new item and add the Constraint object as a child</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">constraint</span><span class="p">,</span> <span class="n">Constraint</span><span class="p">)</span>
        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">row</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">isCheckable</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

        <span class="n">item</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">()</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">constraint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">setChild</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="c1"># Set min/max to the value constrained</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constraintAddedSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">([</span><span class="n">row</span><span class="p">])</span>
        <span class="c1"># Show visual hints for the constraint</span>
        <span class="n">font</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFont</span><span class="p">()</span>
        <span class="n">font</span><span class="o">.</span><span class="n">setItalic</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">brush</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QBrush</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QColor</span><span class="p">(</span><span class="s1">&#39;blue&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modifyViewOnRow</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">,</span> <span class="n">brush</span><span class="o">=</span><span class="n">brush</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">communicate</span><span class="o">.</span><span class="n">statusBarUpdateSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s1">&#39;Constraint added&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.addSimpleConstraint"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.addSimpleConstraint">[docs]</a>    <span class="k">def</span> <span class="nf">addSimpleConstraint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a constraint on a single parameter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">min_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">itemDelegate</span><span class="p">()</span><span class="o">.</span><span class="n">param_min</span>
        <span class="n">max_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">itemDelegate</span><span class="p">()</span><span class="o">.</span><span class="n">param_max</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedParameters</span><span class="p">():</span>
            <span class="k">assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">isCheckable</span><span class="p">(</span><span class="n">row</span><span class="p">))</span>
            <span class="n">param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">min_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">min_col</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">max_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">max_col</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="c1"># Create a Constraint object</span>
            <span class="n">constraint</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="n">param</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">min_t</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max_t</span><span class="p">)</span>
            <span class="c1"># Create a new item and add the Constraint object as a child</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">()</span>
            <span class="n">item</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">constraint</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">setChild</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
            <span class="c1"># Assumed correctness from the validator</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="c1"># BUMPS calculates log(max-min) without any checks, so let&#39;s assign minor range</span>
            <span class="n">min_v</span> <span class="o">=</span> <span class="n">value</span> <span class="o">-</span> <span class="p">(</span><span class="n">value</span><span class="o">/</span><span class="mf">10000.0</span><span class="p">)</span>
            <span class="n">max_v</span> <span class="o">=</span> <span class="n">value</span> <span class="o">+</span> <span class="p">(</span><span class="n">value</span><span class="o">/</span><span class="mf">10000.0</span><span class="p">)</span>
            <span class="c1"># Set min/max to the value constrained</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">min_col</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">min_v</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">max_col</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">max_v</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">constraintAddedSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">([</span><span class="n">row</span><span class="p">])</span>
            <span class="c1"># Show visual hints for the constraint</span>
            <span class="n">font</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFont</span><span class="p">()</span>
            <span class="n">font</span><span class="o">.</span><span class="n">setItalic</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">brush</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QBrush</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QColor</span><span class="p">(</span><span class="s1">&#39;blue&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modifyViewOnRow</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">,</span> <span class="n">brush</span><span class="o">=</span><span class="n">brush</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">communicate</span><span class="o">.</span><span class="n">statusBarUpdateSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s1">&#39;Constraint added&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.editConstraint"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.editConstraint">[docs]</a>    <span class="k">def</span> <span class="nf">editConstraint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete constraints from selected parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">data</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">selectionModel</span><span class="p">()</span><span class="o">.</span><span class="n">selectedRows</span><span class="p">()</span>
                   <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isCheckable</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">row</span><span class="p">())]</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">params_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">selectionModel</span><span class="p">()</span><span class="o">.</span><span class="n">selectedRows</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="n">constraint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConstraintForRow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="c1"># Create and display the widget for param1 and param2</span>
        <span class="n">mc_widget</span> <span class="o">=</span> <span class="n">MultiConstraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params_list</span><span class="p">,</span> <span class="n">constraint</span><span class="o">=</span><span class="n">constraint</span><span class="p">)</span>
        <span class="c1"># Check if any of the parameters are polydisperse</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span><span class="n">FittingUtilities</span><span class="o">.</span><span class="n">isParamPolydisperse</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">,</span> <span class="n">is2D</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is2D</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params_list</span><span class="p">]):</span>
            <span class="c1"># no parameters are pd - reset the text to not show the warning</span>
            <span class="n">mc_widget</span><span class="o">.</span><span class="n">lblWarning</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mc_widget</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span> <span class="o">!=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QDialog</span><span class="o">.</span><span class="n">Accepted</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">constraint</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">()</span>
        <span class="n">c_text</span> <span class="o">=</span> <span class="n">mc_widget</span><span class="o">.</span><span class="n">txtConstraint</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="c1"># widget.params[0] is the parameter we&#39;re constraining</span>
        <span class="n">constraint</span><span class="o">.</span><span class="n">param</span> <span class="o">=</span> <span class="n">mc_widget</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># parameter should have the model name preamble</span>
        <span class="n">model_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">name</span>
        <span class="c1"># param_used is the parameter we&#39;re using in constraining function</span>
        <span class="n">param_used</span> <span class="o">=</span> <span class="n">mc_widget</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Replace param_used with model_name.param_used</span>
        <span class="n">updated_param_used</span> <span class="o">=</span> <span class="n">model_name</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">param_used</span>
        <span class="c1"># Update constraint with new values</span>
        <span class="n">constraint</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">c_text</span>
        <span class="n">constraint</span><span class="o">.</span><span class="n">value_ex</span> <span class="o">=</span> <span class="n">updated_param_used</span>
        <span class="n">constraint</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">param_used</span>
        <span class="c1"># Should the new constraint be validated?</span>
        <span class="n">constraint</span><span class="o">.</span><span class="n">validate</span> <span class="o">=</span> <span class="n">mc_widget</span><span class="o">.</span><span class="n">validate</span>

        <span class="c1"># Which row is the constrained parameter in?</span>
        <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRowFromName</span><span class="p">(</span><span class="n">constraint</span><span class="o">.</span><span class="n">param</span><span class="p">)</span>

        <span class="c1"># Create a new item and add the Constraint object as a child</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addConstraintToRow</span><span class="p">(</span><span class="n">constraint</span><span class="o">=</span><span class="n">constraint</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.deleteConstraint"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.deleteConstraint">[docs]</a>    <span class="k">def</span> <span class="nf">deleteConstraint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete constraints from selected parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">data</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">selectionModel</span><span class="p">()</span><span class="o">.</span><span class="n">selectedRows</span><span class="p">()</span>
                   <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isCheckable</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">row</span><span class="p">())]</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deleteConstraintOnParameter</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="n">param</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.deleteConstraintOnParameter"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.deleteConstraintOnParameter">[docs]</a>    <span class="k">def</span> <span class="nf">deleteConstraintOnParameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete the constraint on model parameter &#39;param&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">min_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">itemDelegate</span><span class="p">()</span><span class="o">.</span><span class="n">param_min</span>
        <span class="n">max_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">itemDelegate</span><span class="p">()</span><span class="o">.</span><span class="n">param_max</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isCheckable</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowHasConstraint</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="c1"># Get the Constraint object from of the model item</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">constraint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConstraintForRow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">constraint</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">constraint</span><span class="p">,</span> <span class="n">Constraint</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">param</span> <span class="ow">and</span> <span class="n">constraint</span><span class="o">.</span><span class="n">param</span> <span class="o">!=</span> <span class="n">param</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># Now we got the right row. Delete the constraint and clean up</span>
            <span class="c1"># Retrieve old values and put them on the model</span>
            <span class="k">if</span> <span class="n">constraint</span><span class="o">.</span><span class="n">min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">min_col</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">constraint</span><span class="o">.</span><span class="n">min</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">constraint</span><span class="o">.</span><span class="n">max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">max_col</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">constraint</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>
            <span class="c1"># Remove constraint item</span>
            <span class="n">item</span><span class="o">.</span><span class="n">removeRow</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">constraintAddedSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">([</span><span class="n">row</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modifyViewOnRow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">communicate</span><span class="o">.</span><span class="n">statusBarUpdateSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s1">&#39;Constraint removed&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.getConstraintForRow"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.getConstraintForRow">[docs]</a>    <span class="k">def</span> <span class="nf">getConstraintForRow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For the given row, return its constraint, if any (otherwise None)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isCheckable</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FittingWidget.allParamNames"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.allParamNames">[docs]</a>    <span class="k">def</span> <span class="nf">allParamNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of all parameter names defined on the current model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">_model_info</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">kernel_parameters</span>
        <span class="n">all_param_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">param</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">all_params</span><span class="p">]</span>
        <span class="c1"># Assure scale and background are always included</span>
        <span class="k">if</span> <span class="s1">&#39;scale&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_param_names</span><span class="p">:</span>
            <span class="n">all_param_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;scale&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;background&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_param_names</span><span class="p">:</span>
            <span class="n">all_param_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;background&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">all_param_names</span></div>

<div class="viewcode-block" id="FittingWidget.paramHasConstraint"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.paramHasConstraint">[docs]</a>    <span class="k">def</span> <span class="nf">paramHasConstraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds out if the given parameter in the main model has a constraint child</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">param</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">param</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">allParamNames</span><span class="p">():</span> <span class="k">return</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">!=</span> <span class="n">param</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowHasConstraint</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

        <span class="c1"># nothing found</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="FittingWidget.rowHasConstraint"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.rowHasConstraint">[docs]</a>    <span class="k">def</span> <span class="nf">rowHasConstraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds out if row of the main model has a constraint child</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isCheckable</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="o">.</span><span class="n">hasChildren</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">Constraint</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="FittingWidget.rowHasActiveConstraint"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.rowHasActiveConstraint">[docs]</a>    <span class="k">def</span> <span class="nf">rowHasActiveConstraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds out if row of the main model has an active constraint child</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isCheckable</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="o">.</span><span class="n">hasChildren</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">Constraint</span><span class="p">)</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="FittingWidget.rowHasActiveComplexConstraint"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.rowHasActiveComplexConstraint">[docs]</a>    <span class="k">def</span> <span class="nf">rowHasActiveComplexConstraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds out if row of the main model has an active, nontrivial constraint child</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isCheckable</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="o">.</span><span class="n">hasChildren</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">Constraint</span><span class="p">)</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">func</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="FittingWidget.selectParameters"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.selectParameters">[docs]</a>    <span class="k">def</span> <span class="nf">selectParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selected parameter is chosen for fitting</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setParameterSelection</span><span class="p">(</span><span class="n">status</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.deselectParameters"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.deselectParameters">[docs]</a>    <span class="k">def</span> <span class="nf">deselectParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selected parameters are removed for fitting</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setParameterSelection</span><span class="p">(</span><span class="n">status</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.selectedParameters"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.selectedParameters">[docs]</a>    <span class="k">def</span> <span class="nf">selectedParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns list of selected (highlighted) parameters &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">row</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">selectionModel</span><span class="p">()</span><span class="o">.</span><span class="n">selectedRows</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isCheckable</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">row</span><span class="p">())]</span></div>

<div class="viewcode-block" id="FittingWidget.setParameterSelection"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.setParameterSelection">[docs]</a>    <span class="k">def</span> <span class="nf">setParameterSelection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selected parameters are chosen for fitting</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Convert to proper indices and set requested enablement</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedParameters</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">status</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.getConstraintsForModel"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.getConstraintsForModel">[docs]</a>    <span class="k">def</span> <span class="nf">getConstraintsForModel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of tuples. Each tuple contains constraints mapped as</span>
<span class="sd">        (&#39;constrained parameter&#39;, &#39;function to constrain&#39;)</span>
<span class="sd">        e.g. [(&#39;sld&#39;,&#39;5*sld_solvent&#39;)]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">param_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">()</span><span class="o">.</span><span class="n">func</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">param_number</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowHasActiveConstraint</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">params</span></div>

<div class="viewcode-block" id="FittingWidget.getComplexConstraintsForModel"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.getComplexConstraintsForModel">[docs]</a>    <span class="k">def</span> <span class="nf">getComplexConstraintsForModel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of tuples. Each tuple contains constraints mapped as</span>
<span class="sd">        (&#39;constrained parameter&#39;, &#39;function to constrain&#39;)</span>
<span class="sd">        e.g. [(&#39;sld&#39;,&#39;5*M2.sld_solvent&#39;)].</span>
<span class="sd">        Only for constraints with defined VALUE</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">param_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">()</span><span class="o">.</span><span class="n">func</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">param_number</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowHasActiveComplexConstraint</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">params</span></div>

<div class="viewcode-block" id="FittingWidget.getConstraintObjectsForModel"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.getConstraintObjectsForModel">[docs]</a>    <span class="k">def</span> <span class="nf">getConstraintObjectsForModel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns Constraint objects present on the whole model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">param_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
        <span class="n">constraints</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">()</span>
                       <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">param_number</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowHasConstraint</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">constraints</span></div>

<div class="viewcode-block" id="FittingWidget.getConstraintsForFitting"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.getConstraintsForFitting">[docs]</a>    <span class="k">def</span> <span class="nf">getConstraintsForFitting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of constraints in format ready for use in fiting</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get constraints</span>
        <span class="n">constraints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getComplexConstraintsForModel</span><span class="p">()</span>
        <span class="c1"># See if there are any constraints across models</span>
        <span class="n">multi_constraints</span> <span class="o">=</span> <span class="p">[</span><span class="n">cons</span> <span class="k">for</span> <span class="n">cons</span> <span class="ow">in</span> <span class="n">constraints</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isConstraintMultimodel</span><span class="p">(</span><span class="n">cons</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

        <span class="k">if</span> <span class="n">multi_constraints</span><span class="p">:</span>
            <span class="c1"># Let users choose what to do</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;The current fit contains constraints relying on other fit pages.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;Parameters with those constraints are:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>\
                <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">cons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">cons</span> <span class="ow">in</span> <span class="n">multi_constraints</span><span class="p">])</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Would you like to remove these constraints or cancel fitting?&quot;</span>
            <span class="n">msgbox</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">msgbox</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Warning</span><span class="p">)</span>
            <span class="n">msgbox</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">msgbox</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Existing Constraints&quot;</span><span class="p">)</span>
            <span class="c1"># custom buttons</span>
            <span class="n">button_remove</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Remove&quot;</span><span class="p">)</span>
            <span class="n">msgbox</span><span class="o">.</span><span class="n">addButton</span><span class="p">(</span><span class="n">button_remove</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">YesRole</span><span class="p">)</span>
            <span class="n">button_cancel</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Cancel&quot;</span><span class="p">)</span>
            <span class="n">msgbox</span><span class="o">.</span><span class="n">addButton</span><span class="p">(</span><span class="n">button_cancel</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">RejectRole</span><span class="p">)</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="n">msgbox</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">retval</span> <span class="o">==</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">RejectRole</span><span class="p">:</span>
                <span class="c1"># cancel fit</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Fitting cancelled&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># remove constraint</span>
                <span class="k">for</span> <span class="n">cons</span> <span class="ow">in</span> <span class="n">multi_constraints</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">deleteConstraintOnParameter</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="n">cons</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="c1"># re-read the constraints</span>
                <span class="n">constraints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getComplexConstraintsForModel</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">constraints</span></div>

<div class="viewcode-block" id="FittingWidget.showModelDescription"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.showModelDescription">[docs]</a>    <span class="k">def</span> <span class="nf">showModelDescription</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a window with model description, when right clicked in the treeview</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Model description:</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">description</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;Sorry, no information is available for this model.&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">description</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;You must select a model to get information on this&quot;</span>

        <span class="n">menu</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMenu</span><span class="p">()</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QWidgetAction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">action</span><span class="o">.</span><span class="n">setDefaultWidget</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">menu</span></div>

<div class="viewcode-block" id="FittingWidget.canHaveMagnetism"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.canHaveMagnetism">[docs]</a>    <span class="k">def</span> <span class="nf">canHaveMagnetism</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the current model has magnetic scattering implemented</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">has_mag_params</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="p">:</span>
            <span class="n">has_mag_params</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">magnetic_params</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">is2D</span> <span class="ow">and</span> <span class="n">has_mag_params</span></div>

<div class="viewcode-block" id="FittingWidget.onSelectModel"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.onSelectModel">[docs]</a>    <span class="k">def</span> <span class="nf">onSelectModel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Respond to select Model from list event</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="n">MODEL_DEFAULT</span><span class="p">:</span>
            <span class="c1"># if the previous category was not the default, keep it.</span>
            <span class="c1"># Otherwise, just return</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_previous_model_index</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># We need to block signals, or else state changes on perceived unchanged conditions</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_previous_model_index</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Assure the control is active</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">():</span>
            <span class="k">return</span>
        <span class="c1"># Empty combobox forced to be read</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">model</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">chkMagnetism</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canHaveMagnetism</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chkMagnetism</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canHaveMagnetism</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabFitting</span><span class="o">.</span><span class="n">setTabEnabled</span><span class="p">(</span><span class="n">TAB_MAGNETISM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">chkMagnetism</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">canHaveMagnetism</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_previous_model_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>

        <span class="c1"># Reset parameters to fit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resetParametersToFit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_error_column</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_poly_error_column</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">structure</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbStructureFactor</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">():</span>
            <span class="n">structure</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbStructureFactor</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">respondToModelStructure</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">structure_factor</span><span class="o">=</span><span class="n">structure</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.onSelectBatchFilename"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.onSelectBatchFilename">[docs]</a>    <span class="k">def</span> <span class="nf">onSelectBatchFilename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the logic based on the selected file in batch fitting</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_index</span> <span class="o">=</span> <span class="n">data_index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateQRange</span><span class="p">()</span></div>

<div class="viewcode-block" id="FittingWidget.onSelectStructureFactor"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.onSelectStructureFactor">[docs]</a>    <span class="k">def</span> <span class="nf">onSelectStructureFactor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select Structure Factor from list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
        <span class="n">category</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbCategory</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
        <span class="n">structure</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbStructureFactor</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="n">CATEGORY_STRUCTURE</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># copy original clipboard</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">clipboard</span><span class="p">()</span>
        <span class="n">cb_text</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="c1"># get the screenshot of the current param state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onCopyToClipboard</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Reset parameters to fit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resetParametersToFit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_error_column</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_poly_error_column</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">respondToModelStructure</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">structure_factor</span><span class="o">=</span><span class="n">structure</span><span class="p">)</span>
        <span class="c1"># recast the original parameters into the model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onParameterPaste</span><span class="p">()</span>
        <span class="c1"># revert to the original clipboard</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">cb_text</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.resetParametersToFit"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.resetParametersToFit">[docs]</a>    <span class="k">def</span> <span class="nf">resetParametersToFit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clears the list of parameters to be fitted</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_params_to_fit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poly_params_to_fit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">magnet_params_to_fit</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="FittingWidget.onCustomModelChange"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.onCustomModelChange">[docs]</a>    <span class="k">def</span> <span class="nf">onCustomModelChange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reload the custom model combobox</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">## If caching plugins, then force cache reset to reload plugins</span>
        <span class="c1">#ModelManager().plugins_reset()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom_models</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">customModels</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readCustomCategoryInfo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onCategoriesChanged</span><span class="p">()</span>

        <span class="c1"># See if we need to update the combo in-place</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbCategory</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">!=</span> <span class="n">CATEGORY_CUSTOM</span><span class="p">:</span> <span class="k">return</span>

        <span class="n">current_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enableModelCombo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disableStructureCombo</span><span class="p">()</span>
        <span class="c1"># Retrieve the list of models</span>
        <span class="n">model_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">master_category_dict</span><span class="p">[</span><span class="n">CATEGORY_CUSTOM</span><span class="p">]</span>
        <span class="c1"># Populate the models combobox</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="nb">sorted</span><span class="p">([</span><span class="n">model</span> <span class="k">for</span> <span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="n">model_list</span><span class="p">]))</span>
        <span class="n">new_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="n">current_text</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">new_index</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="n">current_text</span><span class="p">))</span></div>

<div class="viewcode-block" id="FittingWidget.onSelectionChanged"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.onSelectionChanged">[docs]</a>    <span class="k">def</span> <span class="nf">onSelectionChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        React to parameter selection</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">selectionModel</span><span class="p">()</span><span class="o">.</span><span class="n">selectedRows</span><span class="p">()</span>
        <span class="c1"># Clean previous messages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">communicate</span><span class="o">.</span><span class="n">statusBarUpdateSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Show constraint, if present</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowHasConstraint</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="n">constr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConstraintForRow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConstraintForRow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">func</span>
            <span class="k">if</span> <span class="n">constr</span><span class="o">.</span><span class="n">func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># inter-parameter constraint</span>
                <span class="n">update_text</span> <span class="o">=</span> <span class="s2">&quot;Active constraint: &quot;</span><span class="o">+</span><span class="n">func</span>
            <span class="k">elif</span> <span class="n">constr</span><span class="o">.</span><span class="n">param</span> <span class="o">==</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">():</span>
                <span class="c1"># current value constraint</span>
                <span class="n">update_text</span> <span class="o">=</span> <span class="s2">&quot;Value constrained to: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">constr</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># ill defined constraint</span>
                <span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">communicate</span><span class="o">.</span><span class="n">statusBarUpdateSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">update_text</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.replaceConstraintName"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.replaceConstraintName">[docs]</a>    <span class="k">def</span> <span class="nf">replaceConstraintName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_name</span><span class="p">,</span> <span class="n">new_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace names of models in defined constraints</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">param_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
        <span class="c1"># loop over parameters</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">param_number</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowHasConstraint</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">()</span><span class="o">.</span><span class="n">func</span>
                <span class="k">if</span> <span class="n">old_name</span> <span class="ow">in</span> <span class="n">func</span><span class="p">:</span>
                    <span class="n">new_func</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old_name</span><span class="p">,</span> <span class="n">new_name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">()</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">new_func</span></div>

<div class="viewcode-block" id="FittingWidget.isConstraintMultimodel"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.isConstraintMultimodel">[docs]</a>    <span class="k">def</span> <span class="nf">isConstraintMultimodel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constraint</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if the constraint function text contains current model name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_model_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="n">current_model_name</span> <span class="ow">in</span> <span class="n">constraint</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="FittingWidget.updateData"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.updateData">[docs]</a>    <span class="k">def</span> <span class="nf">updateData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper function for recalculation of data used in plotting</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Update the chart</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_is_loaded</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmdPlot</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Show Plot&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calculateQGridForModel</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmdPlot</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Calculate&quot;</span><span class="p">)</span>
            <span class="c1"># Create default datasets if no data passed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">createDefaultDataset</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">theory_item</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ensure theory is recalc. before plot, see showTheoryPlot()</span></div>

<div class="viewcode-block" id="FittingWidget.respondToModelStructure"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.respondToModelStructure">[docs]</a>    <span class="k">def</span> <span class="nf">respondToModelStructure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">structure_factor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Set enablement on calculate/plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdPlot</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># kernel parameters -&gt; model_model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SASModelToQModel</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">structure_factor</span><span class="p">)</span>

        <span class="c1"># Enable magnetism checkbox for selected models</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chkMagnetism</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canHaveMagnetism</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabFitting</span><span class="o">.</span><span class="n">setTabEnabled</span><span class="p">(</span><span class="n">TAB_MAGNETISM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">chkMagnetism</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">canHaveMagnetism</span><span class="p">())</span>

        <span class="c1"># Update column widths</span>
        <span class="k">for</span> <span class="n">column</span><span class="p">,</span> <span class="n">width</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstParamHeaderSizes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">setColumnWidth</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>

        <span class="c1"># Update plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateData</span><span class="p">()</span>

        <span class="c1"># Update state stack</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateUndo</span><span class="p">()</span>

        <span class="c1"># Let others know</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newModelSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span></div>

<div class="viewcode-block" id="FittingWidget.onSelectCategory"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.onSelectCategory">[docs]</a>    <span class="k">def</span> <span class="nf">onSelectCategory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select Category from list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">category</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbCategory</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="c1"># Check if the user chose &quot;Choose category entry&quot;</span>
        <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="n">CATEGORY_DEFAULT</span><span class="p">:</span>
            <span class="c1"># if the previous category was not the default, keep it.</span>
            <span class="c1"># Otherwise, just return</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_previous_category_index</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># We need to block signals, or else state changes on perceived unchanged conditions</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cbCategory</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cbCategory</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_previous_category_index</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cbCategory</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="n">CATEGORY_STRUCTURE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disableModelCombo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enableStructureCombo</span><span class="p">()</span>
            <span class="c1"># set the index to 0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbStructureFactor</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="c1"># Wipe out the parameter model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="c1"># Safely clear and enable the model combo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enableModelCombo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disableStructureCombo</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_previous_category_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbCategory</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
        <span class="c1"># Retrieve the list of models</span>
        <span class="n">model_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">master_category_dict</span><span class="p">[</span><span class="n">category</span><span class="p">]</span>
        <span class="c1"># Populate the models combobox</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">MODEL_DEFAULT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="nb">sorted</span><span class="p">([</span><span class="n">model</span> <span class="k">for</span> <span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="n">model_list</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.onPolyModelChange"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.onPolyModelChange">[docs]</a>    <span class="k">def</span> <span class="nf">onPolyModelChange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback method for updating the main model and sasmodel</span>
<span class="sd">        parameters with the GUI values in the polydispersity view</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">itemFromIndex</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
        <span class="n">model_column</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
        <span class="n">model_row</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="n">name_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">model_row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">parameter_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">name_index</span><span class="o">.</span><span class="n">data</span><span class="p">())</span> <span class="c1"># &quot;distribution of sld&quot; etc.</span>
        <span class="k">if</span> <span class="s2">&quot;istribution of&quot;</span> <span class="ow">in</span> <span class="n">parameter_name</span><span class="p">:</span>
            <span class="c1"># just the last word</span>
            <span class="n">parameter_name</span> <span class="o">=</span> <span class="n">parameter_name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">delegate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstPoly</span><span class="o">.</span><span class="n">itemDelegate</span><span class="p">()</span>

        <span class="c1"># Extract changed value.</span>
        <span class="k">if</span> <span class="n">model_column</span> <span class="o">==</span> <span class="n">delegate</span><span class="o">.</span><span class="n">poly_parameter</span><span class="p">:</span>
            <span class="c1"># Is the parameter checked for fitting?</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span>
            <span class="n">parameter_name_w</span> <span class="o">=</span> <span class="n">parameter_name</span> <span class="o">+</span> <span class="s1">&#39;.width&#39;</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">poly_params_to_fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_name_w</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">parameter_name_w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">poly_params_to_fit</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">poly_params_to_fit</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">parameter_name_w</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmdFit</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">haveParamsToFit</span><span class="p">())</span>
            <span class="c1"># force data update</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">parameter_name</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">delegate</span><span class="o">.</span><span class="n">columnDict</span><span class="p">()[</span><span class="n">delegate</span><span class="o">.</span><span class="n">poly_pd</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">poly_params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateData</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">model_column</span> <span class="ow">in</span> <span class="p">[</span><span class="n">delegate</span><span class="o">.</span><span class="n">poly_min</span><span class="p">,</span> <span class="n">delegate</span><span class="o">.</span><span class="n">poly_max</span><span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">toDouble</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="c1"># Can&#39;t be converted properly, bring back the old value and exit</span>
                <span class="k">return</span>

            <span class="n">current_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">details</span><span class="p">[</span><span class="n">parameter_name</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_poly_error_column</span><span class="p">:</span>
                <span class="c1"># err column changes the indexing</span>
                <span class="n">current_details</span><span class="p">[</span><span class="n">model_column</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">current_details</span><span class="p">[</span><span class="n">model_column</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">elif</span> <span class="n">model_column</span> <span class="o">==</span> <span class="n">delegate</span><span class="o">.</span><span class="n">poly_function</span><span class="p">:</span>
            <span class="c1"># name of the function - just pass</span>
            <span class="k">pass</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">toDouble</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="c1"># Can&#39;t be converted properly, bring back the old value and exit</span>
                <span class="k">return</span>

            <span class="c1"># Update the sasmodel</span>
            <span class="c1"># PD[ratio] -&gt; width, npts -&gt; npts, nsigs -&gt; nsigmas</span>
            <span class="k">if</span> <span class="n">model_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">delegate</span><span class="o">.</span><span class="n">columnDict</span><span class="p">():</span>
                <span class="k">return</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">parameter_name</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">delegate</span><span class="o">.</span><span class="n">columnDict</span><span class="p">()[</span><span class="n">model_column</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">poly_params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="c1"># Update plot</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateData</span><span class="p">()</span>

        <span class="c1"># update in param model</span>
        <span class="k">if</span> <span class="n">model_column</span> <span class="ow">in</span> <span class="p">[</span><span class="n">delegate</span><span class="o">.</span><span class="n">poly_pd</span><span class="p">,</span> <span class="n">delegate</span><span class="o">.</span><span class="n">poly_error</span><span class="p">,</span> <span class="n">delegate</span><span class="o">.</span><span class="n">poly_min</span><span class="p">,</span> <span class="n">delegate</span><span class="o">.</span><span class="n">poly_max</span><span class="p">]:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRowFromName</span><span class="p">(</span><span class="n">parameter_name</span><span class="p">)</span>
            <span class="n">param_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">model_column</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">param_item</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">param_item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.onMagnetModelChange"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.onMagnetModelChange">[docs]</a>    <span class="k">def</span> <span class="nf">onMagnetModelChange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback method for updating the sasmodel magnetic parameters with the GUI values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="o">.</span><span class="n">itemFromIndex</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
        <span class="n">model_column</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
        <span class="n">model_row</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="n">name_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">model_row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">parameter_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">name_index</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">model_column</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">magnet_params_to_fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">parameter_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">magnet_params_to_fit</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">magnet_params_to_fit</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">parameter_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmdFit</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">haveParamsToFit</span><span class="p">())</span>
            <span class="c1"># Update state stack</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateUndo</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="c1"># Extract changed value.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">toDouble</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="c1"># Unparsable field</span>
            <span class="k">return</span>
        <span class="n">delegate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstMagnetic</span><span class="o">.</span><span class="n">itemDelegate</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">model_column</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">model_column</span> <span class="o">==</span> <span class="n">delegate</span><span class="o">.</span><span class="n">mag_min</span><span class="p">:</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">model_column</span> <span class="o">==</span> <span class="n">delegate</span><span class="o">.</span><span class="n">mag_max</span><span class="p">:</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">elif</span> <span class="n">model_column</span> <span class="o">==</span> <span class="n">delegate</span><span class="o">.</span><span class="n">mag_unit</span><span class="p">:</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Wrong column in magnetism table.&quot;</span><span class="p">)</span>
            <span class="c1"># min/max to be changed in self.kernel_module.details[parameter_name] = [&#39;Ang&#39;, 0.0, inf]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">details</span><span class="p">[</span><span class="n">parameter_name</span><span class="p">][</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">magnet_params</span><span class="p">[</span><span class="n">parameter_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="c1">#self.kernel_module.setParam(parameter_name) = value</span>
            <span class="c1"># Force the chart update when actual parameters changed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recalculatePlotData</span><span class="p">()</span>

        <span class="c1"># Update state stack</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateUndo</span><span class="p">()</span></div>

<div class="viewcode-block" id="FittingWidget.onHelp"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.onHelp">[docs]</a>    <span class="k">def</span> <span class="nf">onHelp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Show the &quot;Fitting&quot; section of help</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tree_location</span> <span class="o">=</span> <span class="s2">&quot;/user/qtgui/Perspectives/Fitting/&quot;</span>

        <span class="c1"># Actual file will depend on the current tab</span>
        <span class="n">tab_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tabFitting</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
        <span class="n">helpfile</span> <span class="o">=</span> <span class="s2">&quot;fitting.html&quot;</span>
        <span class="k">if</span> <span class="n">tab_id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Look at the model and if set, pull out its help page</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">):</span>
                <span class="c1"># See if the help file is there</span>
                <span class="c1"># This breaks encapsulation a bit, though.</span>
                <span class="n">full_path</span> <span class="o">=</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">HELP_DIRECTORY_LOCATION</span>
                <span class="n">sas_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">location</span> <span class="o">=</span> <span class="n">sas_path</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">full_path</span>
                <span class="n">location</span> <span class="o">+=</span> <span class="s2">&quot;/user/models/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="s2">&quot;.html&quot;</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">location</span><span class="p">):</span>
                    <span class="c1"># We have HTML for this model - show it</span>
                    <span class="n">tree_location</span> <span class="o">=</span> <span class="s2">&quot;/user/models/&quot;</span>
                    <span class="n">helpfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="s2">&quot;.html&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">helpfile</span> <span class="o">=</span> <span class="s2">&quot;fitting_help.html&quot;</span>
        <span class="k">elif</span> <span class="n">tab_id</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">helpfile</span> <span class="o">=</span> <span class="s2">&quot;residuals_help.html&quot;</span>
        <span class="k">elif</span> <span class="n">tab_id</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">helpfile</span> <span class="o">=</span> <span class="s2">&quot;resolution.html&quot;</span>
        <span class="k">elif</span> <span class="n">tab_id</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">helpfile</span> <span class="o">=</span> <span class="s2">&quot;pd/polydispersity.html&quot;</span>
        <span class="k">elif</span> <span class="n">tab_id</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">helpfile</span> <span class="o">=</span> <span class="s2">&quot;magnetism/magnetism.html&quot;</span>
        <span class="n">help_location</span> <span class="o">=</span> <span class="n">tree_location</span> <span class="o">+</span> <span class="n">helpfile</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">showHelp</span><span class="p">(</span><span class="n">help_location</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.showHelp"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.showHelp">[docs]</a>    <span class="k">def</span> <span class="nf">showHelp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls parent&#39;s method for opening an HTML page</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">showHelp</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.onDisplayMagneticAngles"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.onDisplayMagneticAngles">[docs]</a>    <span class="k">def</span> <span class="nf">onDisplayMagneticAngles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display a simple image showing direction of magnetic angles</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">magneticAnglesWidget</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="FittingWidget.onFit"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.onFit">[docs]</a>    <span class="k">def</span> <span class="nf">onFit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform fitting on the current data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_started</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stopFit</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="c1"># initialize fitter constants</span>
        <span class="n">fit_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">handler</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">batch_inputs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">batch_outputs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1">#---------------------------------</span>
        <span class="k">if</span> <span class="n">LocalConfig</span><span class="o">.</span><span class="n">USING_TWISTED</span><span class="p">:</span>
            <span class="n">handler</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">updater</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">handler</span> <span class="o">=</span> <span class="n">ConsoleUpdate</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
                                    <span class="n">manager</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                    <span class="n">improvement_delta</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
            <span class="n">updater</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">update_fit</span>

        <span class="c1"># Prepare the fitter object</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fitters</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepareFitters</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="c1"># This should not happen! GUI explicitly forbids this situation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">communicate</span><span class="o">.</span><span class="n">statusBarUpdateSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">))</span>
            <span class="k">return</span>

        <span class="c1"># keep local copy of kernel parameters, as they will change during the update</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module_copy</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="p">)</span>

        <span class="c1"># Create the fitting thread, based on the fitter</span>
        <span class="n">completefn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">batchFittingCompleted</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_batch_fitting</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">fittingCompleted</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">calc_fit</span> <span class="o">=</span> <span class="n">FitThread</span><span class="p">(</span><span class="n">handler</span><span class="o">=</span><span class="n">handler</span><span class="p">,</span>
                            <span class="n">fn</span><span class="o">=</span><span class="n">fitters</span><span class="p">,</span>
                            <span class="n">batch_inputs</span><span class="o">=</span><span class="n">batch_inputs</span><span class="p">,</span>
                            <span class="n">batch_outputs</span><span class="o">=</span><span class="n">batch_outputs</span><span class="p">,</span>
                            <span class="n">page_id</span><span class="o">=</span><span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">page_id</span><span class="p">]],</span>
                            <span class="n">updatefn</span><span class="o">=</span><span class="n">updater</span><span class="p">,</span>
                            <span class="n">completefn</span><span class="o">=</span><span class="n">completefn</span><span class="p">,</span>
                            <span class="n">reset_flag</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is_chain_fitting</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">LocalConfig</span><span class="o">.</span><span class="n">USING_TWISTED</span><span class="p">:</span>
            <span class="c1"># start the trhrhread with twisted</span>
            <span class="n">calc_thread</span> <span class="o">=</span> <span class="n">threads</span><span class="o">.</span><span class="n">deferToThread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calc_fit</span><span class="o">.</span><span class="n">compute</span><span class="p">)</span>
            <span class="n">calc_thread</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">completefn</span><span class="p">)</span>
            <span class="n">calc_thread</span><span class="o">.</span><span class="n">addErrback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fitFailed</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Use the old python threads + Queue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calc_fit</span><span class="o">.</span><span class="n">queue</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calc_fit</span><span class="o">.</span><span class="n">ready</span><span class="p">(</span><span class="mf">2.5</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">communicate</span><span class="o">.</span><span class="n">statusBarUpdateSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s1">&#39;Fitting started...&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_started</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Disable some elements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disableInteractiveElements</span><span class="p">()</span></div>

<div class="viewcode-block" id="FittingWidget.stopFit"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.stopFit">[docs]</a>    <span class="k">def</span> <span class="nf">stopFit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attempt to stop the fitting thread</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_fit</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_fit</span><span class="o">.</span><span class="n">isrunning</span><span class="p">():</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calc_fit</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="c1">#re-enable the Fit button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enableInteractiveElements</span><span class="p">()</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Fitting cancelled.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">communicate</span><span class="o">.</span><span class="n">statusBarUpdateSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.updateFit"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.updateFit">[docs]</a>    <span class="k">def</span> <span class="nf">updateFit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;UPDATE FIT&quot;</span><span class="p">)</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="FittingWidget.fitFailed"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.fitFailed">[docs]</a>    <span class="k">def</span> <span class="nf">fitFailed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reason</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enableInteractiveElements</span><span class="p">()</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Fitting failed with: &quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">reason</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">communicate</span><span class="o">.</span><span class="n">statusBarUpdateSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.batchFittingCompleted"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.batchFittingCompleted">[docs]</a>    <span class="k">def</span> <span class="nf">batchFittingCompleted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send the finish message from calculate threads to main thread</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batchFittingFinishedSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.batchFitComplete"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.batchFitComplete">[docs]</a>    <span class="k">def</span> <span class="nf">batchFitComplete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Receive and display batch fitting results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#re-enable the Fit button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enableInteractiveElements</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Fitting failed.&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">communicate</span><span class="o">.</span><span class="n">statusBarUpdateSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Show the grid panel</span>
        <span class="n">page_name</span> <span class="o">=</span> <span class="s2">&quot;BatchPage&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tab_id</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">page_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">communicate</span><span class="o">.</span><span class="n">sendDataToGridSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

        <span class="n">elapsed</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Fitting completed successfully in: </span><span class="si">%s</span><span class="s2"> s.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">formatNumber</span><span class="p">(</span><span class="n">elapsed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">communicate</span><span class="o">.</span><span class="n">statusBarUpdateSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># Run over the list of results and update the items</span>
        <span class="k">for</span> <span class="n">res_index</span><span class="p">,</span> <span class="n">res_list</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="c1"># results</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">res_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">param_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">paramDictFromResults</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

            <span class="c1"># create local kernel_module</span>
            <span class="n">kernel_module</span> <span class="o">=</span> <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">updateKernelWithResults</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">)</span>
            <span class="c1"># pull out current data</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logic</span><span class="p">[</span><span class="n">res_index</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>

            <span class="c1"># Switch indexes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_index</span> <span class="o">=</span> <span class="n">res_index</span>
            <span class="c1"># Recompute Q ranges</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_is_loaded</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">q_range_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_range_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">npts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic</span><span class="o">.</span><span class="n">computeDataRange</span><span class="p">()</span>

            <span class="c1"># Recalculate theories</span>
            <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">complete1D</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">Data1D</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">complete2D</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calculateQGridForModelExt</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">kernel_module</span><span class="p">,</span> <span class="n">completefn</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">use_threads</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Restore original kernel_module, so subsequent fits on the same model don&#39;t pick up the new params</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_module_copy</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.paramDictFromResults"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.paramDictFromResults">[docs]</a>    <span class="k">def</span> <span class="nf">paramDictFromResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given the fit results structure, pull out optimized parameters and return them as nicely</span>
<span class="sd">        formatted dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">results</span><span class="o">.</span><span class="n">fitness</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> \
            <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">fitness</span><span class="p">)</span> <span class="ow">or</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">pvec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> \
            <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">pvec</span><span class="p">)):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Fitting did not converge!&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">communicate</span><span class="o">.</span><span class="n">statusBarUpdateSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="n">results</span><span class="o">.</span><span class="n">mesg</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">param_list</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">param_list</span> <span class="c1"># [&#39;radius&#39;, &#39;radius.width&#39;]</span>
        <span class="n">param_values</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">pvec</span>     <span class="c1"># array([ 0.36221662,  0.0146783 ])</span>
        <span class="n">param_stderr</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">stderr</span>   <span class="c1"># array([ 1.71293015,  1.71294233])</span>
        <span class="n">params_and_errors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">param_values</span><span class="p">,</span> <span class="n">param_stderr</span><span class="p">))</span>
        <span class="n">param_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">param_list</span><span class="p">,</span> <span class="n">params_and_errors</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">param_dict</span></div>

<div class="viewcode-block" id="FittingWidget.fittingCompleted"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.fittingCompleted">[docs]</a>    <span class="k">def</span> <span class="nf">fittingCompleted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send the finish message from calculate threads to main thread</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fittingFinishedSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.fitComplete"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.fitComplete">[docs]</a>    <span class="k">def</span> <span class="nf">fitComplete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Receive and display fitting results</span>
<span class="sd">        &quot;result&quot; is a tuple of actual result list and the fit time in seconds</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#re-enable the Fit button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enableInteractiveElements</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Fitting failed.&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">communicate</span><span class="o">.</span><span class="n">statusBarUpdateSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Don&#39;t recalculate chi2 - it&#39;s in res.fitness already</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitResults</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">res_list</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">res_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chi2</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">fitness</span>
        <span class="n">param_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">paramDictFromResults</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">param_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Show bumps convergence plots</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">communicate</span><span class="o">.</span><span class="n">resultPlotUpdateSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">elapsed</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_fit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_fit</span><span class="o">.</span><span class="n">_interrupting</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Fitting cancelled by user after: </span><span class="si">%s</span><span class="s2"> s.&quot;</span> <span class="o">%</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">formatNumber</span><span class="p">(</span><span class="n">elapsed</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">msg</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Fitting completed successfully in: </span><span class="si">%s</span><span class="s2"> s.&quot;</span> <span class="o">%</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">formatNumber</span><span class="p">(</span><span class="n">elapsed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">communicate</span><span class="o">.</span><span class="n">statusBarUpdateSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># Dictionary of fitted parameter: value, error</span>
        <span class="c1"># e.g. param_dic = {&quot;sld&quot;:(1.703, 0.0034), &quot;length&quot;:(33.455, -0.0983)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateModelFromList</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">updatePolyModelFromList</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">updateMagnetModelFromList</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>

        <span class="c1"># update charts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onPlot</span><span class="p">()</span>

        <span class="c1"># Read only value - we can get away by just printing it here</span>
        <span class="n">chi2_repr</span> <span class="o">=</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">formatNumber</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chi2</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lblChi2Value</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">chi2_repr</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.prepareFitters"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.prepareFitters">[docs]</a>    <span class="k">def</span> <span class="nf">prepareFitters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fitter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fit_id</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare the Fitter object for use in fitting</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># fitter = None -&gt; single/batch fitting</span>
        <span class="c1"># fitter = Fit() -&gt; simultaneous fitting</span>

        <span class="c1"># Data going in</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic</span><span class="o">.</span><span class="n">data</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="p">)</span>
        <span class="n">qmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_range_min</span>
        <span class="n">qmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_range_max</span>

        <span class="n">params_to_fit</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_params_to_fit</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chkPolydispersity</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">params_to_fit</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">poly_params_to_fit</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chkMagnetism</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">canHaveMagnetism</span><span class="p">():</span>
            <span class="n">params_to_fit</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">magnet_params_to_fit</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">params_to_fit</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Fitting requires at least one parameter to optimize.&#39;</span><span class="p">)</span>

        <span class="c1"># Get the constraints.</span>
        <span class="n">constraints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getComplexConstraintsForModel</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">fitter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># For single fits - check for inter-model constraints</span>
            <span class="n">constraints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConstraintsForFitting</span><span class="p">()</span>

        <span class="n">smearer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smearing_widget</span><span class="o">.</span><span class="n">smearer</span><span class="p">()</span>
        <span class="n">handler</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">batch_inputs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">batch_outputs</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">fitters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># order datasets if chain fit</span>
        <span class="n">order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_data</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_chain_fitting</span><span class="p">:</span>
            <span class="n">order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_widget</span><span class="o">.</span><span class="n">ordering</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">fit_index</span> <span class="ow">in</span> <span class="n">order</span><span class="p">:</span>
            <span class="n">fitter_single</span> <span class="o">=</span> <span class="n">Fit</span><span class="p">()</span> <span class="k">if</span> <span class="n">fitter</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">fitter</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">dataFromItem</span><span class="p">(</span><span class="n">fit_index</span><span class="p">)</span>
            <span class="c1"># Potential weights added directly to data</span>
            <span class="n">weighted_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addWeightingToData</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">fitter_single</span><span class="o">.</span><span class="n">set_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">fit_id</span><span class="p">,</span> <span class="n">params_to_fit</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">weighted_data</span><span class="p">,</span>
                             <span class="n">constraints</span><span class="o">=</span><span class="n">constraints</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Setting model parameters failed with: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ex</span><span class="p">)</span>

            <span class="n">fitter_single</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">weighted_data</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">fit_id</span><span class="p">,</span> <span class="n">smearer</span><span class="o">=</span><span class="n">smearer</span><span class="p">,</span> <span class="n">qmin</span><span class="o">=</span><span class="n">qmin</span><span class="p">,</span>
                            <span class="n">qmax</span><span class="o">=</span><span class="n">qmax</span><span class="p">)</span>
            <span class="n">fitter_single</span><span class="o">.</span><span class="n">select_problem_for_fit</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">fit_id</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fitter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Assign id to the new fitter only</span>
                <span class="n">fitter_single</span><span class="o">.</span><span class="n">fitter_id</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">page_id</span><span class="p">]</span>
            <span class="n">fit_id</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">fitters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fitter_single</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fitters</span><span class="p">,</span> <span class="n">fit_id</span></div>

<div class="viewcode-block" id="FittingWidget.iterateOverModel"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.iterateOverModel">[docs]</a>    <span class="k">def</span> <span class="nf">iterateOverModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Take func and throw it inside the model row loop</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">row_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="n">func</span><span class="p">(</span><span class="n">row_i</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.updateModelFromList"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.updateModelFromList">[docs]</a>    <span class="k">def</span> <span class="nf">updateModelFromList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the model with new parameters, create the errors column</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">def</span> <span class="nf">updateFittedValues</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
            <span class="c1"># Utility function for main model update</span>
            <span class="c1"># internal so can use closure for param_dict</span>
            <span class="n">param_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isCheckable</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="ow">or</span> <span class="n">param_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">param_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">return</span>
            <span class="c1"># modify the param value</span>
            <span class="n">param_repr</span> <span class="o">=</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">formatNumber</span><span class="p">(</span><span class="n">param_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">high</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">param_repr</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_error_column</span><span class="p">:</span>
                <span class="n">error_repr</span> <span class="o">=</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">formatNumber</span><span class="p">(</span><span class="n">param_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">high</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">error_repr</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">updatePolyValues</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
            <span class="c1"># Utility function for updateof polydispersity part of the main model</span>
            <span class="n">param_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span><span class="o">+</span><span class="s1">&#39;.width&#39;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isCheckable</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="ow">or</span> <span class="n">param_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">param_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">return</span>
            <span class="c1"># modify the param value</span>
            <span class="n">param_repr</span> <span class="o">=</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">formatNumber</span><span class="p">(</span><span class="n">param_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">high</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">param_repr</span><span class="p">)</span>
            <span class="c1"># modify the param error</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_error_column</span><span class="p">:</span>
                <span class="n">error_repr</span> <span class="o">=</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">formatNumber</span><span class="p">(</span><span class="n">param_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">high</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">error_repr</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">createErrorColumn</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
            <span class="c1"># Utility function for error column update</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">()</span>
            <span class="k">def</span> <span class="nf">createItem</span><span class="p">(</span><span class="n">param_name</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">param_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_params_to_fit</span><span class="p">:</span>
                    <span class="n">error_repr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">error_repr</span> <span class="o">=</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">formatNumber</span><span class="p">(</span><span class="n">param_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">high</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">error_repr</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">curr_param</span><span class="p">():</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

            <span class="p">[</span><span class="n">createItem</span><span class="p">(</span><span class="n">param_name</span><span class="p">)</span> <span class="k">for</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">param_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="k">if</span> <span class="n">curr_param</span><span class="p">()</span> <span class="o">==</span> <span class="n">param_name</span><span class="p">]</span>

            <span class="n">error_column</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">createPolyErrorColumn</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
            <span class="c1"># Utility function for error column update in the polydispersity sub-rows</span>
            <span class="c1"># NOTE: only creates empty items; updatePolyValues adds the error value</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="o">.</span><span class="n">hasChildren</span><span class="p">():</span>
                <span class="k">return</span>
            <span class="n">poly_item</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">poly_item</span><span class="o">.</span><span class="n">hasChildren</span><span class="p">():</span>
                <span class="k">return</span>
            <span class="n">poly_item</span><span class="o">.</span><span class="n">insertColumn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)])</span>

        <span class="k">def</span> <span class="nf">deletePolyErrorColumn</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
            <span class="c1"># Utility function for error column removal in the polydispersity sub-rows</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="o">.</span><span class="n">hasChildren</span><span class="p">():</span>
                <span class="k">return</span>
            <span class="n">poly_item</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">poly_item</span><span class="o">.</span><span class="n">hasChildren</span><span class="p">():</span>
                <span class="k">return</span>
            <span class="n">poly_item</span><span class="o">.</span><span class="n">removeColumn</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_error_column</span><span class="p">:</span>
            <span class="c1"># remove previous entries</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">removeColumn</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iterateOverModel</span><span class="p">(</span><span class="n">deletePolyErrorColumn</span><span class="p">)</span>

        <span class="c1">#if not self.has_error_column:</span>
            <span class="c1"># create top-level error column</span>
        <span class="n">error_column</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">itemDelegate</span><span class="p">()</span><span class="o">.</span><span class="n">addErrorColumn</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iterateOverModel</span><span class="p">(</span><span class="n">createErrorColumn</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">insertColumn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">error_column</span><span class="p">)</span>

        <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">addErrorHeadersToModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="p">)</span>

        <span class="c1"># create error column in polydispersity sub-rows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iterateOverModel</span><span class="p">(</span><span class="n">createPolyErrorColumn</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">has_error_column</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># block signals temporarily, so we don&#39;t end up</span>
        <span class="c1"># updating charts with every single model change on the end of fitting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">dataChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iterateOverModel</span><span class="p">(</span><span class="n">updateFittedValues</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iterateOverModel</span><span class="p">(</span><span class="n">updatePolyValues</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">dataChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onMainParamsChange</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.iterateOverPolyModel"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.iterateOverPolyModel">[docs]</a>    <span class="k">def</span> <span class="nf">iterateOverPolyModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Take func and throw it inside the poly model row loop</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">row_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="n">func</span><span class="p">(</span><span class="n">row_i</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.updatePolyModelFromList"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.updatePolyModelFromList">[docs]</a>    <span class="k">def</span> <span class="nf">updatePolyModelFromList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the polydispersity model with new parameters, create the errors column</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">def</span> <span class="nf">updateFittedValues</span><span class="p">(</span><span class="n">row_i</span><span class="p">):</span>
            <span class="c1"># Utility function for main model update</span>
            <span class="c1"># internal so can use closure for param_dict</span>
            <span class="k">if</span> <span class="n">row_i</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">rowCount</span><span class="p">():</span>
                <span class="k">return</span>
            <span class="n">param_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row_i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span><span class="o">.</span><span class="n">rsplit</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.width&#39;</span>
            <span class="k">if</span> <span class="n">param_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">param_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">return</span>
            <span class="c1"># modify the param value</span>
            <span class="n">param_repr</span> <span class="o">=</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">formatNumber</span><span class="p">(</span><span class="n">param_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">high</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row_i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">param_repr</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_poly_error_column</span><span class="p">:</span>
                <span class="n">error_repr</span> <span class="o">=</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">formatNumber</span><span class="p">(</span><span class="n">param_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">high</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row_i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">error_repr</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">createErrorColumn</span><span class="p">(</span><span class="n">row_i</span><span class="p">):</span>
            <span class="c1"># Utility function for error column update</span>
            <span class="k">if</span> <span class="n">row_i</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">rowCount</span><span class="p">():</span>
                <span class="k">return</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">()</span>

            <span class="k">def</span> <span class="nf">createItem</span><span class="p">(</span><span class="n">param_name</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">poly_params_to_fit</span><span class="p">:</span>
                    <span class="n">error_repr</span> <span class="o">=</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">formatNumber</span><span class="p">(</span><span class="n">param_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">high</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">error_repr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">error_repr</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">poly_param</span><span class="p">():</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row_i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span><span class="o">.</span><span class="n">rsplit</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.width&#39;</span>

            <span class="p">[</span><span class="n">createItem</span><span class="p">(</span><span class="n">param_name</span><span class="p">)</span> <span class="k">for</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">param_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="k">if</span> <span class="n">poly_param</span><span class="p">()</span> <span class="o">==</span> <span class="n">param_name</span><span class="p">]</span>

            <span class="n">error_column</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">iterateOverPolyModel</span><span class="p">(</span><span class="n">updateFittedValues</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_poly_error_column</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">removeColumn</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lstPoly</span><span class="o">.</span><span class="n">itemDelegate</span><span class="p">()</span><span class="o">.</span><span class="n">addErrorColumn</span><span class="p">()</span>
        <span class="n">error_column</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iterateOverPolyModel</span><span class="p">(</span><span class="n">createErrorColumn</span><span class="p">)</span>

        <span class="c1"># switch off reponse to model change</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">insertColumn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">error_column</span><span class="p">)</span>
        <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">addErrorPolyHeadersToModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">has_poly_error_column</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="FittingWidget.iterateOverMagnetModel"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.iterateOverMagnetModel">[docs]</a>    <span class="k">def</span> <span class="nf">iterateOverMagnetModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Take func and throw it inside the magnet model row loop</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">row_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="n">func</span><span class="p">(</span><span class="n">row_i</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.updateMagnetModelFromList"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.updateMagnetModelFromList">[docs]</a>    <span class="k">def</span> <span class="nf">updateMagnetModelFromList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the magnetic model with new parameters, create the errors column</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">def</span> <span class="nf">updateFittedValues</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
            <span class="c1"># Utility function for main model update</span>
            <span class="c1"># internal so can use closure for param_dict</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">param_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">param_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">param_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">return</span>
            <span class="c1"># modify the param value</span>
            <span class="n">param_repr</span> <span class="o">=</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">formatNumber</span><span class="p">(</span><span class="n">param_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">high</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">param_repr</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_magnet_error_column</span><span class="p">:</span>
                <span class="n">error_repr</span> <span class="o">=</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">formatNumber</span><span class="p">(</span><span class="n">param_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">high</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">error_repr</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">createErrorColumn</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
            <span class="c1"># Utility function for error column update</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">()</span>
            <span class="k">def</span> <span class="nf">createItem</span><span class="p">(</span><span class="n">param_name</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">magnet_params_to_fit</span><span class="p">:</span>
                    <span class="n">error_repr</span> <span class="o">=</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">formatNumber</span><span class="p">(</span><span class="n">param_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">high</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">error_repr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">error_repr</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">curr_param</span><span class="p">():</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

            <span class="p">[</span><span class="n">createItem</span><span class="p">(</span><span class="n">param_name</span><span class="p">)</span> <span class="k">for</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">param_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="k">if</span> <span class="n">curr_param</span><span class="p">()</span> <span class="o">==</span> <span class="n">param_name</span><span class="p">]</span>

            <span class="n">error_column</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">iterateOverMagnetModel</span><span class="p">(</span><span class="n">updateFittedValues</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_magnet_error_column</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="o">.</span><span class="n">removeColumn</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lstMagnetic</span><span class="o">.</span><span class="n">itemDelegate</span><span class="p">()</span><span class="o">.</span><span class="n">addErrorColumn</span><span class="p">()</span>
        <span class="n">error_column</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iterateOverMagnetModel</span><span class="p">(</span><span class="n">createErrorColumn</span><span class="p">)</span>

        <span class="c1"># switch off reponse to model change</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="o">.</span><span class="n">insertColumn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">error_column</span><span class="p">)</span>
        <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">addErrorHeadersToModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">has_magnet_error_column</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="FittingWidget.onPlot"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.onPlot">[docs]</a>    <span class="k">def</span> <span class="nf">onPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the current set of data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Regardless of previous state, this should now be `plot show` functionality only</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdPlot</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Show Plot&quot;</span><span class="p">)</span>
        <span class="c1"># Force data recalculation so existing charts are updated</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_is_loaded</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">showTheoryPlot</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">showPlot</span><span class="p">()</span>
        <span class="c1"># This is an important processEvent.</span>
        <span class="c1"># This allows charts to be properly updated in order</span>
        <span class="c1"># of plots being applied.</span>
        <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recalculatePlotData</span><span class="p">()</span> <span class="c1"># recalc+plot theory again (2nd)</span></div>

<div class="viewcode-block" id="FittingWidget.onSmearingOptionsUpdate"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.onSmearingOptionsUpdate">[docs]</a>    <span class="k">def</span> <span class="nf">onSmearingOptionsUpdate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        React to changes in the smearing widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># update display</span>
        <span class="n">smearing</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">,</span> <span class="n">smearing_min</span><span class="p">,</span> <span class="n">smearing_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smearing_widget</span><span class="o">.</span><span class="n">state</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lblCurrentSmearing</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">smearing</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculateQGridForModel</span><span class="p">()</span></div>

<div class="viewcode-block" id="FittingWidget.recalculatePlotData"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.recalculatePlotData">[docs]</a>    <span class="k">def</span> <span class="nf">recalculatePlotData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a new dataset for model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_is_loaded</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">createDefaultDataset</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">smearing_widget</span><span class="o">.</span><span class="n">updateData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculateQGridForModel</span><span class="p">()</span></div>

<div class="viewcode-block" id="FittingWidget.showTheoryPlot"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.showTheoryPlot">[docs]</a>    <span class="k">def</span> <span class="nf">showTheoryPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Show the current theory plot in MPL</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Show the chart if ready</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">theory_item</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recalculatePlotData</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_data</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_requestPlots</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_data</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">theory_item</span><span class="o">.</span><span class="n">model</span><span class="p">())</span></div>

<div class="viewcode-block" id="FittingWidget.showPlot"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.showPlot">[docs]</a>    <span class="k">def</span> <span class="nf">showPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Show the current plot in MPL</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Show the chart if ready</span>
        <span class="n">data_to_show</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="c1"># Any models for this page</span>
        <span class="n">current_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_index</span><span class="p">]</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_requestPlots</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">current_index</span><span class="o">.</span><span class="n">model</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">item</span><span class="p">:</span>
            <span class="c1"># fit+data has not been shown - show just data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">communicate</span><span class="o">.</span><span class="n">plotRequestedSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">([</span><span class="n">item</span><span class="p">,</span> <span class="n">data_to_show</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tab_id</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_requestPlots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item_name</span><span class="p">,</span> <span class="n">item_model</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Emits plotRequestedSignal for all plots found in the given model under the provided item name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fitpage_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">name</span>
        <span class="n">plots</span> <span class="o">=</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">plotsFromFilename</span><span class="p">(</span><span class="n">item_name</span><span class="p">,</span> <span class="n">item_model</span><span class="p">)</span>
        <span class="c1"># Has the fitted data been shown?</span>
        <span class="n">data_shown</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">item</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">plot</span> <span class="ow">in</span> <span class="n">plots</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">fitpage_name</span> <span class="ow">in</span> <span class="n">plot</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="n">data_shown</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">communicate</span><span class="o">.</span><span class="n">plotRequestedSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">([</span><span class="n">item</span><span class="p">,</span> <span class="n">plot</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tab_id</span><span class="p">)</span>
        <span class="c1"># return the last data item seen, if nothing was plotted; supposed to be just data)</span>
        <span class="k">return</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">data_shown</span> <span class="k">else</span> <span class="n">item</span>

<div class="viewcode-block" id="FittingWidget.onOptionsUpdate"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.onOptionsUpdate">[docs]</a>    <span class="k">def</span> <span class="nf">onOptionsUpdate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update local option values and replot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q_range_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_range_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">npts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_points</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">weighting</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">options_widget</span><span class="o">.</span><span class="n">state</span><span class="p">()</span>
        <span class="c1"># set Q range labels on the main tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lblMinRangeDef</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">GuiUtils</span><span class="o">.</span><span class="n">formatNumber</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q_range_min</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lblMaxRangeDef</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">GuiUtils</span><span class="o">.</span><span class="n">formatNumber</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q_range_max</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recalculatePlotData</span><span class="p">()</span></div>

<div class="viewcode-block" id="FittingWidget.setDefaultStructureCombo"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.setDefaultStructureCombo">[docs]</a>    <span class="k">def</span> <span class="nf">setDefaultStructureCombo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fill in the structure factors combo box with defaults</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">structure_factor_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">master_category_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">CATEGORY_STRUCTURE</span><span class="p">)</span>
        <span class="n">factors</span> <span class="o">=</span> <span class="p">[</span><span class="n">factor</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">factor</span> <span class="ow">in</span> <span class="n">structure_factor_list</span><span class="p">]</span>
        <span class="n">factors</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">STRUCTURE_DEFAULT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbStructureFactor</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbStructureFactor</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">factors</span><span class="p">))</span></div>

<div class="viewcode-block" id="FittingWidget.createDefaultDataset"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.createDefaultDataset">[docs]</a>    <span class="k">def</span> <span class="nf">createDefaultDataset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate default Dataset 1D/2D for the given model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create default datasets if no data passed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is2D</span><span class="p">:</span>
            <span class="n">qmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_range_max</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">qstep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npts</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logic</span><span class="o">.</span><span class="n">createDefault2dData</span><span class="p">(</span><span class="n">qmax</span><span class="p">,</span> <span class="n">qstep</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tab_id</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_points</span><span class="p">:</span>
            <span class="n">qmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">10.0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_range_min</span> <span class="o">&lt;</span> <span class="mf">1.e-10</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q_range_min</span><span class="p">)</span>
            <span class="n">qmax</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_range_max</span> <span class="o">&gt;</span> <span class="mf">1.e10</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q_range_max</span><span class="p">)</span>
            <span class="n">interval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">qmin</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">qmax</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">npts</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">interval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">q_range_min</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">q_range_max</span><span class="p">,</span>
                                   <span class="n">num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">npts</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logic</span><span class="o">.</span><span class="n">createDefault1dData</span><span class="p">(</span><span class="n">interval</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tab_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.readCategoryInfo"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.readCategoryInfo">[docs]</a>    <span class="k">def</span> <span class="nf">readCategoryInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the categories in from file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">master_category_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">by_model_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_enabled_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

        <span class="n">categorization_file</span> <span class="o">=</span> <span class="n">CategoryInstaller</span><span class="o">.</span><span class="n">get_user_file</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">categorization_file</span><span class="p">):</span>
            <span class="n">categorization_file</span> <span class="o">=</span> <span class="n">CategoryInstaller</span><span class="o">.</span><span class="n">get_default_file</span><span class="p">()</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">categorization_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">cat_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">master_category_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">cat_file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">regenerateModelDict</span><span class="p">()</span>

        <span class="c1"># Load the model dict</span>
        <span class="n">models</span> <span class="o">=</span> <span class="n">load_standard_models</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">readCustomCategoryInfo</span><span class="p">()</span></div>

<div class="viewcode-block" id="FittingWidget.readCustomCategoryInfo"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.readCustomCategoryInfo">[docs]</a>    <span class="k">def</span> <span class="nf">readCustomCategoryInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the custom model category</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Looking for plugins</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">custom_models</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">plugin_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">plug</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">plug</span>
            <span class="n">plugin_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">name</span><span class="p">,</span> <span class="kc">True</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">plugin_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">master_category_dict</span><span class="p">[</span><span class="n">CATEGORY_CUSTOM</span><span class="p">]</span> <span class="o">=</span> <span class="n">plugin_list</span></div>

<div class="viewcode-block" id="FittingWidget.regenerateModelDict"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.regenerateModelDict">[docs]</a>    <span class="k">def</span> <span class="nf">regenerateModelDict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Regenerates self.by_model_dict which has each model name as the</span>
<span class="sd">        key and the list of categories belonging to that model</span>
<span class="sd">        along with the enabled mapping</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">by_model_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">master_category_dict</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">enabled</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">master_category_dict</span><span class="p">[</span><span class="n">category</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">by_model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">category</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_enabled_dict</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">enabled</span></div>

<div class="viewcode-block" id="FittingWidget.addBackgroundToModel"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.addBackgroundToModel">[docs]</a>    <span class="k">def</span> <span class="nf">addBackgroundToModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds background parameter with default values to the model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItemModel</span><span class="p">)</span>
        <span class="n">checked_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">,</span> <span class="s1">&#39;0.001&#39;</span><span class="p">,</span> <span class="s1">&#39;-inf&#39;</span><span class="p">,</span> <span class="s1">&#39;inf&#39;</span><span class="p">,</span> <span class="s1">&#39;1/cm&#39;</span><span class="p">]</span>
        <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">addCheckedListToModel</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">checked_list</span><span class="p">)</span>
        <span class="n">last_row</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">last_row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setEditable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">last_row</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">setEditable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.addScaleToModel"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.addScaleToModel">[docs]</a>    <span class="k">def</span> <span class="nf">addScaleToModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds scale parameter with default values to the model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItemModel</span><span class="p">)</span>
        <span class="n">checked_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">,</span> <span class="s1">&#39;1.0&#39;</span><span class="p">,</span> <span class="s1">&#39;0.0&#39;</span><span class="p">,</span> <span class="s1">&#39;inf&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>
        <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">addCheckedListToModel</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">checked_list</span><span class="p">)</span>
        <span class="n">last_row</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">last_row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setEditable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">last_row</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">setEditable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.addWeightingToData"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.addWeightingToData">[docs]</a>    <span class="k">def</span> <span class="nf">addWeightingToData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds weighting contribution to fitting data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="c1"># Send original data for weighting</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">getWeight</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">is2d</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is2D</span><span class="p">,</span> <span class="n">flag</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">weighting</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is2D</span><span class="p">:</span>
            <span class="n">new_data</span><span class="o">.</span><span class="n">err_data</span> <span class="o">=</span> <span class="n">weight</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_data</span><span class="o">.</span><span class="n">dy</span> <span class="o">=</span> <span class="n">weight</span>

        <span class="k">return</span> <span class="n">new_data</span></div>

<div class="viewcode-block" id="FittingWidget.updateQRange"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.updateQRange">[docs]</a>    <span class="k">def</span> <span class="nf">updateQRange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates Q Range display</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_is_loaded</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">q_range_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_range_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">npts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic</span><span class="o">.</span><span class="n">computeDataRange</span><span class="p">()</span>
        <span class="c1"># set Q range labels on the main tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lblMinRangeDef</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">GuiUtils</span><span class="o">.</span><span class="n">formatNumber</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q_range_min</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lblMaxRangeDef</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">GuiUtils</span><span class="o">.</span><span class="n">formatNumber</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q_range_max</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

        <span class="c1"># set Q range labels on the options tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options_widget</span><span class="o">.</span><span class="n">updateQRange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q_range_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_range_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">npts</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.SASModelToQModel"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.SASModelToQModel">[docs]</a>    <span class="k">def</span> <span class="nf">SASModelToQModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">structure_factor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Setting model parameters into table based on selected category</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Crete/overwrite model items</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">model_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">structure_factor</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;None&quot;</span><span class="p">):</span>
                <span class="c1"># S(Q) on its own, treat the same as a form factor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fromStructureFactorToQModel</span><span class="p">(</span><span class="n">structure_factor</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># No models selected</span>
                <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fromModelToQModel</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addExtraShells</span><span class="p">()</span>

            <span class="c1"># Allow the SF combobox visibility for the given sasmodel</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enableStructureFactorControl</span><span class="p">(</span><span class="n">structure_factor</span><span class="p">)</span>

            <span class="c1"># Add S(Q)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbStructureFactor</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">():</span>
                <span class="n">structure_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbStructureFactor</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fromStructureFactorToQModel</span><span class="p">(</span><span class="n">structure_factor</span><span class="p">)</span>

            <span class="c1"># Add polydispersity to the model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">poly_params</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setPolyModel</span><span class="p">()</span>
            <span class="c1"># Add magnetic parameters to the model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">magnet_params</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setMagneticModel</span><span class="p">()</span>

        <span class="c1"># Now we claim the model has been loaded</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_is_loaded</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># Change the model name to a monicker</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelName</span><span class="p">()</span>
        <span class="c1"># Update the smearing tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smearing_widget</span><span class="o">.</span><span class="n">updateKernelModel</span><span class="p">(</span><span class="n">kernel_model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="p">)</span>

        <span class="c1"># (Re)-create headers</span>
        <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">addHeadersToModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">header</span><span class="p">()</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boldFont</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.fromModelToQModel"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.fromModelToQModel">[docs]</a>    <span class="k">def</span> <span class="nf">fromModelToQModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Setting model parameters into QStandardItemModel based on selected model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">model_name</span>
        <span class="n">kernel_module</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbCategory</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="n">CATEGORY_CUSTOM</span><span class="p">:</span>
            <span class="c1"># custom kernel load requires full path</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">find_plugins_dir</span><span class="p">(),</span> <span class="n">model_name</span><span class="o">+</span><span class="s2">&quot;.py&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">kernel_module</span> <span class="o">=</span> <span class="n">generate</span><span class="o">.</span><span class="n">load_kernel_module</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ModuleNotFoundError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="c1"># can happen when name attribute not the same as actual filename</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="n">kernel_module</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># mismatch between &quot;name&quot; attribute and actual filename.</span>
            <span class="n">curr_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">curr_model</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">kernel_module</span> <span class="o">=</span> <span class="n">generate</span><span class="o">.</span><span class="n">load_kernel_module</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">ModuleNotFoundError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Can&#39;t find the model &quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">))</span>
                <span class="k">return</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">kernel_module</span><span class="p">,</span> <span class="s1">&#39;parameters&#39;</span><span class="p">):</span>
            <span class="c1"># built-in and custom models</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span> <span class="o">=</span> <span class="n">modelinfo</span><span class="o">.</span><span class="n">make_parameter_table</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">kernel_module</span><span class="p">,</span> <span class="s1">&#39;parameters&#39;</span><span class="p">,</span> <span class="p">[]))</span>

        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">kernel_module</span><span class="p">,</span> <span class="s1">&#39;model_info&#39;</span><span class="p">):</span>
            <span class="c1"># for sum/multiply models</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span> <span class="o">=</span> <span class="n">kernel_module</span><span class="o">.</span><span class="n">model_info</span><span class="o">.</span><span class="n">parameters</span>

        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">kernel_module</span><span class="p">,</span> <span class="s1">&#39;Model&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="s2">&quot;_model_info&quot;</span><span class="p">):</span>
            <span class="c1"># this probably won&#39;t work if there&#39;s no model_info, but just in case</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span> <span class="o">=</span> <span class="n">kernel_module</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">_model_info</span><span class="o">.</span><span class="n">parameters</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># no parameters - default to blank table</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No parameters found in model &#39;</span><span class="si">{}</span><span class="s2">&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span> <span class="o">=</span> <span class="n">modelinfo</span><span class="o">.</span><span class="n">ParameterTable</span><span class="p">([])</span>

        <span class="c1"># Instantiate the current sasmodel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">model_name</span><span class="p">]()</span>

        <span class="c1"># Change the model name to a monicker</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelName</span><span class="p">()</span>

        <span class="c1"># Explicitly add scale and background with default values</span>
        <span class="n">temp_undo_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">undo_supported</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">undo_supported</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addScaleToModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addBackgroundToModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">undo_supported</span> <span class="o">=</span> <span class="n">temp_undo_state</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">shell_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shellNamesList</span><span class="p">()</span>

        <span class="c1"># Add heading row</span>
        <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">addHeadingRowToModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span>

        <span class="c1"># Update the QModel</span>
        <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">addParametersToModel</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is2D</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.fromStructureFactorToQModel"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.fromStructureFactorToQModel">[docs]</a>    <span class="k">def</span> <span class="nf">fromStructureFactorToQModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure_factor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Setting model parameters into QStandardItemModel based on selected structure factor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">structure_factor</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">structure_factor</span><span class="o">==</span><span class="s2">&quot;None&quot;</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">product_params</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">kernel_module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">structure_factor</span><span class="p">]()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span> <span class="o">=</span> <span class="n">kernel_module</span>
            <span class="c1"># Structure factor is the only selected model; build it and show all its params</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelName</span><span class="p">()</span>
            <span class="n">s_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">_model_info</span><span class="o">.</span><span class="n">parameters</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Assure we only have one volfraction shown</span>
            <span class="n">s_params</span><span class="p">,</span> <span class="n">product_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volfraction_hack</span><span class="p">(</span><span class="n">kernel_module</span><span class="p">)</span>

        <span class="c1"># Add heading row</span>
        <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">addHeadingRowToModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="p">,</span> <span class="n">structure_factor</span><span class="p">)</span>

        <span class="c1"># Get new rows for QModel</span>
        <span class="c1"># Any renamed parameters are stored as data in the relevant item, for later handling</span>
        <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">addSimpleParametersToModel</span><span class="p">(</span>
                <span class="n">parameters</span><span class="o">=</span><span class="n">s_params</span><span class="p">,</span>
                <span class="n">is2D</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is2D</span><span class="p">,</span>
                <span class="n">parameters_original</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="p">,</span>
                <span class="n">view</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="p">)</span>

        <span class="c1"># Insert product-only params into QModel</span>
        <span class="k">if</span> <span class="n">product_params</span><span class="p">:</span>
            <span class="n">prod_rows</span> <span class="o">=</span> <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">addSimpleParametersToModel</span><span class="p">(</span>
                    <span class="n">parameters</span><span class="o">=</span><span class="n">product_params</span><span class="p">,</span>
                    <span class="n">is2D</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is2D</span><span class="p">,</span>
                    <span class="n">parameters_original</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="p">,</span>
                    <span class="n">view</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="p">,</span>
                    <span class="n">row_num</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

            <span class="c1"># Since this all happens after shells are dealt with and we&#39;ve inserted rows, fix this counter</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_n_shells_row</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prod_rows</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_volfraction_hack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s_kernel</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Only show volfraction once if it appears in both P and S models.</span>
<span class="sd">        Issues SV:1280, SV:1295, SM:219, SM:199, SM:101</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">sasmodels.product</span> <span class="kn">import</span> <span class="n">VOLFRAC_ID</span><span class="p">,</span> <span class="n">RADIUS_ID</span><span class="p">,</span> <span class="n">RADIUS_MODE_ID</span><span class="p">,</span> <span class="n">STRUCTURE_MODE_ID</span>

        <span class="n">product_params</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">p_kernel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span>
        <span class="c1"># need to reset multiplicity to get the right product</span>
        <span class="k">if</span> <span class="n">p_kernel</span><span class="o">.</span><span class="n">is_multiplicity_model</span><span class="p">:</span>
            <span class="n">p_kernel</span><span class="o">.</span><span class="n">multiplicity</span> <span class="o">=</span> <span class="n">p_kernel</span><span class="o">.</span><span class="n">multiplicity_info</span><span class="o">.</span><span class="n">number</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span> <span class="o">=</span> <span class="n">MultiplicationModel</span><span class="p">(</span><span class="n">p_kernel</span><span class="p">,</span> <span class="n">s_kernel</span><span class="p">)</span>
        <span class="c1"># Modify the name to correspond to shown items</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelName</span><span class="p">()</span>

        <span class="c1"># TODO: set model layout in sasmodels</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">_model_info</span>
        <span class="n">p_info</span> <span class="o">=</span> <span class="n">p_kernel</span><span class="o">.</span><span class="n">_model_info</span>
        <span class="n">s_info</span> <span class="o">=</span> <span class="n">s_kernel</span><span class="o">.</span><span class="n">_model_info</span>

        <span class="k">def</span> <span class="nf">par_index</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">kernel_parameters</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">k</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">p_volfrac_id</span> <span class="o">=</span> <span class="n">par_index</span><span class="p">(</span><span class="n">p_info</span><span class="p">,</span> <span class="n">VOLFRAC_ID</span><span class="p">)</span>
        <span class="n">s_volfrac_id</span> <span class="o">=</span> <span class="n">par_index</span><span class="p">(</span><span class="n">s_info</span><span class="p">,</span> <span class="n">VOLFRAC_ID</span><span class="p">)</span>
        <span class="n">s_pars</span> <span class="o">=</span> <span class="n">s_info</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">kernel_parameters</span><span class="p">[:]</span>
        <span class="k">if</span> <span class="n">p_volfrac_id</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">s_volfrac_id</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">s_pars</span><span class="p">[</span><span class="n">s_volfrac_id</span><span class="p">]</span>

        <span class="n">er_mode_id</span> <span class="o">=</span> <span class="n">par_index</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">RADIUS_MODE_ID</span><span class="p">)</span>
        <span class="n">interaction_mode_id</span> <span class="o">=</span> <span class="n">par_index</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">STRUCTURE_MODE_ID</span><span class="p">)</span>
        <span class="n">extras</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">interaction_mode_id</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">extras</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">kernel_parameters</span><span class="p">[</span><span class="n">interaction_mode_id</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">er_mode_id</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">extras</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">kernel_parameters</span><span class="p">[</span><span class="n">er_mode_id</span><span class="p">])</span>

        <span class="n">s_params</span> <span class="o">=</span> <span class="n">modelinfo</span><span class="o">.</span><span class="n">ParameterTable</span><span class="p">(</span><span class="n">s_pars</span><span class="p">)</span>
        <span class="n">product_params</span> <span class="o">=</span> <span class="n">modelinfo</span><span class="o">.</span><span class="n">ParameterTable</span><span class="p">(</span><span class="n">extras</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">s_params</span><span class="p">,</span> <span class="n">product_params</span><span class="p">)</span>

<div class="viewcode-block" id="FittingWidget.haveParamsToFit"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.haveParamsToFit">[docs]</a>    <span class="k">def</span> <span class="nf">haveParamsToFit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds out if there are any parameters ready to be fitted</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic</span><span class="o">.</span><span class="n">data_is_loaded</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_params_to_fit</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chkPolydispersity</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">poly_params_to_fit</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chkMagnetism</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">canHaveMagnetism</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">magnet_params_to_fit</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="FittingWidget.onMainParamsChange"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.onMainParamsChange">[docs]</a>    <span class="k">def</span> <span class="nf">onMainParamsChange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback method for updating the sasmodel parameters with the GUI values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">itemFromIndex</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>

        <span class="n">model_column</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">model_column</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkboxSelected</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmdFit</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">haveParamsToFit</span><span class="p">())</span>
            <span class="c1"># Update state stack</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateUndo</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="n">model_row</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="n">name_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">model_row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">name_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">itemFromIndex</span><span class="p">(</span><span class="n">name_index</span><span class="p">)</span>

        <span class="c1"># Extract changed value.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">toDouble</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="c1"># Unparsable field</span>
            <span class="k">return</span>

        <span class="c1"># if the item has user data, this is the actual parameter name (e.g. to handle duplicate names)</span>
        <span class="k">if</span> <span class="n">name_item</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">UserRole</span><span class="p">):</span>
            <span class="n">parameter_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">name_item</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">UserRole</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parameter_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">name_index</span><span class="p">))</span>

        <span class="c1"># Update the parameter value - note: this supports +/-inf as well</span>
        <span class="n">param_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">itemDelegate</span><span class="p">()</span><span class="o">.</span><span class="n">param_value</span>
        <span class="n">min_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">itemDelegate</span><span class="p">()</span><span class="o">.</span><span class="n">param_min</span>
        <span class="n">max_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">itemDelegate</span><span class="p">()</span><span class="o">.</span><span class="n">param_max</span>
        <span class="k">if</span> <span class="n">model_column</span> <span class="o">==</span> <span class="n">param_column</span><span class="p">:</span>
            <span class="c1"># don&#39;t try to update multiplicity counters if they aren&#39;t there.</span>
            <span class="c1"># Note that this will fail for proper bad update where the model</span>
            <span class="c1"># doesn&#39;t contain multiplicity parameter</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">parameter_name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">model_column</span> <span class="o">==</span> <span class="n">min_column</span><span class="p">:</span>
            <span class="c1"># min/max to be changed in self.kernel_module.details[parameter_name] = [&#39;Ang&#39;, 0.0, inf]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">details</span><span class="p">[</span><span class="n">parameter_name</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">model_column</span> <span class="o">==</span> <span class="n">max_column</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">details</span><span class="p">[</span><span class="n">parameter_name</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># don&#39;t update the chart</span>
            <span class="k">return</span>

        <span class="c1"># TODO: magnetic params in self.kernel_module.details[&#39;M0:parameter_name&#39;] = value</span>
        <span class="c1"># TODO: multishell params in self.kernel_module.details[??] = value</span>

        <span class="c1"># handle display of effective radius parameter according to radius_effective_mode; pass ER into model if</span>
        <span class="c1"># necessary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processEffectiveRadius</span><span class="p">()</span>

        <span class="c1"># Force the chart update when actual parameters changed</span>
        <span class="k">if</span> <span class="n">model_column</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recalculatePlotData</span><span class="p">()</span>

        <span class="c1"># Update state stack</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateUndo</span><span class="p">()</span></div>

<div class="viewcode-block" id="FittingWidget.processEffectiveRadius"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.processEffectiveRadius">[docs]</a>    <span class="k">def</span> <span class="nf">processEffectiveRadius</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks the value of radius_effective_mode, if existent, and processes radius_effective as necessary.</span>
<span class="sd">        * mode == 0: This means &#39;unconstrained&#39;; ensure use can specify ER.</span>
<span class="sd">        * mode &gt; 0: This means it is constrained to a P(Q)-computed value in sasmodels; prevent user from editing ER.</span>

<span class="sd">        Note: If ER has been computed, it is passed back to SasView as an intermediate result. That value must be</span>
<span class="sd">        displayed for the user; that is not dealt with here, but in complete1D.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ER_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRowFromName</span><span class="p">(</span><span class="s2">&quot;radius_effective&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ER_row</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">ER_mode_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRowFromName</span><span class="p">(</span><span class="s2">&quot;radius_effective_mode&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ER_mode_row</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">ER_mode</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">ER_mode_row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;radius_effective_mode was set to an invalid value.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">ER_mode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># ensure the ER value can be modified by user</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setParamEditableByRow</span><span class="p">(</span><span class="n">ER_row</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ER_mode</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># ensure the ER value cannot be modified by user</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setParamEditableByRow</span><span class="p">(</span><span class="n">ER_row</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;radius_effective_mode was set to an invalid value.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.setParamEditableByRow"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.setParamEditableByRow">[docs]</a>    <span class="k">def</span> <span class="nf">setParamEditableByRow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">editable</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets whether the user can edit a parameter in the table. If they cannot, the parameter name&#39;s font is changed,</span>
<span class="sd">        the value itself cannot be edited if clicked on, and the parameter may not be fitted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">item_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">item_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">item_value</span><span class="o">.</span><span class="n">setEditable</span><span class="p">(</span><span class="n">editable</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">editable</span><span class="p">:</span>
            <span class="c1"># reset font</span>
            <span class="n">item_name</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QFont</span><span class="p">())</span>
            <span class="c1"># reset colour</span>
            <span class="n">item_name</span><span class="o">.</span><span class="n">setForeground</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QBrush</span><span class="p">())</span>
            <span class="c1"># make checkable</span>
            <span class="n">item_name</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># change font</span>
            <span class="n">font</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFont</span><span class="p">()</span>
            <span class="n">font</span><span class="o">.</span><span class="n">setItalic</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">item_name</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>
            <span class="c1"># change colour</span>
            <span class="n">item_name</span><span class="o">.</span><span class="n">setForeground</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QBrush</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QColor</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">)))</span>
            <span class="c1"># make not checkable (and uncheck)</span>
            <span class="n">item_name</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>
            <span class="n">item_name</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.isCheckable"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.isCheckable">[docs]</a>    <span class="k">def</span> <span class="nf">isCheckable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">isCheckable</span><span class="p">()</span></div>

<div class="viewcode-block" id="FittingWidget.selectCheckbox"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.selectCheckbox">[docs]</a>    <span class="k">def</span> <span class="nf">selectCheckbox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select the checkbox in given row.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="mi">0</span><span class="o">&lt;=</span> <span class="n">row</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">itemFromIndex</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.checkboxSelected"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.checkboxSelected">[docs]</a>    <span class="k">def</span> <span class="nf">checkboxSelected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="c1"># Assure we&#39;re dealing with checkboxes</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="o">.</span><span class="n">isCheckable</span><span class="p">():</span>
            <span class="k">return</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span>

        <span class="c1"># If multiple rows selected - toggle all of them, filtering uncheckable</span>
        <span class="c1"># Convert to proper indices and set requested enablement</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setParameterSelection</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>

        <span class="c1"># update the list of parameters to fit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_params_to_fit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkedListFromModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.checkedListFromModel"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.checkedListFromModel">[docs]</a>    <span class="k">def</span> <span class="nf">checkedListFromModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns list of checked parameters for given model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">isChecked</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span>

        <span class="k">return</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="k">for</span> <span class="n">row_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">rowCount</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">isChecked</span><span class="p">(</span><span class="n">row_index</span><span class="p">)]</span></div>

<div class="viewcode-block" id="FittingWidget.createNewIndex"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.createNewIndex">[docs]</a>    <span class="k">def</span> <span class="nf">createNewIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fitted_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a model or theory index with passed Data1D/Data2D</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_is_loaded</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">fitted_data</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nameForFittedData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
                <span class="n">fitted_data</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">name</span>
                <span class="n">fitted_data</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
                <span class="n">fitted_data</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">name</span>
                <span class="n">fitted_data</span><span class="o">.</span><span class="n">symbol</span> <span class="o">=</span> <span class="s2">&quot;Line&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateModelIndex</span><span class="p">(</span><span class="n">fitted_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">fitted_data</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nameForFittedData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">fitted_data</span><span class="o">.</span><span class="n">name</span>
            <span class="n">fitted_data</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">name</span>
            <span class="n">fitted_data</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">name</span>
            <span class="n">fitted_data</span><span class="o">.</span><span class="n">symbol</span> <span class="o">=</span> <span class="s2">&quot;Line&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">createTheoryIndex</span><span class="p">(</span><span class="n">fitted_data</span><span class="p">)</span>
            <span class="c1"># Switch to the theory tab for user&#39;s glee</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">communicate</span><span class="o">.</span><span class="n">changeDataExplorerTabSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.updateModelIndex"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.updateModelIndex">[docs]</a>    <span class="k">def</span> <span class="nf">updateModelIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fitted_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update a QStandardModelIndex containing model data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nameFromData</span><span class="p">(</span><span class="n">fitted_data</span><span class="p">)</span>
        <span class="c1"># Make this a line if no other defined</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fitted_data</span><span class="p">,</span> <span class="s1">&#39;symbol&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">fitted_data</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fitted_data</span><span class="o">.</span><span class="n">symbol</span> <span class="o">=</span> <span class="s1">&#39;Line&#39;</span>
        <span class="c1"># Notify the GUI manager so it can update the main model in DataExplorer</span>
        <span class="n">GuiUtils</span><span class="o">.</span><span class="n">updateModelItemWithPlot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_index</span><span class="p">],</span> <span class="n">fitted_data</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.createTheoryIndex"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.createTheoryIndex">[docs]</a>    <span class="k">def</span> <span class="nf">createTheoryIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fitted_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a QStandardModelIndex containing model data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nameFromData</span><span class="p">(</span><span class="n">fitted_data</span><span class="p">)</span>
        <span class="c1"># Modify the item or add it if new</span>
        <span class="n">theory_item</span> <span class="o">=</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">createModelItemWithPlot</span><span class="p">(</span><span class="n">fitted_data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">communicate</span><span class="o">.</span><span class="n">updateTheoryFromPerspectiveSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">theory_item</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.setTheoryItem"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.setTheoryItem">[docs]</a>    <span class="k">def</span> <span class="nf">setTheoryItem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reset the theory item based on the data explorer update</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theory_item</span> <span class="o">=</span> <span class="n">item</span></div>

<div class="viewcode-block" id="FittingWidget.nameFromData"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.nameFromData">[docs]</a>    <span class="k">def</span> <span class="nf">nameFromData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fitted_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return name for the dataset. Terribly impure function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fitted_data</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nameForFittedData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logic</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">fitted_data</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">name</span>
            <span class="n">fitted_data</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
            <span class="n">fitted_data</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">fitted_data</span><span class="o">.</span><span class="n">name</span>
        <span class="k">return</span> <span class="n">name</span></div>

<div class="viewcode-block" id="FittingWidget.methodCalculateForData"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.methodCalculateForData">[docs]</a>    <span class="k">def</span> <span class="nf">methodCalculateForData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return the method for data calculation&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">Calc1D</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">Data1D</span><span class="p">)</span> <span class="k">else</span> <span class="n">Calc2D</span></div>

<div class="viewcode-block" id="FittingWidget.methodCompleteForData"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.methodCompleteForData">[docs]</a>    <span class="k">def</span> <span class="nf">methodCompleteForData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return the method for result parsin on calc complete &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">completed1D</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">Data1D</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">completed2D</span></div>

<div class="viewcode-block" id="FittingWidget.updateKernelModelWithExtraParams"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.updateKernelModelWithExtraParams">[docs]</a>    <span class="k">def</span> <span class="nf">updateKernelModelWithExtraParams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates kernel model &#39;model&#39; with extra parameters from</span>
<span class="sd">        the polydisp and magnetism tab, if the tabs are enabled</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;setParam&#39;</span><span class="p">):</span> <span class="k">return</span>

        <span class="c1"># add polydisperse parameters if asked</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chkPolydispersity</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">poly_params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">model</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="c1"># add magnetic params if asked</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chkMagnetism</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">canHaveMagnetism</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">magnet_params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">model</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.calculateQGridForModelExt"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.calculateQGridForModelExt">[docs]</a>    <span class="k">def</span> <span class="nf">calculateQGridForModelExt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">completefn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_threads</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrapper for Calc1D/2D calls</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateKernelModelWithExtraParams</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">completefn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">completefn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">methodCompleteForData</span><span class="p">()</span>
        <span class="n">smearer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smearing_widget</span><span class="o">.</span><span class="n">smearer</span><span class="p">()</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">getWeight</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">is2d</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is2D</span><span class="p">,</span> <span class="n">flag</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">weighting</span><span class="p">)</span>

        <span class="c1"># Disable buttons/table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disableInteractiveElementsOnCalculate</span><span class="p">()</span>
        <span class="c1"># Awful API to a backend method.</span>
        <span class="n">calc_thread</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">methodCalculateForData</span><span class="p">()(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                                               <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
                                               <span class="n">page_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                               <span class="n">qmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">q_range_min</span><span class="p">,</span>
                                               <span class="n">qmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">q_range_max</span><span class="p">,</span>
                                               <span class="n">smearer</span><span class="o">=</span><span class="n">smearer</span><span class="p">,</span>
                                               <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                               <span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">,</span>
                                               <span class="n">fid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                               <span class="n">toggle_mode_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                               <span class="n">completefn</span><span class="o">=</span><span class="n">completefn</span><span class="p">,</span>
                                               <span class="n">update_chisqr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                               <span class="n">exception_handler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calcException</span><span class="p">,</span>
                                               <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_threads</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">LocalConfig</span><span class="o">.</span><span class="n">USING_TWISTED</span><span class="p">:</span>
                <span class="c1"># start the thread with twisted</span>
                <span class="n">thread</span> <span class="o">=</span> <span class="n">threads</span><span class="o">.</span><span class="n">deferToThread</span><span class="p">(</span><span class="n">calc_thread</span><span class="o">.</span><span class="n">compute</span><span class="p">)</span>
                <span class="n">thread</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">completefn</span><span class="p">)</span>
                <span class="n">thread</span><span class="o">.</span><span class="n">addErrback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calculateDataFailed</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Use the old python threads + Queue</span>
                <span class="n">calc_thread</span><span class="o">.</span><span class="n">queue</span><span class="p">()</span>
                <span class="n">calc_thread</span><span class="o">.</span><span class="n">ready</span><span class="p">(</span><span class="mf">2.5</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">calc_thread</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
            <span class="n">completefn</span><span class="p">(</span><span class="n">results</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.calculateQGridForModel"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.calculateQGridForModel">[docs]</a>    <span class="k">def</span> <span class="nf">calculateQGridForModel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare the fitting data object, based on current ModelModel</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculateQGridForModelExt</span><span class="p">()</span></div>

<div class="viewcode-block" id="FittingWidget.calculateDataFailed"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.calculateDataFailed">[docs]</a>    <span class="k">def</span> <span class="nf">calculateDataFailed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reason</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Thread returned error</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Bring the GUI to normal state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enableInteractiveElements</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculate Data failed with &quot;</span><span class="p">,</span> <span class="n">reason</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.completed1D"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.completed1D">[docs]</a>    <span class="k">def</span> <span class="nf">completed1D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Calc1DFinishedSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">return_data</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.completed2D"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.completed2D">[docs]</a>    <span class="k">def</span> <span class="nf">completed2D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Calc2DFinishedSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">return_data</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_appendPlotsPolyDisp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_plots</span><span class="p">,</span> <span class="n">return_data</span><span class="p">,</span> <span class="n">fitted_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal helper for 1D and 2D for creating plots of the polydispersity distribution for</span>
<span class="sd">        parameters which have a polydispersity enabled.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">plot</span> <span class="ow">in</span> <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">plotPolydispersities</span><span class="p">(</span><span class="n">return_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)):</span>
            <span class="n">data_id</span> <span class="o">=</span> <span class="n">fitted_data</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">plot</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> [</span><span class="si">{}</span><span class="s2">] </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data_id</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">plot</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_id</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
            <span class="n">data_name</span> <span class="o">=</span> <span class="n">fitted_data</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">plot</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">data_name</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">plot</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">+</span> <span class="n">data_name</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">createNewIndex</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>
            <span class="n">new_plots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>

<div class="viewcode-block" id="FittingWidget.complete1D"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.complete1D">[docs]</a>    <span class="k">def</span> <span class="nf">complete1D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the current 1D data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Bring the GUI to normal state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enableInteractiveElements</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">return_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">fitted_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic</span><span class="o">.</span><span class="n">new1DPlot</span><span class="p">(</span><span class="n">return_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tab_id</span><span class="p">)</span>

        <span class="c1"># Fits of Sesans data are in real space</span>
        <span class="k">if</span> <span class="n">return_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isSesans</span><span class="p">:</span>
            <span class="n">fitted_data</span><span class="o">.</span><span class="n">xtransform</span><span class="o">=</span><span class="s2">&quot;x&quot;</span>
            <span class="n">fitted_data</span><span class="o">.</span><span class="n">ytransform</span><span class="o">=</span><span class="s2">&quot;y&quot;</span>

        <span class="c1"># assure the current index is set properly for batch</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logic</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">logic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logic</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">logic</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">fitted_data</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data_index</span> <span class="o">=</span> <span class="n">i</span>

        <span class="n">residuals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculateResiduals</span><span class="p">(</span><span class="n">fitted_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_data</span> <span class="o">=</span> <span class="n">fitted_data</span>
        <span class="n">new_plots</span> <span class="o">=</span> <span class="p">[</span><span class="n">fitted_data</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">residuals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_plots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_is_loaded</span><span class="p">:</span>
            <span class="c1"># delete any plots associated with the data that were not updated</span>
            <span class="c1"># (e.g. to remove beta(Q), S_eff(Q))</span>
            <span class="n">GuiUtils</span><span class="o">.</span><span class="n">deleteRedundantPlots</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_index</span><span class="p">],</span> <span class="n">new_plots</span><span class="p">)</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># delete theory items for the model, in order to get rid of any</span>
            <span class="c1"># redundant items, e.g. beta(Q), S_eff(Q)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">communicate</span><span class="o">.</span><span class="n">deleteIntermediateTheoryPlotsSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_appendPlotsPolyDisp</span><span class="p">(</span><span class="n">new_plots</span><span class="p">,</span> <span class="n">return_data</span><span class="p">,</span> <span class="n">fitted_data</span><span class="p">)</span>

        <span class="c1"># Create plots for intermediate product data</span>
        <span class="n">plots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic</span><span class="o">.</span><span class="n">new1DProductPlots</span><span class="p">(</span><span class="n">return_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tab_id</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">plot</span> <span class="ow">in</span> <span class="n">plots</span><span class="p">:</span>
            <span class="n">plot</span><span class="o">.</span><span class="n">symbol</span> <span class="o">=</span> <span class="s2">&quot;Line&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">createNewIndex</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>
            <span class="n">new_plots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">plot</span> <span class="ow">in</span> <span class="n">new_plots</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">communicate</span><span class="o">.</span><span class="n">plotUpdateSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">([</span><span class="n">plot</span><span class="p">])</span>
            <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>

        <span class="c1"># Update radius_effective if relevant</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateEffectiveRadius</span><span class="p">(</span><span class="n">return_data</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.complete2D"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.complete2D">[docs]</a>    <span class="k">def</span> <span class="nf">complete2D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the current 2D data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Bring the GUI to normal state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enableInteractiveElements</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">return_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">fitted_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic</span><span class="o">.</span><span class="n">new2DPlot</span><span class="p">(</span><span class="n">return_data</span><span class="p">)</span>
        <span class="c1"># assure the current index is set properly for batch</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logic</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">logic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logic</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">logic</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">fitted_data</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data_index</span> <span class="o">=</span> <span class="n">i</span>

        <span class="n">residuals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculateResiduals</span><span class="p">(</span><span class="n">fitted_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_data</span> <span class="o">=</span> <span class="n">fitted_data</span>
        <span class="n">new_plots</span> <span class="o">=</span> <span class="p">[</span><span class="n">fitted_data</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">residuals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_plots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_appendPlotsPolyDisp</span><span class="p">(</span><span class="n">new_plots</span><span class="p">,</span> <span class="n">return_data</span><span class="p">,</span> <span class="n">fitted_data</span><span class="p">)</span>

        <span class="c1"># Update/generate plots</span>
        <span class="k">for</span> <span class="n">plot</span> <span class="ow">in</span> <span class="n">new_plots</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">communicate</span><span class="o">.</span><span class="n">plotUpdateSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">([</span><span class="n">plot</span><span class="p">])</span></div>

<div class="viewcode-block" id="FittingWidget.updateEffectiveRadius"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.updateEffectiveRadius">[docs]</a>    <span class="k">def</span> <span class="nf">updateEffectiveRadius</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given return data from sasmodels, update the effective radius parameter in the GUI table with the new</span>
<span class="sd">        calculated value as returned by sasmodels (if the value was returned).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ER_mode_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRowFromName</span><span class="p">(</span><span class="s2">&quot;radius_effective_mode&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ER_mode_row</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ER_mode</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">ER_mode_row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;radius_effective_mode was set to an invalid value.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">ER_mode</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># does not need updating if it is not being computed</span>
            <span class="k">return</span>

        <span class="n">ER_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRowFromName</span><span class="p">(</span><span class="s2">&quot;radius_effective&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ER_row</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">scalar_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic</span><span class="o">.</span><span class="n">getScalarIntermediateResults</span><span class="p">(</span><span class="n">return_data</span><span class="p">)</span>
        <span class="n">ER_value</span> <span class="o">=</span> <span class="n">scalar_results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;radius_effective&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ER_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1"># ensure the model does not recompute when updating the value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">ER_row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ER_value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># ensure the view is updated immediately</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">layoutChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span></div>

<div class="viewcode-block" id="FittingWidget.calculateResiduals"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.calculateResiduals">[docs]</a>    <span class="k">def</span> <span class="nf">calculateResiduals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fitted_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate and print Chi2 and display chart of residuals. Returns residuals plot object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create a new index for holding data</span>
        <span class="n">fitted_data</span><span class="o">.</span><span class="n">symbol</span> <span class="o">=</span> <span class="s2">&quot;Line&quot;</span>

        <span class="c1"># Modify fitted_data with weighting</span>
        <span class="n">weighted_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addWeightingToData</span><span class="p">(</span><span class="n">fitted_data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">createNewIndex</span><span class="p">(</span><span class="n">weighted_data</span><span class="p">)</span>

        <span class="c1"># Plot residuals if actual data</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_is_loaded</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Calculate difference between return_data and logic.data</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">getWeight</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">is2D</span><span class="p">,</span> <span class="n">flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weighting</span><span class="p">)</span>
        <span class="c1"># Recalculate chi2 only for manual parameter change, not after fitting</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitResults</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chi2</span> <span class="o">=</span> <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">calculateChi2</span><span class="p">(</span><span class="n">weighted_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
            <span class="c1"># Update the control</span>
            <span class="n">chi2_repr</span> <span class="o">=</span> <span class="s2">&quot;---&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chi2</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">formatNumber</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chi2</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblChi2Value</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">chi2_repr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitResults</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">residuals_plot</span> <span class="o">=</span> <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">plotResiduals</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">fitted_data</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">residuals_plot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">residuals_plot</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s2">&quot;Residual &quot;</span> <span class="o">+</span> <span class="n">residuals_plot</span><span class="o">.</span><span class="n">id</span>
        <span class="n">residuals_plot</span><span class="o">.</span><span class="n">plot_role</span> <span class="o">=</span> <span class="n">Data1D</span><span class="o">.</span><span class="n">ROLE_RESIDUAL</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createNewIndex</span><span class="p">(</span><span class="n">residuals_plot</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">residuals_plot</span></div>

<div class="viewcode-block" id="FittingWidget.onCategoriesChanged"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.onCategoriesChanged">[docs]</a>    <span class="k">def</span> <span class="nf">onCategoriesChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Reload the category/model comboboxes</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># Store the current combo indices</span>
            <span class="n">current_cat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbCategory</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
            <span class="n">current_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>

            <span class="c1"># reread the category file and repopulate the combo</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbCategory</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbCategory</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">readCategoryInfo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initializeCategoryCombo</span><span class="p">()</span>

            <span class="c1"># Scroll back to the original index in Categories</span>
            <span class="n">new_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbCategory</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="n">current_cat</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">new_index</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cbCategory</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">new_index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbCategory</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1"># ...and in the Models</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">new_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="n">current_model</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">new_index</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">new_index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">return</span></div>

<div class="viewcode-block" id="FittingWidget.calcException"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.calcException">[docs]</a>    <span class="k">def</span> <span class="nf">calcException</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">etype</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">tb</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Thread threw an exception.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Bring the GUI to normal state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enableInteractiveElements</span><span class="p">()</span>
        <span class="c1"># TODO: remimplement thread cancellation</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exception</span><span class="p">(</span><span class="n">etype</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">tb</span><span class="p">)))</span></div>

<div class="viewcode-block" id="FittingWidget.setTableProperties"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.setTableProperties">[docs]</a>    <span class="k">def</span> <span class="nf">setTableProperties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Setting table properties</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Table properties</span>
        <span class="n">table</span><span class="o">.</span><span class="n">verticalHeader</span><span class="p">()</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">setAlternatingRowColors</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">MinimumExpanding</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">setSelectionBehavior</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">SelectRows</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">resizeColumnsToContents</span><span class="p">()</span>

        <span class="c1"># Header</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">()</span>
        <span class="n">header</span><span class="o">.</span><span class="n">setSectionResizeMode</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QHeaderView</span><span class="o">.</span><span class="n">ResizeToContents</span><span class="p">)</span>
        <span class="n">header</span><span class="o">.</span><span class="n">ResizeMode</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QHeaderView</span><span class="o">.</span><span class="n">Interactive</span><span class="p">)</span></div>

        <span class="c1"># Qt5: the following 2 lines crash - figure out why!</span>
        <span class="c1"># Resize column 0 and 7 to content</span>
        <span class="c1">#header.setSectionResizeMode(0, QtWidgets.QHeaderView.ResizeToContents)</span>
        <span class="c1">#header.setSectionResizeMode(7, QtWidgets.QHeaderView.ResizeToContents)</span>

<div class="viewcode-block" id="FittingWidget.setPolyModel"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.setPolyModel">[docs]</a>    <span class="k">def</span> <span class="nf">setPolyModel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set polydispersity values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span><span class="o">.</span><span class="n">form_volume_parameters</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is2D</span><span class="p">:</span>
            <span class="n">parameters</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span><span class="o">.</span><span class="n">orientation_parameters</span>

        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">setPolyModelParameters</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> \
            <span class="nb">enumerate</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">polydisperse</span><span class="p">]</span>

        <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">addPolyHeadersToModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.setPolyModelParameters"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.setPolyModelParameters">[docs]</a>    <span class="k">def</span> <span class="nf">setPolyModelParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Standard of multishell poly parameter driver</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">param_name</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span>
        <span class="c1"># see it the parameter is multishell</span>
        <span class="k">if</span> <span class="s1">&#39;[&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="c1"># Skip empty shells</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_shell_displayed</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Create as many entries as current shells</span>
                <span class="k">for</span> <span class="n">ishell</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_shell_displayed</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="c1"># Remove [n] and add the shell numeral</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">param_name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">param_name</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ishell</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">addNameToPolyModel</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Just create a simple param entry</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addNameToPolyModel</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">param_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.addNameToPolyModel"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.addNameToPolyModel">[docs]</a>    <span class="k">def</span> <span class="nf">addNameToPolyModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">param_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a checked row in the poly model with param_name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Polydisp. values from the sasmodel</span>
        <span class="n">param_wname</span> <span class="o">=</span> <span class="n">param_name</span> <span class="o">+</span> <span class="s1">&#39;.width&#39;</span>
        <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">getParam</span><span class="p">(</span><span class="n">param_wname</span><span class="p">)</span>
        <span class="n">npts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">getParam</span><span class="p">(</span><span class="n">param_name</span> <span class="o">+</span> <span class="s1">&#39;.npts&#39;</span><span class="p">)</span>
        <span class="n">nsigs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">getParam</span><span class="p">(</span><span class="n">param_name</span> <span class="o">+</span> <span class="s1">&#39;.nsigmas&#39;</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">details</span><span class="p">[</span><span class="n">param_wname</span><span class="p">]</span>

        <span class="c1"># Update local param dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poly_params</span><span class="p">[</span><span class="n">param_wname</span><span class="p">]</span> <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poly_params</span><span class="p">[</span><span class="n">param_name</span> <span class="o">+</span> <span class="s1">&#39;.npts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">npts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poly_params</span><span class="p">[</span><span class="n">param_name</span> <span class="o">+</span> <span class="s1">&#39;.nsigmas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nsigs</span>

        <span class="c1"># Construct a row with polydisp. related variable.</span>
        <span class="c1"># This will get added to the polydisp. model</span>
        <span class="c1"># Note: last argument needs extra space padding for decent display of the control</span>
        <span class="n">checked_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Distribution of &quot;</span> <span class="o">+</span> <span class="n">param_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">width</span><span class="p">),</span>
                        <span class="nb">str</span><span class="p">(</span><span class="nb">min</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">),</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">npts</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">nsigs</span><span class="p">),</span> <span class="s2">&quot;gaussian      &quot;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
        <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">addCheckedListToModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="p">,</span> <span class="n">checked_list</span><span class="p">)</span>

        <span class="c1"># All possible polydisp. functions as strings in combobox</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">()</span>
        <span class="n">func</span><span class="o">.</span><span class="n">addItems</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">name_disp</span><span class="p">)</span> <span class="k">for</span> <span class="n">name_disp</span> <span class="ow">in</span> <span class="n">POLYDISPERSITY_MODELS</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
        <span class="c1"># Set the default index</span>
        <span class="n">func</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="n">DEFAULT_POLYDISP_FUNCTION</span><span class="p">))</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lstPoly</span><span class="o">.</span><span class="n">itemDelegate</span><span class="p">()</span><span class="o">.</span><span class="n">poly_function</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lstPoly</span><span class="o">.</span><span class="n">setIndexWidget</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
        <span class="n">func</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">onPolyComboIndexChange</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">currentText</span><span class="p">()),</span> <span class="n">i</span><span class="p">))</span></div>

<div class="viewcode-block" id="FittingWidget.onPolyFilenameChange"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.onPolyFilenameChange">[docs]</a>    <span class="k">def</span> <span class="nf">onPolyFilenameChange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Respond to filename_updated signal from the delegate</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># For the given row, invoke the &quot;array&quot; combo handler</span>
        <span class="n">array_caption</span> <span class="o">=</span> <span class="s1">&#39;array&#39;</span>

        <span class="c1"># Get the combo box reference</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">row_index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstPoly</span><span class="o">.</span><span class="n">itemDelegate</span><span class="p">()</span><span class="o">.</span><span class="n">poly_function</span><span class="p">)</span>
        <span class="n">widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstPoly</span><span class="o">.</span><span class="n">indexWidget</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>

        <span class="c1"># Update the combo box so it displays &quot;array&quot;</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lstPoly</span><span class="o">.</span><span class="n">itemDelegate</span><span class="p">()</span><span class="o">.</span><span class="n">POLYDISPERSE_FUNCTIONS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">array_caption</span><span class="p">))</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Invoke the file reader</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onPolyComboIndexChange</span><span class="p">(</span><span class="n">array_caption</span><span class="p">,</span> <span class="n">row_index</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.onPolyComboIndexChange"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.onPolyComboIndexChange">[docs]</a>    <span class="k">def</span> <span class="nf">onPolyComboIndexChange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">combo_string</span><span class="p">,</span> <span class="n">row_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Modify polydisp. defaults on function choice</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get npts/nsigs for current selection</span>
        <span class="n">param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span><span class="o">.</span><span class="n">form_volume_parameters</span><span class="p">[</span><span class="n">row_index</span><span class="p">]</span>
        <span class="n">file_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">row_index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstPoly</span><span class="o">.</span><span class="n">itemDelegate</span><span class="p">()</span><span class="o">.</span><span class="n">poly_function</span><span class="p">)</span>
        <span class="n">combo_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstPoly</span><span class="o">.</span><span class="n">indexWidget</span><span class="p">(</span><span class="n">file_index</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disp_model</span> <span class="o">=</span> <span class="n">POLYDISPERSITY_MODELS</span><span class="p">[</span><span class="n">combo_string</span><span class="p">]()</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error in setting the dispersion model. Reverting to Gaussian.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disp_model</span> <span class="o">=</span> <span class="n">POLYDISPERSITY_MODELS</span><span class="p">[</span><span class="s1">&#39;gaussian&#39;</span><span class="p">]()</span>

        <span class="k">def</span> <span class="nf">updateFunctionCaption</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
            <span class="c1"># Utility function for update of polydispersity function name in the main model</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isCheckable</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="n">param_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">param_name</span> <span class="o">!=</span>  <span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="c1"># Modify the param value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_error_column</span><span class="p">:</span>
                <span class="c1"># err column changes the indexing</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">combo_string</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">combo_string</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">combo_string</span> <span class="o">==</span> <span class="s1">&#39;array&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># assure the combo is at the right index</span>
                <span class="n">combo_box</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">combo_box</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">combo_box</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="n">combo_string</span><span class="p">))</span>
                <span class="n">combo_box</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="c1"># Load the file</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loadPolydispArray</span><span class="p">(</span><span class="n">row_index</span><span class="p">)</span>
                <span class="c1"># Update main model for display</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">iterateOverModel</span><span class="p">(</span><span class="n">updateFunctionCaption</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">set_dispersion</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_model</span><span class="p">)</span>
                <span class="c1"># uncheck the parameter</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>
                <span class="c1"># disable the row</span>
                <span class="n">lo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstPoly</span><span class="o">.</span><span class="n">itemDelegate</span><span class="p">()</span><span class="o">.</span><span class="n">poly_parameter</span>
                <span class="n">hi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstPoly</span><span class="o">.</span><span class="n">itemDelegate</span><span class="p">()</span><span class="o">.</span><span class="n">poly_function</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row_index</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lo</span><span class="p">,</span> <span class="n">hi</span><span class="p">)]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="n">combo_box</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orig_poly_index</span><span class="p">)</span>
                <span class="c1"># Pass for cancel/bad read</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">set_dispersion</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_model</span><span class="p">)</span>

        <span class="c1"># Enable the row in case it was disabled by Array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">max_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstPoly</span><span class="o">.</span><span class="n">itemDelegate</span><span class="p">()</span><span class="o">.</span><span class="n">poly_filename</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row_index</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">)]</span>
        <span class="n">file_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">row_index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstPoly</span><span class="o">.</span><span class="n">itemDelegate</span><span class="p">()</span><span class="o">.</span><span class="n">poly_filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">file_index</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">npts_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">row_index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstPoly</span><span class="o">.</span><span class="n">itemDelegate</span><span class="p">()</span><span class="o">.</span><span class="n">poly_npts</span><span class="p">)</span>
        <span class="n">nsigs_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">row_index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstPoly</span><span class="o">.</span><span class="n">itemDelegate</span><span class="p">()</span><span class="o">.</span><span class="n">poly_nsigs</span><span class="p">)</span>

        <span class="n">npts</span> <span class="o">=</span> <span class="n">POLYDISPERSITY_MODELS</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">combo_string</span><span class="p">)]</span><span class="o">.</span><span class="n">default</span><span class="p">[</span><span class="s1">&#39;npts&#39;</span><span class="p">]</span>
        <span class="n">nsigs</span> <span class="o">=</span> <span class="n">POLYDISPERSITY_MODELS</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">combo_string</span><span class="p">)]</span><span class="o">.</span><span class="n">default</span><span class="p">[</span><span class="s1">&#39;nsigmas&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">npts_index</span><span class="p">,</span> <span class="n">npts</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">nsigs_index</span><span class="p">,</span> <span class="n">nsigs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">iterateOverModel</span><span class="p">(</span><span class="n">updateFunctionCaption</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">combo_box</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">orig_poly_index</span> <span class="o">=</span> <span class="n">combo_box</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span></div>

<div class="viewcode-block" id="FittingWidget.loadPolydispArray"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.loadPolydispArray">[docs]</a>    <span class="k">def</span> <span class="nf">loadPolydispArray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Show the load file dialog and loads requested data into state</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">datafile</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Choose a weight file&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;All files (*.*)&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">DontUseNativeDialog</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">datafile</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No weight data chosen.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">IOError</span>

        <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">def</span> <span class="nf">appendData</span><span class="p">(</span><span class="n">data_tuple</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Fish out floats from a tuple of strings</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
                <span class="c1"># just pass through if line with bad data</span>
                <span class="k">return</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">datafile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">column_file</span><span class="p">:</span>
            <span class="n">column_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">column_file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()]</span>
            <span class="p">[</span><span class="n">appendData</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">column_data</span><span class="p">]</span>

        <span class="c1"># If everything went well - update the sasmodel values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disp_model</span><span class="o">.</span><span class="n">set_weights</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">values</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span>
        <span class="c1"># + update the cell with filename</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">datafile</span><span class="p">))</span>
        <span class="n">fname_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">row_index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstPoly</span><span class="o">.</span><span class="n">itemDelegate</span><span class="p">()</span><span class="o">.</span><span class="n">poly_filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">fname_index</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.onColumnWidthUpdate"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.onColumnWidthUpdate">[docs]</a>    <span class="k">def</span> <span class="nf">onColumnWidthUpdate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">old_size</span><span class="p">,</span> <span class="n">new_size</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simple state update of the current column widths in the  param list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lstParamHeaderSizes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_size</span></div>

<div class="viewcode-block" id="FittingWidget.setMagneticModel"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.setMagneticModel">[docs]</a>    <span class="k">def</span> <span class="nf">setMagneticModel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set magnetism values on model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="c1"># default initial value</span>
        <span class="n">m0</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span><span class="o">.</span><span class="n">call_parameters</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s1">&#39;magnetic&#39;</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="s2">&quot;M0&quot;</span> <span class="ow">in</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="n">m0</span> <span class="o">+=</span> <span class="mf">0.5</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">m0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">default</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addCheckedMagneticListToModel</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">addHeadersToModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.shellNamesList"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.shellNamesList">[docs]</a>    <span class="k">def</span> <span class="nf">shellNamesList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns list of names of all multi-shell parameters</span>
<span class="sd">        E.g. for sld[n], radius[n], n=1..3 it will return</span>
<span class="sd">        [sld1, sld2, sld3, radius1, radius2, radius3]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">multi_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">[:</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span><span class="o">.</span><span class="n">iq_parameters</span> <span class="k">if</span> <span class="s1">&#39;[&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="n">top_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">multiplicity_info</span><span class="o">.</span><span class="n">number</span>
        <span class="n">shell_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">top_index</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">multi_names</span><span class="p">:</span>
                <span class="n">shell_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">shell_names</span></div>

<div class="viewcode-block" id="FittingWidget.addCheckedMagneticListToModel"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.addCheckedMagneticListToModel">[docs]</a>    <span class="k">def</span> <span class="nf">addCheckedMagneticListToModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrapper for model update with a subset of magnetic parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">basename</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">basename</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="n">basename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shell_names</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">shell_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">basename</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">shell_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">basename</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:])</span>

            <span class="k">if</span> <span class="n">shell_index</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_shell_displayed</span><span class="p">:</span>
                <span class="k">return</span>

        <span class="n">checked_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">),</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                        <span class="n">param</span><span class="o">.</span><span class="n">units</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">magnet_params</span><span class="p">[</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">addCheckedListToModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="p">,</span> <span class="n">checked_list</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.enableStructureFactorControl"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.enableStructureFactorControl">[docs]</a>    <span class="k">def</span> <span class="nf">enableStructureFactorControl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure_factor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add structure factors to the list of parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">is_form_factor</span> <span class="ow">or</span> <span class="n">structure_factor</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enableStructureCombo</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disableStructureCombo</span><span class="p">()</span></div>

<div class="viewcode-block" id="FittingWidget.addExtraShells"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.addExtraShells">[docs]</a>    <span class="k">def</span> <span class="nf">addExtraShells</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a combobox for multiple shell display</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">param_name</span><span class="p">,</span> <span class="n">param_length</span> <span class="o">=</span> <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">getMultiplicity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">param_length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># cell 1: variable name</span>
        <span class="n">item1</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="n">param_name</span><span class="p">)</span>

        <span class="n">func</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">()</span>

        <span class="c1"># cell 2: combobox</span>
        <span class="n">item2</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">()</span>

        <span class="c1"># cell 3: min value</span>
        <span class="n">item3</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">()</span>
        <span class="c1"># set the cell to be non-editable</span>
        <span class="n">item3</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="n">item3</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">^</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEditable</span><span class="p">)</span>

        <span class="c1"># cell 4: max value</span>
        <span class="n">item4</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">()</span>
        <span class="c1"># set the cell to be non-editable</span>
        <span class="n">item4</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="n">item4</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">^</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEditable</span><span class="p">)</span>

        <span class="c1"># cell 4: SLD button</span>
        <span class="n">item5</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">()</span>
        <span class="n">button</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">()</span>
        <span class="n">button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Show SLD Profile&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">appendRow</span><span class="p">([</span><span class="n">item1</span><span class="p">,</span> <span class="n">item2</span><span class="p">,</span> <span class="n">item3</span><span class="p">,</span> <span class="n">item4</span><span class="p">,</span> <span class="n">item5</span><span class="p">])</span>

        <span class="c1"># Beautify the row:  span columns 2-4</span>
        <span class="n">shell_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
        <span class="n">shell_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">shell_row</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">button_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">shell_row</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">setIndexWidget</span><span class="p">(</span><span class="n">shell_index</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">setIndexWidget</span><span class="p">(</span><span class="n">button_index</span><span class="p">,</span> <span class="n">button</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_shells_row</span> <span class="o">=</span> <span class="n">shell_row</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="c1"># Get the default number of shells for the model</span>
        <span class="n">kernel_pars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">_model_info</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">kernel_parameters</span>
        <span class="n">shell_par</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">kernel_pars</span><span class="p">:</span>
            <span class="n">parname</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span>
            <span class="k">if</span> <span class="s1">&#39;[&#39;</span> <span class="ow">in</span> <span class="n">parname</span><span class="p">:</span>
                 <span class="n">parname</span> <span class="o">=</span> <span class="n">parname</span><span class="p">[:</span><span class="n">parname</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">parname</span> <span class="o">==</span> <span class="n">param_name</span><span class="p">:</span>
                <span class="n">shell_par</span> <span class="o">=</span> <span class="n">par</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">shell_par</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Could not find </span><span class="si">%s</span><span class="s2"> in kernel parameters.&quot;</span><span class="p">,</span> <span class="n">param_name</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">default_shell_count</span> <span class="o">=</span> <span class="n">shell_par</span><span class="o">.</span><span class="n">default</span>
        <span class="n">shell_min</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">shell_max</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">shell_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">shell_par</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">shell_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">shell_par</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="c1"># no info about limits</span>
            <span class="k">pass</span>
        <span class="k">except</span> <span class="ne">OverflowError</span><span class="p">:</span>
            <span class="c1"># Try to limit shell_par, if possible</span>
            <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">shell_par</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
                <span class="n">shell_max</span> <span class="o">=</span> <span class="mi">9</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Limiting shell count to 9.&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Badly defined multiplicity: &quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">))</span>
            <span class="k">return</span>
        <span class="c1"># don&#39;t update the kernel here - this data is display only</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">item3</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">shell_min</span><span class="p">))</span>
        <span class="n">item4</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">shell_max</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1">## Respond to index change</span>
        <span class="c1">#func.currentTextChanged.connect(self.modifyShellsInList)</span>

        <span class="c1"># Respond to button press</span>
        <span class="n">button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onShowSLDProfile</span><span class="p">)</span>

        <span class="c1"># Available range of shells displayed in the combobox</span>
        <span class="n">func</span><span class="o">.</span><span class="n">addItems</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shell_min</span><span class="p">,</span> <span class="n">shell_max</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>

        <span class="c1"># Respond to index change</span>
        <span class="n">func</span><span class="o">.</span><span class="n">currentTextChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modifyShellsInList</span><span class="p">)</span>

        <span class="c1"># Add default number of shells to the model</span>
        <span class="n">func</span><span class="o">.</span><span class="n">setCurrentText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">default_shell_count</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modifyShellsInList</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">default_shell_count</span><span class="p">))</span></div>

<div class="viewcode-block" id="FittingWidget.modifyShellsInList"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.modifyShellsInList">[docs]</a>    <span class="k">def</span> <span class="nf">modifyShellsInList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add/remove additional multishell parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Find row location of the combobox</span>
        <span class="n">first_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_shells_row</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">remove_rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_shell_params</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="c1"># bad text on the control!</span>
            <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Multiplicity incorrect! Setting to 0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">multiplicity</span> <span class="o">=</span> <span class="n">index</span>
        <span class="k">if</span> <span class="n">remove_rows</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">removeRows</span><span class="p">(</span><span class="n">first_row</span><span class="p">,</span> <span class="n">remove_rows</span><span class="p">)</span>

        <span class="n">new_rows</span> <span class="o">=</span> <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">addShellsToModel</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="p">,</span>
                <span class="n">index</span><span class="p">,</span>
                <span class="n">first_row</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_num_shell_params</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_rows</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_shell_displayed</span> <span class="o">=</span> <span class="n">index</span>

        <span class="c1"># Param values for existing shells were reset to default; force all changes into kernel module</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">new_rows</span><span class="p">:</span>
            <span class="n">par</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">toDouble</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">par</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

        <span class="c1"># Change &#39;n&#39; in the parameter model; also causes recalculation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_shells_row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>

        <span class="c1"># Update relevant models</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setPolyModel</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">canHaveMagnetism</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setMagneticModel</span><span class="p">()</span></div>

<div class="viewcode-block" id="FittingWidget.onShowSLDProfile"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.onShowSLDProfile">[docs]</a>    <span class="k">def</span> <span class="nf">onShowSLDProfile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Show a quick plot of SLD profile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get profile data</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">getProfile</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;SLD profile calculation failed.&quot;</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">y</span> <span class="o">*=</span> <span class="mf">1.0e6</span>
        <span class="n">profile_data</span> <span class="o">=</span> <span class="n">Data1D</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
        <span class="n">profile_data</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;SLD&quot;</span>
        <span class="n">profile_data</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span>
        <span class="n">profile_data</span><span class="o">.</span><span class="n">symbol</span> <span class="o">=</span> <span class="s1">&#39;Line&#39;</span>
        <span class="n">profile_data</span><span class="o">.</span><span class="n">hide_error</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">profile_data</span><span class="o">.</span><span class="n">_xaxis</span> <span class="o">=</span> <span class="s2">&quot;R&quot;</span>
        <span class="n">profile_data</span><span class="o">.</span><span class="n">_xunit</span> <span class="o">=</span> <span class="s2">&quot;\AA&quot;</span>
        <span class="n">profile_data</span><span class="o">.</span><span class="n">_yaxis</span> <span class="o">=</span> <span class="s2">&quot;SLD&quot;</span>
        <span class="n">profile_data</span><span class="o">.</span><span class="n">_yunit</span> <span class="o">=</span> <span class="s2">&quot;10^{-6}\AA^{-2}&quot;</span>
        <span class="n">profile_data</span><span class="o">.</span><span class="n">ytransform</span><span class="o">=</span><span class="s1">&#39;y&#39;</span>
        <span class="n">profile_data</span><span class="o">.</span><span class="n">xtransform</span><span class="o">=</span><span class="s1">&#39;x&#39;</span>

        <span class="n">profile_data</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s2">&quot;sld&quot;</span>

        <span class="n">plotter</span> <span class="o">=</span> <span class="n">PlotterWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quickplot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plotter</span><span class="o">.</span><span class="n">showLegend</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">profile_data</span><span class="p">,</span> <span class="n">hide_error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_widget</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_widget</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Scattering Length Density Profile&quot;</span><span class="p">)</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">plotter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_widget</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_widget</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="FittingWidget.setInteractiveElements"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.setInteractiveElements">[docs]</a>    <span class="k">def</span> <span class="nf">setInteractiveElements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Switch interactive GUI elements on/off</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">enabled</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">enabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lstPoly</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">enabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lstMagnetic</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">enabled</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cbCategory</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">enabled</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">enabled</span><span class="p">:</span>
            <span class="c1"># worry about original enablement of model and SF</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">enabled_cbmodel</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbStructureFactor</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">enabled_sfmodel</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">enabled</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbStructureFactor</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">enabled</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cmdPlot</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">enabled</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.enableInteractiveElements"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.enableInteractiveElements">[docs]</a>    <span class="k">def</span> <span class="nf">enableInteractiveElements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set buttion caption on fitting/calculate finish</span>
<span class="sd">        Enable the param table(s)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Notify the user that fitting is available</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdFit</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s1">&#39;QPushButton {color: black;}&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdFit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Fit&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_started</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setInteractiveElements</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.disableInteractiveElements"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.disableInteractiveElements">[docs]</a>    <span class="k">def</span> <span class="nf">disableInteractiveElements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set buttion caption on fitting/calculate start</span>
<span class="sd">        Disable the param table(s)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Notify the user that fitting is being run</span>
        <span class="c1"># Allow for stopping the job</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdFit</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s1">&#39;QPushButton {color: red;}&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdFit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Stop fit&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setInteractiveElements</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.disableInteractiveElementsOnCalculate"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.disableInteractiveElementsOnCalculate">[docs]</a>    <span class="k">def</span> <span class="nf">disableInteractiveElementsOnCalculate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set buttion caption on fitting/calculate start</span>
<span class="sd">        Disable the param table(s)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Notify the user that fitting is being run</span>
        <span class="c1"># Allow for stopping the job</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdFit</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s1">&#39;QPushButton {color: red;}&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdFit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Running...&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setInteractiveElements</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.readFitPage"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.readFitPage">[docs]</a>    <span class="k">def</span> <span class="nf">readFitPage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read in state from a fitpage object and update GUI</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">FitPage</span><span class="p">)</span>
        <span class="c1"># Main tab info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logic</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_is_loaded</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">data_is_loaded</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chkPolydispersity</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">is_polydisperse</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chkMagnetism</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">is_magnetic</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chk2DView</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">is2D</span><span class="p">)</span>

        <span class="c1"># Update the comboboxes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbCategory</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbCategory</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">current_category</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">current_model</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">fp</span><span class="o">.</span><span class="n">current_factor</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbStructureFactor</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbStructureFactor</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">current_factor</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">chi2</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">chi2</span>

        <span class="c1"># Options tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q_range_min</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">fit_options</span><span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">MIN_RANGE</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q_range_max</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">fit_options</span><span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">MAX_RANGE</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">npts</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">fit_options</span><span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">NPTS</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_points</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">fit_options</span><span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">LOG_POINTS</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weighting</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">fit_options</span><span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">WEIGHTING</span><span class="p">]</span>

        <span class="c1"># Models</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">model_model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">poly_model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">magnetism_model</span>

        <span class="c1"># Resolution tab</span>
        <span class="n">smearing</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">smearing_options</span><span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">SMEARING_OPTION</span><span class="p">]</span>
        <span class="n">accuracy</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">smearing_options</span><span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">SMEARING_ACCURACY</span><span class="p">]</span>
        <span class="n">smearing_min</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">smearing_options</span><span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">SMEARING_MIN</span><span class="p">]</span>
        <span class="n">smearing_max</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">smearing_options</span><span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">SMEARING_MAX</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smearing_widget</span><span class="o">.</span><span class="n">setState</span><span class="p">(</span><span class="n">smearing</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">,</span> <span class="n">smearing_min</span><span class="p">,</span> <span class="n">smearing_max</span><span class="p">)</span></div>

        <span class="c1"># TODO: add polidyspersity and magnetism</span>

<div class="viewcode-block" id="FittingWidget.saveToFitPage"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.saveToFitPage">[docs]</a>    <span class="k">def</span> <span class="nf">saveToFitPage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write current state to the given fitpage</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">FitPage</span><span class="p">)</span>

        <span class="c1"># Main tab info</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">filename</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">data_is_loaded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_is_loaded</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">is_polydisperse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chkPolydispersity</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">is_magnetic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chkMagnetism</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">is2D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chk2DView</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

        <span class="c1"># Use current models - they contain all the required parameters</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">model_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">poly_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">magnetism_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbCategory</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">current_category</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbCategory</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">current_model</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbStructureFactor</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbStructureFactor</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">current_factor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbStructureFactor</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">current_factor</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="n">fp</span><span class="o">.</span><span class="n">chi2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chi2</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">main_params_to_fit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_params_to_fit</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">poly_params_to_fit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">poly_params_to_fit</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">magnet_params_to_fit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">magnet_params_to_fit</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">kernel_module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span>

        <span class="c1"># Algorithm options</span>
        <span class="c1"># fp.algorithm = self.parent.fit_options.selected_id</span>

        <span class="c1"># Options tab</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">fit_options</span><span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">MIN_RANGE</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_range_min</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">fit_options</span><span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">MAX_RANGE</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_range_max</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">fit_options</span><span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">NPTS</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npts</span>
        <span class="c1">#fp.fit_options[fp.NPTS_FIT] = self.npts_fit</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">fit_options</span><span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">LOG_POINTS</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_points</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">fit_options</span><span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">WEIGHTING</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weighting</span>

        <span class="c1"># Resolution tab</span>
        <span class="n">smearing</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">,</span> <span class="n">smearing_min</span><span class="p">,</span> <span class="n">smearing_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smearing_widget</span><span class="o">.</span><span class="n">state</span><span class="p">()</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">smearing_options</span><span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">SMEARING_OPTION</span><span class="p">]</span> <span class="o">=</span> <span class="n">smearing</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">smearing_options</span><span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">SMEARING_ACCURACY</span><span class="p">]</span> <span class="o">=</span> <span class="n">accuracy</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">smearing_options</span><span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">SMEARING_MIN</span><span class="p">]</span> <span class="o">=</span> <span class="n">smearing_min</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">smearing_options</span><span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">SMEARING_MAX</span><span class="p">]</span> <span class="o">=</span> <span class="n">smearing_max</span></div>

        <span class="c1"># TODO: add polidyspersity and magnetism</span>

<div class="viewcode-block" id="FittingWidget.updateUndo"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.updateUndo">[docs]</a>    <span class="k">def</span> <span class="nf">updateUndo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new state page and add it to the stack</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">undo_supported</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pushFitPage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentState</span><span class="p">())</span></div>

<div class="viewcode-block" id="FittingWidget.currentState"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.currentState">[docs]</a>    <span class="k">def</span> <span class="nf">currentState</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return fit page with current state</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_page</span> <span class="o">=</span> <span class="n">FitPage</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveToFitPage</span><span class="p">(</span><span class="n">new_page</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new_page</span></div>

<div class="viewcode-block" id="FittingWidget.pushFitPage"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.pushFitPage">[docs]</a>    <span class="k">def</span> <span class="nf">pushFitPage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_page</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a new fit page object with current state</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">page_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_page</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.popFitPage"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.popFitPage">[docs]</a>    <span class="k">def</span> <span class="nf">popFitPage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove top fit page from stack</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">page_stack</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">page_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span></div>

<div class="viewcode-block" id="FittingWidget.getReport"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.getReport">[docs]</a>    <span class="k">def</span> <span class="nf">getReport</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create and return HTML report with parameters and charts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_data</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_index</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theory_item</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">getStandardParam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="p">)</span>
        <span class="n">poly_params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">magnet_params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chkPolydispersity</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">poly_params</span> <span class="o">=</span> <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">getStandardParam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chkMagnetism</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">canHaveMagnetism</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">magnet_params</span> <span class="o">=</span> <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">getStandardParam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="p">)</span>
        <span class="n">report_logic</span> <span class="o">=</span> <span class="n">ReportPageLogic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                       <span class="n">kernel_module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="p">,</span>
                                       <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                       <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
                                       <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="o">+</span><span class="n">poly_params</span><span class="o">+</span><span class="n">magnet_params</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">report_logic</span><span class="o">.</span><span class="n">reportList</span><span class="p">()</span></div>

<div class="viewcode-block" id="FittingWidget.loadPageStateCallback"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.loadPageStateCallback">[docs]</a>    <span class="k">def</span> <span class="nf">loadPageStateCallback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">datainfo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is a callback method called from the CANSAS reader.</span>
<span class="sd">        We need the instance of this reader only for writing out a file,</span>
<span class="sd">        so there&#39;s nothing here.</span>
<span class="sd">        Until Load Analysis is implemented, that is.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="FittingWidget.loadPageState"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.loadPageState">[docs]</a>    <span class="k">def</span> <span class="nf">loadPageState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pagestate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load the PageState object and update the current widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadAnalysisFile</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">filepath</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">filepath</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">statefile</span><span class="p">:</span>
            <span class="c1">#column_data = [line.rstrip().split() for line in statefile.readlines()]</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">statefile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

        <span class="c1"># convert into list of lists</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="FittingWidget.loadAnalysisFile"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.loadAnalysisFile">[docs]</a>    <span class="k">def</span> <span class="nf">loadAnalysisFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called when the &quot;Open Project&quot; menu item chosen.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">default_name</span> <span class="o">=</span> <span class="s2">&quot;FitPage&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tab_id</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;.fitv&quot;</span>
        <span class="n">wildcard</span> <span class="o">=</span> <span class="s2">&quot;fitv files (*.fitv)&quot;</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;caption&#39;</span>   <span class="p">:</span> <span class="s1">&#39;Open Analysis&#39;</span><span class="p">,</span>
            <span class="s1">&#39;directory&#39;</span> <span class="p">:</span> <span class="n">default_name</span><span class="p">,</span>
            <span class="s1">&#39;filter&#39;</span>    <span class="p">:</span> <span class="n">wildcard</span><span class="p">,</span>
            <span class="s1">&#39;parent&#39;</span>    <span class="p">:</span> <span class="bp">self</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">filename</span></div>

<div class="viewcode-block" id="FittingWidget.onCopyToClipboard"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.onCopyToClipboard">[docs]</a>    <span class="k">def</span> <span class="nf">onCopyToClipboard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy current fitting parameters into the clipboard</span>
<span class="sd">        using requested formatting:</span>
<span class="sd">        plain, excel, latex</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">param_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFitParameters</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">format</span><span class="o">==</span><span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">param_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFitPage</span><span class="p">()</span>
            <span class="n">param_list</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFitModel</span><span class="p">()</span>
            <span class="n">formatted_output</span> <span class="o">=</span> <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">formatParameters</span><span class="p">(</span><span class="n">param_list</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;Excel&quot;</span><span class="p">:</span>
            <span class="n">formatted_output</span> <span class="o">=</span> <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">formatParametersExcel</span><span class="p">(</span><span class="n">param_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;Latex&quot;</span><span class="p">:</span>
            <span class="n">formatted_output</span> <span class="o">=</span> <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">formatParametersLatex</span><span class="p">(</span><span class="n">param_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;Save&quot;</span><span class="p">:</span>
            <span class="n">Text_output</span> <span class="o">=</span> <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">formatParameters</span><span class="p">(</span><span class="n">param_list</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">Excel_output</span> <span class="o">=</span> <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">formatParametersExcel</span><span class="p">(</span><span class="n">param_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="n">Latex_output</span> <span class="o">=</span> <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">formatParametersLatex</span><span class="p">(</span><span class="n">param_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Bad parameter output format specifier.&quot;</span><span class="p">)</span>

        <span class="c1"># Dump formatted_output to the clipboard</span>


        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;Save&quot;</span><span class="p">:</span>
            <span class="n">save_dialog</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFileDialog</span><span class="p">()</span>
            <span class="n">save_dialog</span><span class="o">.</span><span class="n">setAcceptMode</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">AcceptSave</span><span class="p">)</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;parent&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="p">,</span>
                <span class="s1">&#39;caption&#39;</span><span class="p">:</span> <span class="s1">&#39;Save Project&#39;</span><span class="p">,</span>
                <span class="s1">&#39;filter&#39;</span><span class="p">:</span> <span class="s1">&#39;Text (*.txt);;Excel (*.xls);;Latex (*.log)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;options&#39;</span><span class="p">:</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">DontUseNativeDialog</span>
            <span class="p">}</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">save_dialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">file_path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">file_path</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Text (*.txt)&#39;</span><span class="p">:</span>
                <span class="n">Type_output</span> <span class="o">=</span> <span class="n">Text_output</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;txt&#39;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">file_path</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Excel (*.xls)&#39;</span><span class="p">:</span>
                <span class="n">Type_output</span> <span class="o">=</span> <span class="n">Excel_output</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;xls&#39;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">file_path</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Latex (*.log)&#39;</span><span class="p">:</span>
                <span class="n">Type_output</span> <span class="o">=</span> <span class="n">Latex_output</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;log&#39;</span><span class="p">))</span>

            <span class="n">file_open</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">file_open</span><span class="p">:</span>
                <span class="n">file_open</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">Type_output</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cb</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">clipboard</span><span class="p">()</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">formatted_output</span><span class="p">)</span></div>


<div class="viewcode-block" id="FittingWidget.getFitModel"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.getFitModel">[docs]</a>    <span class="k">def</span> <span class="nf">getFitModel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        serializes combobox state</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">param_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">model</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
        <span class="n">category</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbCategory</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
        <span class="n">structure</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbStructureFactor</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
        <span class="n">param_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;fitpage_category&#39;</span><span class="p">,</span> <span class="n">category</span><span class="p">])</span>
        <span class="n">param_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;fitpage_model&#39;</span><span class="p">,</span> <span class="n">model</span><span class="p">])</span>
        <span class="n">param_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;fitpage_structure&#39;</span><span class="p">,</span> <span class="n">structure</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">param_list</span></div>

<div class="viewcode-block" id="FittingWidget.getFitPage"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.getFitPage">[docs]</a>    <span class="k">def</span> <span class="nf">getFitPage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        serializes full state of this fit page</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># run a loop over all parameters and pull out</span>
        <span class="c1"># first - regular params</span>
        <span class="n">param_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFitParameters</span><span class="p">()</span>

        <span class="n">param_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;is_data&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_is_loaded</span><span class="p">)])</span>
        <span class="n">data_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_batch_fitting</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_data</span><span class="p">:</span>
                <span class="c1"># need item-&gt;data-&gt;data_id</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">dataFromItem</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">data_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="n">filenames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_is_loaded</span><span class="p">:</span>
                <span class="n">data_ids</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logic</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">id</span><span class="p">)]</span>
                <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logic</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">filename</span><span class="p">)]</span>
        <span class="n">param_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;tab_index&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tab_id</span><span class="p">)])</span>
        <span class="n">param_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;is_batch_fitting&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_batch_fitting</span><span class="p">)])</span>
        <span class="n">param_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;data_name&#39;</span><span class="p">,</span> <span class="n">filenames</span><span class="p">])</span>
        <span class="n">param_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;data_id&#39;</span><span class="p">,</span> <span class="n">data_ids</span><span class="p">])</span>
        <span class="n">param_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;tab_name&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelName</span><span class="p">()])</span>
        <span class="c1"># option tab</span>
        <span class="n">param_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;q_range_min&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q_range_min</span><span class="p">)])</span>
        <span class="n">param_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;q_range_max&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q_range_max</span><span class="p">)])</span>
        <span class="n">param_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;q_weighting&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weighting</span><span class="p">)])</span>
        <span class="n">param_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;weighting&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options_widget</span><span class="o">.</span><span class="n">weighting</span><span class="p">)])</span>

        <span class="c1"># resolution</span>
        <span class="n">smearing</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">,</span> <span class="n">smearing_min</span><span class="p">,</span> <span class="n">smearing_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smearing_widget</span><span class="o">.</span><span class="n">state</span><span class="p">()</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smearing_widget</span><span class="o">.</span><span class="n">cbSmearing</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
        <span class="n">param_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;smearing&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)])</span>
        <span class="n">param_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;smearing_min&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">smearing_min</span><span class="p">)])</span>
        <span class="n">param_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;smearing_max&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">smearing_max</span><span class="p">)])</span>

        <span class="c1"># checkboxes, if required</span>
        <span class="n">has_polydisp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chkPolydispersity</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="n">has_magnetism</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chkMagnetism</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="n">has_chain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chkChainFit</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="n">has_2D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chk2DView</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="n">param_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;polydisperse_params&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">has_polydisp</span><span class="p">)])</span>
        <span class="n">param_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;magnetic_params&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">has_magnetism</span><span class="p">)])</span>
        <span class="n">param_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;chainfit_params&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">has_chain</span><span class="p">)])</span>
        <span class="n">param_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;2D_params&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">has_2D</span><span class="p">)])</span>

        <span class="k">return</span> <span class="n">param_list</span></div>

<div class="viewcode-block" id="FittingWidget.getFitParameters"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.getFitParameters">[docs]</a>    <span class="k">def</span> <span class="nf">getFitParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        serializes current parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">param_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">param_list</span>

        <span class="n">param_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;model_name&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">currentText</span><span class="p">())])</span>

        <span class="k">def</span> <span class="nf">gatherParams</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Create list of main parameters based on _model_model</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">param_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

            <span class="c1"># Assure this is a parameter - must contain a checkbox</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">isCheckable</span><span class="p">():</span>
                <span class="c1"># maybe it is a combobox item (multiplicity)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">indexWidget</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">widget</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">return</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">):</span>
                        <span class="c1"># find the index of the combobox</span>
                        <span class="n">current_index</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
                        <span class="n">param_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">param_name</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">current_index</span><span class="p">)])</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">return</span>

            <span class="n">param_checked</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">)</span>
            <span class="c1"># Value of the parameter. In some cases this is the text of the combobox choice.</span>
            <span class="n">param_value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">param_error</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">param_min</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">param_max</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">column_offset</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_error_column</span><span class="p">:</span>
                <span class="n">column_offset</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">param_error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">column_offset</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">param_min</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">2</span><span class="o">+</span><span class="n">column_offset</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="n">param_max</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">3</span><span class="o">+</span><span class="n">column_offset</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="c1"># Do we have any constraints on this parameter?</span>
            <span class="n">constraint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConstraintForRow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="n">cons</span> <span class="o">=</span> <span class="p">()</span>
            <span class="k">if</span> <span class="n">constraint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">constraint</span><span class="o">.</span><span class="n">value</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">constraint</span><span class="o">.</span><span class="n">func</span>
                <span class="n">value_ex</span> <span class="o">=</span> <span class="n">constraint</span><span class="o">.</span><span class="n">value_ex</span>
                <span class="n">param</span> <span class="o">=</span> <span class="n">constraint</span><span class="o">.</span><span class="n">param</span>
                <span class="n">validate</span> <span class="o">=</span> <span class="n">constraint</span><span class="o">.</span><span class="n">validate</span>

                <span class="n">cons</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">value_ex</span><span class="p">,</span> <span class="n">validate</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>

            <span class="n">param_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">param_name</span><span class="p">,</span> <span class="n">param_checked</span><span class="p">,</span> <span class="n">param_value</span><span class="p">,</span><span class="n">param_error</span><span class="p">,</span> <span class="n">param_min</span><span class="p">,</span> <span class="n">param_max</span><span class="p">,</span> <span class="n">cons</span><span class="p">])</span>

        <span class="k">def</span> <span class="nf">gatherPolyParams</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Create list of polydisperse parameters based on _poly_model</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">param_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">param_checked</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">)</span>
            <span class="n">param_value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">param_error</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">column_offset</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_poly_error_column</span><span class="p">:</span>
                <span class="n">column_offset</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">param_error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">column_offset</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">param_min</span>   <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">2</span><span class="o">+</span><span class="n">column_offset</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">param_max</span>   <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">3</span><span class="o">+</span><span class="n">column_offset</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">param_npts</span>  <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">4</span><span class="o">+</span><span class="n">column_offset</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">param_nsigs</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">5</span><span class="o">+</span><span class="n">column_offset</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">param_fun</span>   <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">6</span><span class="o">+</span><span class="n">column_offset</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">6</span><span class="o">+</span><span class="n">column_offset</span><span class="p">)</span>
            <span class="n">widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstPoly</span><span class="o">.</span><span class="n">indexWidget</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">):</span>
                <span class="n">param_fun</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
            <span class="c1"># width</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">param_name</span><span class="o">+</span><span class="s2">&quot;.width&quot;</span>
            <span class="n">param_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">name</span><span class="p">,</span> <span class="n">param_checked</span><span class="p">,</span> <span class="n">param_value</span><span class="p">,</span> <span class="n">param_error</span><span class="p">,</span>
                               <span class="n">param_min</span><span class="p">,</span> <span class="n">param_max</span><span class="p">,</span> <span class="n">param_npts</span><span class="p">,</span> <span class="n">param_nsigs</span><span class="p">,</span> <span class="n">param_fun</span><span class="p">])</span>

        <span class="k">def</span> <span class="nf">gatherMagnetParams</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Create list of magnetic parameters based on _magnet_model</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">param_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">param_checked</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">)</span>
            <span class="n">param_value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">param_error</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">column_offset</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_magnet_error_column</span><span class="p">:</span>
                <span class="n">column_offset</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">param_error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">column_offset</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">param_min</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">2</span><span class="o">+</span><span class="n">column_offset</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">param_max</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">3</span><span class="o">+</span><span class="n">column_offset</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">param_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">param_name</span><span class="p">,</span> <span class="n">param_checked</span><span class="p">,</span> <span class="n">param_value</span><span class="p">,</span>
                               <span class="n">param_error</span><span class="p">,</span> <span class="n">param_min</span><span class="p">,</span> <span class="n">param_max</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">iterateOverModel</span><span class="p">(</span><span class="n">gatherParams</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chkPolydispersity</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iterateOverPolyModel</span><span class="p">(</span><span class="n">gatherPolyParams</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chkMagnetism</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">canHaveMagnetism</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iterateOverMagnetModel</span><span class="p">(</span><span class="n">gatherMagnetParams</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">is_multiplicity_model</span><span class="p">:</span>
            <span class="n">param_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;multiplicity&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">multiplicity</span><span class="p">)])</span>

        <span class="k">return</span> <span class="n">param_list</span></div>

<div class="viewcode-block" id="FittingWidget.onParameterPaste"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.onParameterPaste">[docs]</a>    <span class="k">def</span> <span class="nf">onParameterPaste</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use the clipboard to update fit state</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if the clipboard contains right stuff</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">clipboard</span><span class="p">()</span>
        <span class="n">cb_text</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="n">lines</span> <span class="o">=</span> <span class="n">cb_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;sasview_parameter_values&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># put the text into dictionary</span>
        <span class="n">line_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">line_dict</span><span class="p">[</span><span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">updatePageWithParameters</span><span class="p">(</span><span class="n">line_dict</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.createPageForParameters"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.createPageForParameters">[docs]</a>    <span class="k">def</span> <span class="nf">createPageForParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets up page with requested model/str factor</span>
<span class="sd">        and fills it up with sent parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;fitpage_category&#39;</span> <span class="ow">in</span> <span class="n">line_dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbCategory</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbCategory</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="n">line_dict</span><span class="p">[</span><span class="s1">&#39;fitpage_category&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">if</span> <span class="s1">&#39;fitpage_model&#39;</span> <span class="ow">in</span> <span class="n">line_dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="n">line_dict</span><span class="p">[</span><span class="s1">&#39;fitpage_model&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">if</span> <span class="s1">&#39;fitpage_structure&#39;</span> <span class="ow">in</span> <span class="n">line_dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbStructureFactor</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbStructureFactor</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="n">line_dict</span><span class="p">[</span><span class="s1">&#39;fitpage_structure&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>

        <span class="c1"># Now that the page is ready for parameters, fill it up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updatePageWithParameters</span><span class="p">(</span><span class="n">line_dict</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.updatePageWithParameters"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.updatePageWithParameters">[docs]</a>    <span class="k">def</span> <span class="nf">updatePageWithParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update FitPage with parameters in line_dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;model_name&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">line_dict</span><span class="p">[</span><span class="s1">&#39;model_name&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="s1">&#39;multiplicity&#39;</span> <span class="ow">in</span> <span class="n">line_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">multip</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_dict</span><span class="p">[</span><span class="s1">&#39;multiplicity&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
            <span class="c1"># reset the model with multiplicity, so further updates are saved</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">is_multiplicity_model</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">multiplicity</span><span class="o">=</span><span class="n">multip</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">updateMultiplicityCombo</span><span class="p">(</span><span class="n">multip</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;tab_name&#39;</span> <span class="ow">in</span> <span class="n">line_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">line_dict</span><span class="p">[</span><span class="s1">&#39;tab_name&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;polydisperse_params&#39;</span> <span class="ow">in</span> <span class="n">line_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chkPolydispersity</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="n">line_dict</span><span class="p">[</span><span class="s1">&#39;polydisperse_params&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;True&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;magnetic_params&#39;</span> <span class="ow">in</span> <span class="n">line_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chkMagnetism</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="n">line_dict</span><span class="p">[</span><span class="s1">&#39;magnetic_params&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;True&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;chainfit_params&#39;</span> <span class="ow">in</span> <span class="n">line_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chkChainFit</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="n">line_dict</span><span class="p">[</span><span class="s1">&#39;chainfit_params&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;True&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;2D_params&#39;</span> <span class="ow">in</span> <span class="n">line_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chk2DView</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="n">line_dict</span><span class="p">[</span><span class="s1">&#39;2D_params&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;True&#39;</span><span class="p">)</span>

        <span class="c1"># Create the context dictionary for parameters</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;model_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">line_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;model_name&#39;</span><span class="p">]):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="p">()</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Information</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;The model in the clipboard is not the same as the currently loaded model. </span><span class="se">\</span>
<span class="s2">                         Not all parameters saved may paste correctly.&quot;</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span>

        <span class="k">if</span> <span class="s1">&#39;smearing&#39;</span> <span class="ow">in</span> <span class="n">line_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_dict</span><span class="p">[</span><span class="s1">&#39;smearing&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">smearing_widget</span><span class="o">.</span><span class="n">cbSmearing</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="s1">&#39;smearing_min&#39;</span> <span class="ow">in</span> <span class="n">line_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">smearing_widget</span><span class="o">.</span><span class="n">dq_l</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line_dict</span><span class="p">[</span><span class="s1">&#39;smearing_min&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="s1">&#39;smearing_max&#39;</span> <span class="ow">in</span> <span class="n">line_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">smearing_widget</span><span class="o">.</span><span class="n">dq_r</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line_dict</span><span class="p">[</span><span class="s1">&#39;smearing_max&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">if</span> <span class="s1">&#39;q_range_max&#39;</span> <span class="ow">in</span> <span class="n">line_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">q_range_min</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line_dict</span><span class="p">[</span><span class="s1">&#39;q_range_min&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">q_range_max</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line_dict</span><span class="p">[</span><span class="s1">&#39;q_range_max&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options_widget</span><span class="o">.</span><span class="n">updateQRange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q_range_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_range_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">npts</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">button_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_dict</span><span class="p">[</span><span class="s1">&#39;weighting&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">button</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options_widget</span><span class="o">.</span><span class="n">weightingGroup</span><span class="o">.</span><span class="n">buttons</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options_widget</span><span class="o">.</span><span class="n">weightingGroup</span><span class="o">.</span><span class="n">id</span><span class="p">(</span><span class="n">button</span><span class="p">))</span> <span class="o">==</span> <span class="n">button_id</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span>
                    <span class="n">button</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">break</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">updateFullModel</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateFullPolyModel</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateFullMagnetModel</span><span class="p">(</span><span class="n">context</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.updateMultiplicityCombo"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.updateMultiplicityCombo">[docs]</a>    <span class="k">def</span> <span class="nf">updateMultiplicityCombo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multip</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find and update the multiplicity combobox</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_shells_row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">indexWidget</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">):</span>
            <span class="n">widget</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">multip</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_shell_displayed</span> <span class="o">=</span> <span class="n">multip</span></div>

<div class="viewcode-block" id="FittingWidget.updateFullModel"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.updateFullModel">[docs]</a>    <span class="k">def</span> <span class="nf">updateFullModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the model with new parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">def</span> <span class="nf">updateFittedValues</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
            <span class="c1"># Utility function for main model update</span>
            <span class="c1"># internal so can use closure for param_dict</span>
            <span class="n">param_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">param_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">param_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">return</span>
            <span class="c1"># Special case of combo box in the cell (multiplicity)</span>
            <span class="n">param_line</span> <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># modify the shells value</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">combo_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">param_line</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="c1"># quietly pass</span>
                    <span class="k">return</span>
                <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">indexWidget</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">):</span>
                    <span class="c1">#widget.setCurrentIndex(combo_index)</span>
                    <span class="k">return</span>
            <span class="c1"># checkbox state</span>
            <span class="n">param_checked</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span> <span class="k">if</span> <span class="n">param_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;True&quot;</span> <span class="k">else</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">param_checked</span><span class="p">)</span>

            <span class="c1"># parameter value can be either just a value or text on the combobox</span>
            <span class="n">param_text</span> <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstParams</span><span class="o">.</span><span class="n">indexWidget</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">):</span>
                <span class="c1"># Find the right index based on text</span>
                <span class="n">combo_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">param_text</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">widget</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">combo_index</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># modify the param value</span>
                <span class="n">param_repr</span> <span class="o">=</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">formatNumber</span><span class="p">(</span><span class="n">param_text</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">param_repr</span><span class="p">)</span>

            <span class="c1"># Potentially the error column</span>
            <span class="n">ioffset</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">joffset</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">5</span><span class="p">:</span>
                <span class="c1"># error values are not editable - no need to update</span>
                <span class="n">ioffset</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_error_column</span><span class="p">:</span>
                <span class="n">joffset</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="c1"># min/max</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">2</span><span class="o">+</span><span class="n">joffset</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">param_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">][</span><span class="mi">2</span><span class="o">+</span><span class="n">ioffset</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">3</span><span class="o">+</span><span class="n">joffset</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">param_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">][</span><span class="mi">3</span><span class="o">+</span><span class="n">ioffset</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="c1"># constraints</span>
            <span class="n">cons</span> <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">][</span><span class="mi">4</span><span class="o">+</span><span class="n">ioffset</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">cons</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">cons</span><span class="p">)</span><span class="o">==</span><span class="mi">5</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">cons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">param</span> <span class="o">=</span> <span class="n">cons</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">value_ex</span> <span class="o">=</span> <span class="n">cons</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">validate</span> <span class="o">=</span> <span class="n">cons</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">function</span> <span class="o">=</span> <span class="n">cons</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">constraint</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">()</span>
                <span class="n">constraint</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
                <span class="n">constraint</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">function</span>
                <span class="n">constraint</span><span class="o">.</span><span class="n">param</span> <span class="o">=</span> <span class="n">param</span>
                <span class="n">constraint</span><span class="o">.</span><span class="n">value_ex</span> <span class="o">=</span> <span class="n">value_ex</span>
                <span class="n">constraint</span><span class="o">.</span><span class="n">validate</span> <span class="o">=</span> <span class="n">validate</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addConstraintToRow</span><span class="p">(</span><span class="n">constraint</span><span class="o">=</span><span class="n">constraint</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">setFocus</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">iterateOverModel</span><span class="p">(</span><span class="n">updateFittedValues</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.updateFullPolyModel"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.updateFullPolyModel">[docs]</a>    <span class="k">def</span> <span class="nf">updateFullPolyModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the polydispersity model with new parameters, create the errors column</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">def</span> <span class="nf">updateFittedValues</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
            <span class="c1"># Utility function for main model update</span>
            <span class="c1"># internal so can use closure for param_dict</span>
            <span class="k">if</span> <span class="n">row</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">rowCount</span><span class="p">():</span>
                <span class="k">return</span>
            <span class="n">param_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span><span class="o">.</span><span class="n">rsplit</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.width&#39;</span>
            <span class="k">if</span> <span class="n">param_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">param_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">return</span>
            <span class="c1"># checkbox state</span>
            <span class="n">param_checked</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span> <span class="k">if</span> <span class="n">param_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;True&quot;</span> <span class="k">else</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">param_checked</span><span class="p">)</span>

            <span class="c1"># modify the param value</span>
            <span class="n">param_repr</span> <span class="o">=</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">formatNumber</span><span class="p">(</span><span class="n">param_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">high</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">param_repr</span><span class="p">)</span>

            <span class="c1"># Potentially the error column</span>
            <span class="n">ioffset</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">joffset</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">7</span><span class="p">:</span>
                <span class="n">ioffset</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_poly_error_column</span><span class="p">:</span>
                <span class="n">joffset</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="c1"># min</span>
            <span class="n">param_repr</span> <span class="o">=</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">formatNumber</span><span class="p">(</span><span class="n">param_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">][</span><span class="mi">2</span><span class="o">+</span><span class="n">ioffset</span><span class="p">],</span> <span class="n">high</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">2</span><span class="o">+</span><span class="n">joffset</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">param_repr</span><span class="p">)</span>
            <span class="c1"># max</span>
            <span class="n">param_repr</span> <span class="o">=</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">formatNumber</span><span class="p">(</span><span class="n">param_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">][</span><span class="mi">3</span><span class="o">+</span><span class="n">ioffset</span><span class="p">],</span> <span class="n">high</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">3</span><span class="o">+</span><span class="n">joffset</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">param_repr</span><span class="p">)</span>
            <span class="c1"># Npts</span>
            <span class="n">param_repr</span> <span class="o">=</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">formatNumber</span><span class="p">(</span><span class="n">param_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">][</span><span class="mi">4</span><span class="o">+</span><span class="n">ioffset</span><span class="p">],</span> <span class="n">high</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">4</span><span class="o">+</span><span class="n">joffset</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">param_repr</span><span class="p">)</span>
            <span class="c1"># Nsigs</span>
            <span class="n">param_repr</span> <span class="o">=</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">formatNumber</span><span class="p">(</span><span class="n">param_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">][</span><span class="mi">5</span><span class="o">+</span><span class="n">ioffset</span><span class="p">],</span> <span class="n">high</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_poly_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">5</span><span class="o">+</span><span class="n">joffset</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">param_repr</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">setFocus</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">iterateOverPolyModel</span><span class="p">(</span><span class="n">updateFittedValues</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.updateFullMagnetModel"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.updateFullMagnetModel">[docs]</a>    <span class="k">def</span> <span class="nf">updateFullMagnetModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the magnetism model with new parameters, create the errors column</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">def</span> <span class="nf">updateFittedValues</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
            <span class="c1"># Utility function for main model update</span>
            <span class="c1"># internal so can use closure for param_dict</span>
            <span class="k">if</span> <span class="n">row</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="o">.</span><span class="n">rowCount</span><span class="p">():</span>
                <span class="k">return</span>
            <span class="n">param_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span><span class="o">.</span><span class="n">rsplit</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">param_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">param_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">return</span>
            <span class="c1"># checkbox state</span>
            <span class="n">param_checked</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span> <span class="k">if</span> <span class="n">param_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;True&quot;</span> <span class="k">else</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">param_checked</span><span class="p">)</span>

            <span class="c1"># modify the param value</span>
            <span class="n">param_repr</span> <span class="o">=</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">formatNumber</span><span class="p">(</span><span class="n">param_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">high</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">param_repr</span><span class="p">)</span>

            <span class="c1"># Potentially the error column</span>
            <span class="n">ioffset</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">joffset</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">4</span><span class="p">:</span>
                <span class="n">ioffset</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_magnet_error_column</span><span class="p">:</span>
                <span class="n">joffset</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="c1"># min</span>
            <span class="n">param_repr</span> <span class="o">=</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">formatNumber</span><span class="p">(</span><span class="n">param_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">][</span><span class="mi">2</span><span class="o">+</span><span class="n">ioffset</span><span class="p">],</span> <span class="n">high</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">2</span><span class="o">+</span><span class="n">joffset</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">param_repr</span><span class="p">)</span>
            <span class="c1"># max</span>
            <span class="n">param_repr</span> <span class="o">=</span> <span class="n">GuiUtils</span><span class="o">.</span><span class="n">formatNumber</span><span class="p">(</span><span class="n">param_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">][</span><span class="mi">3</span><span class="o">+</span><span class="n">ioffset</span><span class="p">],</span> <span class="n">high</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_magnet_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">3</span><span class="o">+</span><span class="n">joffset</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">param_repr</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">iterateOverMagnetModel</span><span class="p">(</span><span class="n">updateFittedValues</span><span class="p">)</span></div>

<div class="viewcode-block" id="FittingWidget.onMaskedData"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.onMaskedData">[docs]</a>    <span class="k">def</span> <span class="nf">onMaskedData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A mask has been applied to current data.</span>
<span class="sd">        Update the Q ranges.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateQRange</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateData</span><span class="p">()</span></div>

<div class="viewcode-block" id="FittingWidget.getCurrentFitState"><a class="viewcode-back" href="../../../../../dev/sasview-api/sas.qtgui.Perspectives.Fitting.html#sas.qtgui.Perspectives.Fitting.FittingWidget.FittingWidget.getCurrentFitState">[docs]</a>    <span class="k">def</span> <span class="nf">getCurrentFitState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store current state for fit_page</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Comboboxes</span>
        <span class="n">state</span><span class="o">.</span><span class="n">categorycombobox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbCategory</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="n">state</span><span class="o">.</span><span class="n">formfactorcombobox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbModel</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbStructureFactor</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">():</span>
            <span class="n">state</span><span class="o">.</span><span class="n">structurecombobox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbStructureFactor</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="n">state</span><span class="o">.</span><span class="n">tcChi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chi2</span>

        <span class="n">state</span><span class="o">.</span><span class="n">enable2D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is2D</span>

        <span class="c1"># save data</span>
        <span class="n">state</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># save plotting range</span>
        <span class="n">state</span><span class="o">.</span><span class="n">qmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_range_min</span>
        <span class="n">state</span><span class="o">.</span><span class="n">qmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_range_max</span>
        <span class="n">state</span><span class="o">.</span><span class="n">npts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npts</span>

        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span>
        <span class="c1"># save checkbutton state and txtcrtl values</span>
        <span class="n">state</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">getStandardParam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_model</span><span class="p">)</span>
        <span class="n">state</span><span class="o">.</span><span class="n">orientation_params_disp</span> <span class="o">=</span> <span class="n">FittingUtilities</span><span class="o">.</span><span class="n">getOrientationParam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_module</span><span class="p">)</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">SasView 5.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../../../sas.html" >sas</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, The SasView Project.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.4.
    </div>
  </body>
</html>