
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>sas.qtgui.Utilities.GuiUtils &#8212; SasView 5.0.2 documentation</title>
    <link rel="stylesheet" href="../../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">SasView 5.0.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../../sas.html" accesskey="U">sas</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for sas.qtgui.Utilities.GuiUtils</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Global defaults and various utility functions usable by the general GUI</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">imp</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">webbrowser</span>
<span class="kn">import</span> <span class="nn">urllib.parse</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="kn">import</span> <span class="n">QtCore</span>
<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="kn">import</span> <span class="n">QtGui</span>
<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="kn">import</span> <span class="n">QtWidgets</span>

<span class="kn">from</span> <span class="nn">periodictable</span> <span class="kn">import</span> <span class="n">formula</span> <span class="k">as</span> <span class="n">Formula</span>
<span class="kn">from</span> <span class="nn">sas.qtgui.Plotting</span> <span class="kn">import</span> <span class="n">DataTransform</span>
<span class="kn">from</span> <span class="nn">sas.qtgui.Plotting.ConvertUnits</span> <span class="kn">import</span> <span class="n">convertUnit</span>
<span class="kn">from</span> <span class="nn">sas.qtgui.Plotting.PlotterData</span> <span class="kn">import</span> <span class="n">Data1D</span>
<span class="kn">from</span> <span class="nn">sas.qtgui.Plotting.PlotterData</span> <span class="kn">import</span> <span class="n">Data2D</span>
<span class="kn">from</span> <span class="nn">sas.qtgui.Plotting.Plottables</span> <span class="kn">import</span> <span class="n">Plottable</span>
<span class="kn">from</span> <span class="nn">sas.sascalc.dataloader.data_info</span> <span class="kn">import</span> <span class="n">Sample</span><span class="p">,</span> <span class="n">Source</span><span class="p">,</span> <span class="n">Vector</span>
<span class="kn">from</span> <span class="nn">sas.sascalc.dataloader.data_info</span> <span class="kn">import</span> <span class="n">Detector</span><span class="p">,</span> <span class="n">Process</span><span class="p">,</span> <span class="n">TransmissionSpectrum</span>
<span class="kn">from</span> <span class="nn">sas.sascalc.dataloader.data_info</span> <span class="kn">import</span> <span class="n">Aperture</span><span class="p">,</span> <span class="n">Collimation</span>
<span class="kn">from</span> <span class="nn">sas.qtgui.Plotting.Plottables</span> <span class="kn">import</span> <span class="n">View</span>
<span class="kn">from</span> <span class="nn">sas.qtgui.Plotting.Plottables</span> <span class="kn">import</span> <span class="n">PlottableTheory1D</span>
<span class="kn">from</span> <span class="nn">sas.qtgui.Plotting.Plottables</span> <span class="kn">import</span> <span class="n">PlottableFit1D</span>
<span class="kn">from</span> <span class="nn">sas.qtgui.Plotting.Plottables</span> <span class="kn">import</span> <span class="n">Text</span>
<span class="kn">from</span> <span class="nn">sas.qtgui.Plotting.Plottables</span> <span class="kn">import</span> <span class="n">Chisq</span>
<span class="kn">from</span> <span class="nn">sas.qtgui.MainWindow.DataState</span> <span class="kn">import</span> <span class="n">DataState</span>

<span class="kn">from</span> <span class="nn">sas.sascalc.fit.AbstractFitEngine</span> <span class="kn">import</span> <span class="n">FResult</span>
<span class="kn">from</span> <span class="nn">sas.sascalc.fit.AbstractFitEngine</span> <span class="kn">import</span> <span class="n">FitData1D</span><span class="p">,</span> <span class="n">FitData2D</span>
<span class="kn">from</span> <span class="nn">sasmodels.sasview_model</span> <span class="kn">import</span> <span class="n">SasviewModel</span>

<span class="kn">from</span> <span class="nn">sas.sascalc.dataloader.loader</span> <span class="kn">import</span> <span class="n">Loader</span>
<span class="kn">from</span> <span class="nn">sas.sascalc.file_converter.nxcansas_writer</span> <span class="kn">import</span> <span class="n">NXcanSASWriter</span>

<span class="kn">from</span> <span class="nn">sas.qtgui.Utilities</span> <span class="kn">import</span> <span class="n">CustomDir</span>

<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;.py&quot;</span><span class="p">:</span>
        <span class="n">HELP_DIRECTORY_LOCATION</span> <span class="o">=</span> <span class="s2">&quot;doc&quot;</span>
<span class="k">else</span><span class="p">:</span>
        <span class="n">HELP_DIRECTORY_LOCATION</span> <span class="o">=</span> <span class="s2">&quot;docs/sphinx-docs/build/html&quot;</span>
<span class="n">IMAGES_DIRECTORY_LOCATION</span> <span class="o">=</span> <span class="n">HELP_DIRECTORY_LOCATION</span> <span class="o">+</span> <span class="s2">&quot;/_images&quot;</span>

<span class="c1"># This matches the ID of a plot created using FittingLogic._create1DPlot, e.g.</span>
<span class="c1"># &quot;5 [P(Q)] modelname&quot;</span>
<span class="c1"># or</span>
<span class="c1"># &quot;4 modelname&quot;.</span>
<span class="c1"># Useful for determining whether the plot in question is for an intermediate result, such as P(Q) or S(Q) in the</span>
<span class="c1"># case of a product model; the identifier for this is held in square brackets, as in the example above.</span>
<span class="n">theory_plot_ID_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^([0-9]+)\s+(\[(.*)\]\s+)?(.*)$&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="get_app_dir"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.get_app_dir">[docs]</a><span class="k">def</span> <span class="nf">get_app_dir</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The application directory is the one where the default custom_config.py</span>
<span class="sd">        file resides.</span>

<span class="sd">        :returns: app_path - the path to the applicatin directory</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># First, try the directory of the executable we are running</span>
    <span class="n">app_path</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">app_path</span><span class="p">):</span>
        <span class="n">app_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">app_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">app_path</span><span class="p">,</span> <span class="s2">&quot;custom_config.py&quot;</span><span class="p">)):</span>
        <span class="n">app_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">app_path</span><span class="p">)</span>
        <span class="c1">#logging.info(&quot;Using application path: %s&quot;, app_path)</span>
        <span class="k">return</span> <span class="n">app_path</span>

    <span class="c1"># Next, try the current working directory</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s2">&quot;custom_config.py&quot;</span><span class="p">)):</span>
        <span class="c1">#logging.info(&quot;Using application path: %s&quot;, os.getcwd())</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>

    <span class="c1"># Finally, try the directory of the sasview module</span>
    <span class="c1"># TODO: gui_manager will have to know about sasview until we</span>
    <span class="c1"># clean all these module variables and put them into a config class</span>
    <span class="c1"># that can be passed by sasview.py.</span>
    <span class="c1"># logging.info(sys.executable)</span>
    <span class="c1"># logging.info(str(sys.argv))</span>
    <span class="kn">from</span> <span class="nn">sas</span> <span class="kn">import</span> <span class="n">sasview</span> <span class="k">as</span> <span class="n">sasview</span>
    <span class="n">app_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">sasview</span><span class="o">.</span><span class="vm">__file__</span><span class="p">)</span>
    <span class="c1"># logging.info(&quot;Using application path: %s&quot;, app_path)</span>
    <span class="k">return</span> <span class="n">app_path</span></div>

<div class="viewcode-block" id="get_user_directory"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.get_user_directory">[docs]</a><span class="k">def</span> <span class="nf">get_user_directory</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the user&#39;s home directory</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">userdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">),</span> <span class="s2">&quot;.sasview&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">userdir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">userdir</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">userdir</span></div>

<span class="k">def</span> <span class="nf">_find_local_config</span><span class="p">(</span><span class="n">confg_file</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find configuration file for the current application</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">config_module</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">fObj</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">fObj</span><span class="p">,</span> <span class="n">path_config</span><span class="p">,</span> <span class="n">descr</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">find_module</span><span class="p">(</span><span class="n">confg_file</span><span class="p">,</span> <span class="p">[</span><span class="n">path</span><span class="p">])</span>
        <span class="n">config_module</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="n">confg_file</span><span class="p">,</span> <span class="n">fObj</span><span class="p">,</span> <span class="n">path_config</span><span class="p">,</span> <span class="n">descr</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Value error&quot;</span><span class="p">)</span>
        <span class="k">pass</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fObj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fObj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">config_module</span>


<span class="c1"># Get APP folder</span>
<span class="n">PATH_APP</span> <span class="o">=</span> <span class="n">get_app_dir</span><span class="p">()</span>
<span class="n">DATAPATH</span> <span class="o">=</span> <span class="n">PATH_APP</span>
<span class="c1"># Read in the local config, which can either be with the main</span>
<span class="c1"># application or in the installation directory</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">_find_local_config</span><span class="p">(</span><span class="s1">&#39;local_config&#39;</span><span class="p">,</span> <span class="n">PATH_APP</span><span class="p">)</span>

<span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">_find_local_config</span><span class="p">(</span><span class="s1">&#39;local_config&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="n">c_conf_dir</span> <span class="o">=</span> <span class="n">CustomDir</span><span class="o">.</span><span class="n">setup_conf_dir</span><span class="p">(</span><span class="n">PATH_APP</span><span class="p">)</span>
<span class="n">custom_config</span> <span class="o">=</span> <span class="n">_find_local_config</span><span class="p">(</span><span class="s1">&#39;custom_config&#39;</span><span class="p">,</span> <span class="n">c_conf_dir</span><span class="p">)</span>
<span class="k">if</span> <span class="n">custom_config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">custom_config</span> <span class="o">=</span> <span class="n">_find_local_config</span><span class="p">(</span><span class="s1">&#39;custom_config&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">custom_config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">msgConfig</span> <span class="o">=</span> <span class="s2">&quot;Custom_config file was not imported&quot;</span>
<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Custom config path: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">custom_config</span><span class="p">)</span>

<span class="c1">#read some constants from config</span>
<span class="n">APPLICATION_STATE_EXTENSION</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">APPLICATION_STATE_EXTENSION</span>
<span class="n">APPLICATION_NAME</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">__appname__</span>
<span class="n">SPLASH_SCREEN_PATH</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">SPLASH_SCREEN_PATH</span>
<span class="n">WELCOME_PANEL_ON</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">WELCOME_PANEL_ON</span>
<span class="n">SPLASH_SCREEN_WIDTH</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">SPLASH_SCREEN_WIDTH</span>
<span class="n">SPLASH_SCREEN_HEIGHT</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">SPLASH_SCREEN_HEIGHT</span>
<span class="n">SS_MAX_DISPLAY_TIME</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">SS_MAX_DISPLAY_TIME</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">WELCOME_PANEL_ON</span><span class="p">:</span>
    <span class="n">WELCOME_PANEL_SHOW</span> <span class="o">=</span> <span class="kc">False</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">WELCOME_PANEL_SHOW</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">DATALOADER_SHOW</span> <span class="o">=</span> <span class="n">custom_config</span><span class="o">.</span><span class="n">DATALOADER_SHOW</span>
    <span class="n">TOOLBAR_SHOW</span> <span class="o">=</span> <span class="n">custom_config</span><span class="o">.</span><span class="n">TOOLBAR_SHOW</span>
    <span class="n">FIXED_PANEL</span> <span class="o">=</span> <span class="n">custom_config</span><span class="o">.</span><span class="n">FIXED_PANEL</span>
    <span class="k">if</span> <span class="n">WELCOME_PANEL_ON</span><span class="p">:</span>
        <span class="n">WELCOME_PANEL_SHOW</span> <span class="o">=</span> <span class="n">custom_config</span><span class="o">.</span><span class="n">WELCOME_PANEL_SHOW</span>
    <span class="n">PLOPANEL_WIDTH</span> <span class="o">=</span> <span class="n">custom_config</span><span class="o">.</span><span class="n">PLOPANEL_WIDTH</span>
    <span class="n">DATAPANEL_WIDTH</span> <span class="o">=</span> <span class="n">custom_config</span><span class="o">.</span><span class="n">DATAPANEL_WIDTH</span>
    <span class="n">GUIFRAME_WIDTH</span> <span class="o">=</span> <span class="n">custom_config</span><span class="o">.</span><span class="n">GUIFRAME_WIDTH</span>
    <span class="n">GUIFRAME_HEIGHT</span> <span class="o">=</span> <span class="n">custom_config</span><span class="o">.</span><span class="n">GUIFRAME_HEIGHT</span>
    <span class="n">CONTROL_WIDTH</span> <span class="o">=</span> <span class="n">custom_config</span><span class="o">.</span><span class="n">CONTROL_WIDTH</span>
    <span class="n">CONTROL_HEIGHT</span> <span class="o">=</span> <span class="n">custom_config</span><span class="o">.</span><span class="n">CONTROL_HEIGHT</span>
    <span class="n">DEFAULT_PERSPECTIVE</span> <span class="o">=</span> <span class="n">custom_config</span><span class="o">.</span><span class="n">DEFAULT_PERSPECTIVE</span>
    <span class="n">CLEANUP_PLOT</span> <span class="o">=</span> <span class="n">custom_config</span><span class="o">.</span><span class="n">CLEANUP_PLOT</span>
    <span class="n">SAS_OPENCL</span> <span class="o">=</span> <span class="n">custom_config</span><span class="o">.</span><span class="n">SAS_OPENCL</span>
    <span class="c1"># custom open_path</span>
    <span class="n">open_folder</span> <span class="o">=</span> <span class="n">custom_config</span><span class="o">.</span><span class="n">DEFAULT_OPEN_FOLDER</span>
    <span class="k">if</span> <span class="n">open_folder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">open_folder</span><span class="p">):</span>
        <span class="n">DEFAULT_OPEN_FOLDER</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">open_folder</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">DEFAULT_OPEN_FOLDER</span> <span class="o">=</span> <span class="n">PATH_APP</span>
<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
    <span class="n">DATALOADER_SHOW</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">TOOLBAR_SHOW</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">FIXED_PANEL</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">WELCOME_PANEL_SHOW</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">PLOPANEL_WIDTH</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">PLOPANEL_WIDTH</span>
    <span class="n">DATAPANEL_WIDTH</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">DATAPANEL_WIDTH</span>
    <span class="n">GUIFRAME_WIDTH</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">GUIFRAME_WIDTH</span>
    <span class="n">GUIFRAME_HEIGHT</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">GUIFRAME_HEIGHT</span>
    <span class="n">CONTROL_WIDTH</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">CONTROL_HEIGHT</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">DEFAULT_PERSPECTIVE</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">CLEANUP_PLOT</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">DEFAULT_OPEN_FOLDER</span> <span class="o">=</span> <span class="n">PATH_APP</span>
    <span class="n">SAS_OPENCL</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">SAS_OPENCL</span>

<span class="c1">#DEFAULT_STYLE = config.DEFAULT_STYLE</span>

<span class="n">PLUGIN_STATE_EXTENSIONS</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">PLUGIN_STATE_EXTENSIONS</span>
<span class="n">OPEN_SAVE_MENU</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">OPEN_SAVE_PROJECT_MENU</span>
<span class="n">VIEW_MENU</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">VIEW_MENU</span>
<span class="n">EDIT_MENU</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">EDIT_MENU</span>
<span class="n">extension_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">if</span> <span class="n">APPLICATION_STATE_EXTENSION</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">extension_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">APPLICATION_STATE_EXTENSION</span><span class="p">)</span>
<span class="n">EXTENSIONS</span> <span class="o">=</span> <span class="n">PLUGIN_STATE_EXTENSIONS</span> <span class="o">+</span> <span class="n">extension_list</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">PLUGINS_WLIST</span> <span class="o">=</span> <span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">PLUGINS_WLIST</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
    <span class="n">PLUGINS_WLIST</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="n">APPLICATION_WLIST</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">APPLICATION_WLIST</span>
<span class="n">IS_WIN</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">IS_LINUX</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">CLOSE_SHOW</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">TIME_FACTOR</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">NOT_SO_GRAPH_LIST</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;BoxSum&quot;</span><span class="p">]</span>


<div class="viewcode-block" id="Communicate"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.Communicate">[docs]</a><span class="k">class</span> <span class="nc">Communicate</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Utility class for tracking of the Qt signals</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># File got successfully read</span>
    <span class="n">fileReadSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

    <span class="c1"># Open File returns &quot;list&quot; of paths</span>
    <span class="n">fileDataReceivedSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>

    <span class="c1"># Update Main window status bar with &quot;str&quot;</span>
    <span class="c1"># Old &quot;StatusEvent&quot;</span>
    <span class="n">statusBarUpdateSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="c1"># Send data to the current perspective</span>
    <span class="n">updatePerspectiveWithDataSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

    <span class="c1"># New data in current perspective</span>
    <span class="n">updateModelFromPerspectiveSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">)</span>

    <span class="c1"># New theory data in current perspective</span>
    <span class="n">updateTheoryFromPerspectiveSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">)</span>

    <span class="c1"># Request to delete plots (in the theory view) related to a given model ID</span>
    <span class="n">deleteIntermediateTheoryPlotsSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="c1"># New plot requested from the GUI manager</span>
    <span class="c1"># Old &quot;NewPlotEvent&quot;</span>
    <span class="n">plotRequestedSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>

    <span class="c1"># Plot from file names</span>
    <span class="n">plotFromFilenameSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="c1"># Plot update requested from a perspective</span>
    <span class="n">plotUpdateSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

    <span class="c1"># Progress bar update value</span>
    <span class="n">progressBarUpdateSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="c1"># Workspace charts added/removed</span>
    <span class="n">activeGraphsSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

    <span class="c1"># Current workspace chart&#39;s name changed</span>
    <span class="n">activeGraphName</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">tuple</span><span class="p">)</span>

    <span class="c1"># Current perspective changed</span>
    <span class="n">perspectiveChangedSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="c1"># File/dataset got deleted</span>
    <span class="n">dataDeletedSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

    <span class="c1"># Send data to Data Operation Utility panel</span>
    <span class="n">sendDataToPanelSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>

    <span class="c1"># Send result of Data Operation Utility panel to Data Explorer</span>
    <span class="n">updateModelFromDataOperationPanelSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>

    <span class="c1"># Notify about a new custom plugin being written/deleted/modified</span>
    <span class="n">customModelDirectoryChanged</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">()</span>

    <span class="c1"># Notify the gui manager about new data to be added to the grid view</span>
    <span class="n">sendDataToGridSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

    <span class="c1"># Mask Editor requested</span>
    <span class="n">maskEditorSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="n">Data2D</span><span class="p">)</span>

    <span class="c1">#second Mask Editor for external</span>
    <span class="n">extMaskEditorSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">()</span>

    <span class="c1"># Fitting parameter copy to clipboard</span>
    <span class="n">copyFitParamsSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="c1"># Fitting parameter copy to clipboard for Excel</span>
    <span class="n">copyExcelFitParamsSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="c1"># Fitting parameter copy to clipboard for Latex</span>
    <span class="n">copyLatexFitParamsSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="c1"># Fitting parameter copy to clipboard for Latex</span>
    <span class="n">SaveFitParamsSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="c1"># Fitting parameter paste from clipboard</span>
    <span class="n">pasteFitParamsSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">()</span>

    <span class="c1"># Notify about new categories/models from category manager</span>
    <span class="n">updateModelCategoriesSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">()</span>

    <span class="c1"># Tell the data explorer to switch tabs</span>
    <span class="n">changeDataExplorerTabSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="c1"># Plot fitting results (FittingWidget-&gt;GuiManager)</span>
    <span class="n">resultPlotUpdateSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

    <span class="c1"># show the plot as a regular in-workspace object</span>
    <span class="n">forcePlotDisplaySignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

    <span class="c1"># Update the masked ranges in fitting</span>
    <span class="n">updateMaskedDataSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">()</span></div>

<div class="viewcode-block" id="updateModelItemWithPlot"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.updateModelItemWithPlot">[docs]</a><span class="k">def</span> <span class="nf">updateModelItemWithPlot</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">update_data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">checkbox_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds a checkboxed row named &quot;name&quot; to QStandardItem</span>
<span class="sd">    Adds &#39;update_data&#39; to that row.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">)</span>

    <span class="c1"># Check if data with the same ID is already present</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
        <span class="n">plot_item</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">plot_item</span><span class="o">.</span><span class="n">isCheckable</span><span class="p">():</span>
            <span class="k">continue</span>
        <span class="n">plot_data</span> <span class="o">=</span> <span class="n">plot_item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">plot_data</span><span class="o">.</span><span class="n">id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> \
                <span class="n">plot_data</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">update_data</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="c1">#(plot_data.name == update_data.name or plot_data.id == update_data.id):</span>
            <span class="c1"># if plot_data.id is not None and plot_data.id == update_data.id:</span>
            <span class="c1"># replace data section in item</span>
            <span class="n">plot_item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">update_data</span><span class="p">)</span>
            <span class="n">plot_item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="c1"># Plot title if any</span>
            <span class="k">if</span> <span class="n">plot_item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">hasChildren</span><span class="p">():</span>
                <span class="n">plot_item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Title: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">name</span><span class="p">)</span>
            <span class="c1"># Force redisplay</span>
            <span class="k">return</span>
    <span class="c1"># Create the new item</span>
    <span class="n">checkbox_item</span> <span class="o">=</span> <span class="n">createModelItemWithPlot</span><span class="p">(</span><span class="n">update_data</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">checkbox_state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">checkbox_item</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">checkbox_state</span><span class="p">)</span>
    <span class="c1"># Append the new row to the main item</span>
    <span class="n">item</span><span class="o">.</span><span class="n">appendRow</span><span class="p">(</span><span class="n">checkbox_item</span><span class="p">)</span></div>

<div class="viewcode-block" id="deleteRedundantPlots"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.deleteRedundantPlots">[docs]</a><span class="k">def</span> <span class="nf">deleteRedundantPlots</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">new_plots</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks all plots that are children of the given item; if any have an ID or name not included in new_plots,</span>
<span class="sd">    it is deleted. Useful for e.g. switching from P(Q)S(Q) to P(Q); this would remove the old S(Q) plot.</span>

<span class="sd">    Ensure that new_plots contains ALL the relevant plots(!!!)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">)</span>

    <span class="c1"># lists of plots names/ids for all deletable plots on item</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">new_plots</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">new_plots</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>

    <span class="n">items_to_delete</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
        <span class="n">plot_item</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">plot_item</span><span class="o">.</span><span class="n">isCheckable</span><span class="p">():</span>
            <span class="k">continue</span>
        <span class="n">plot_data</span> <span class="o">=</span> <span class="n">plot_item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">plot_data</span><span class="o">.</span><span class="n">id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="n">plot_data</span><span class="o">.</span><span class="n">id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">)</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="n">plot_data</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">names</span><span class="p">)</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="n">plot_data</span><span class="o">.</span><span class="n">plot_role</span> <span class="o">==</span> <span class="n">Data1D</span><span class="o">.</span><span class="n">ROLE_DELETABLE</span><span class="p">):</span>
            <span class="n">items_to_delete</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plot_item</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">plot_item</span> <span class="ow">in</span> <span class="n">items_to_delete</span><span class="p">:</span>
        <span class="n">item</span><span class="o">.</span><span class="n">removeRow</span><span class="p">(</span><span class="n">plot_item</span><span class="o">.</span><span class="n">row</span><span class="p">())</span></div>

<div class="viewcode-block" id="HashableStandardItem"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.HashableStandardItem">[docs]</a><span class="k">class</span> <span class="nc">HashableStandardItem</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Subclassed standard item with reimplemented __hash__</span>
<span class="sd">    to allow for use as an index.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">HashableStandardItem</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; just a random hash value &#39;&#39;&#39;</span>
        <span class="c1">#return hash(self.__init__)</span>
        <span class="k">return</span> <span class="mi">0</span>

<div class="viewcode-block" id="HashableStandardItem.clone"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.HashableStandardItem.clone">[docs]</a>    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Assure __hash__ is cloned as well&#39;&#39;&#39;</span>
        <span class="n">clone</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">HashableStandardItem</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="n">clone</span><span class="o">.</span><span class="fm">__hash__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__hash__</span>
        <span class="k">return</span> <span class="n">clone</span></div></div>

<div class="viewcode-block" id="getMonospaceFont"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.getMonospaceFont">[docs]</a><span class="k">def</span> <span class="nf">getMonospaceFont</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Convenience function; returns a monospace font to be used in any shells, code editors, etc.&quot;&quot;&quot;</span>

    <span class="c1"># Note: Consolas is only available on Windows; the style hint is used on other operating systems</span>
    <span class="n">font</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Consolas&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">font</span><span class="o">.</span><span class="n">setStyleHint</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QFont</span><span class="o">.</span><span class="n">Monospace</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFont</span><span class="o">.</span><span class="n">PreferQuality</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">font</span></div>

<div class="viewcode-block" id="createModelItemWithPlot"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.createModelItemWithPlot">[docs]</a><span class="k">def</span> <span class="nf">createModelItemWithPlot</span><span class="p">(</span><span class="n">update_data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a checkboxed QStandardItem named &quot;name&quot;</span>
<span class="sd">    Adds &#39;update_data&#39; to that row.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">py_update_data</span> <span class="o">=</span> <span class="n">update_data</span>

    <span class="n">checkbox_item</span> <span class="o">=</span> <span class="n">HashableStandardItem</span><span class="p">()</span>
    <span class="n">checkbox_item</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">checkbox_item</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">)</span>
    <span class="n">checkbox_item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="c1"># Add &quot;Info&quot; item</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">py_update_data</span><span class="p">,</span> <span class="p">(</span><span class="n">Data1D</span><span class="p">,</span> <span class="n">Data2D</span><span class="p">)):</span>
        <span class="c1"># If Data1/2D added - extract Info from it</span>
        <span class="n">info_item</span> <span class="o">=</span> <span class="n">infoFromData</span><span class="p">(</span><span class="n">py_update_data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># otherwise just add a naked item</span>
        <span class="n">info_item</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="s2">&quot;Info&quot;</span><span class="p">)</span>

    <span class="c1"># Add the actual Data1D/Data2D object</span>
    <span class="n">object_item</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">()</span>
    <span class="n">object_item</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">update_data</span><span class="p">)</span>

    <span class="c1"># Set the data object as the first child</span>
    <span class="n">checkbox_item</span><span class="o">.</span><span class="n">setChild</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">object_item</span><span class="p">)</span>

    <span class="c1"># Set info_item as the second child</span>
    <span class="n">checkbox_item</span><span class="o">.</span><span class="n">setChild</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">info_item</span><span class="p">)</span>

    <span class="c1"># And return the newly created item</span>
    <span class="k">return</span> <span class="n">checkbox_item</span></div>

<div class="viewcode-block" id="updateModelItem"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.updateModelItem">[docs]</a><span class="k">def</span> <span class="nf">updateModelItem</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">update_data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds a simple named child to QStandardItem</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">)</span>

    <span class="c1"># Add the actual Data1D/Data2D object</span>
    <span class="n">object_item</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">()</span>
    <span class="n">object_item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">object_item</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">update_data</span><span class="p">)</span>

    <span class="c1"># Append the new row to the main item</span>
    <span class="n">item</span><span class="o">.</span><span class="n">appendRow</span><span class="p">(</span><span class="n">object_item</span><span class="p">)</span></div>

<div class="viewcode-block" id="updateModelItemStatus"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.updateModelItemStatus">[docs]</a><span class="k">def</span> <span class="nf">updateModelItemStatus</span><span class="p">(</span><span class="n">model_item</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update status of checkbox related to high- and low-Q extrapolation</span>
<span class="sd">    choice in Invariant Panel</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model_item</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItemModel</span><span class="p">)</span>

    <span class="c1"># Iterate over model looking for items with checkboxes</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model_item</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">model_item</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="n">filename</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">isCheckable</span><span class="p">()</span> \
                <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">:</span>
            <span class="c1"># Going 1 level deeper only</span>
            <span class="k">for</span> <span class="n">index_2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
                <span class="n">item_2</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">index_2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">item_2</span> <span class="ow">and</span> <span class="n">item_2</span><span class="o">.</span><span class="n">isCheckable</span><span class="p">()</span> <span class="ow">and</span> <span class="n">item_2</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                    <span class="n">item_2</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>

    <span class="k">return</span></div>

<div class="viewcode-block" id="itemFromFilename"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.itemFromFilename">[docs]</a><span class="k">def</span> <span class="nf">itemFromFilename</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">model_item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the model item text=filename in the model</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model_item</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItemModel</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>

    <span class="c1"># Iterate over model looking for named items</span>
    <span class="n">item</span> <span class="o">=</span> <span class="nb">list</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">model_item</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                             <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model_item</span><span class="o">.</span><span class="n">rowCount</span><span class="p">())]</span>
                 <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">text</span><span class="p">())</span> <span class="o">==</span> <span class="n">filename</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="plotsFromModel"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.plotsFromModel">[docs]</a><span class="k">def</span> <span class="nf">plotsFromModel</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">model_item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the list of plots for the item with model name in the model</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model_item</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>

    <span class="n">plot_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Iterate over model looking for named items</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model_item</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">model_item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">data</span><span class="p">(),</span> <span class="p">(</span><span class="n">Data1D</span><span class="p">,</span> <span class="n">Data2D</span><span class="p">)):</span>
            <span class="n">plot_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">data</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()):</span>
            <span class="c1">#plot_data.append(item.child(0).data())</span>
            <span class="c1"># Going 1 level deeper only</span>
            <span class="k">for</span> <span class="n">index_2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
                <span class="n">item_2</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">index_2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">item_2</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item_2</span><span class="o">.</span><span class="n">data</span><span class="p">(),</span> <span class="p">(</span><span class="n">Data1D</span><span class="p">,</span> <span class="n">Data2D</span><span class="p">)):</span>
                    <span class="n">plot_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item_2</span><span class="o">.</span><span class="n">data</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">plot_data</span></div>

<div class="viewcode-block" id="plotsFromFilename"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.plotsFromFilename">[docs]</a><span class="k">def</span> <span class="nf">plotsFromFilename</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">model_item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the list of plots for the item with text=filename in the model</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model_item</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItemModel</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>

    <span class="n">plot_data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># Iterate over model looking for named items</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model_item</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">model_item</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()):</span>
            <span class="c1"># TODO: assure item type is correct (either data1/2D or Plotter)</span>
            <span class="n">plot_data</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">()</span>
            <span class="c1"># Going 1 level deeper only</span>
            <span class="k">for</span> <span class="n">index_2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
                <span class="n">item_2</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">index_2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">item_2</span> <span class="ow">and</span> <span class="n">item_2</span><span class="o">.</span><span class="n">isCheckable</span><span class="p">():</span>
                    <span class="c1"># TODO: assure item type is correct (either data1/2D or Plotter)</span>
                    <span class="n">plot_data</span><span class="p">[</span><span class="n">item_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">item_2</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">plot_data</span></div>

<div class="viewcode-block" id="getChildrenFromItem"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.getChildrenFromItem">[docs]</a><span class="k">def</span> <span class="nf">getChildrenFromItem</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Recursively go down the model item looking for all children</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">recurse</span><span class="p">(</span><span class="n">parent</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">columnCount</span><span class="p">()):</span>
                <span class="n">child</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">child</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">hasChildren</span><span class="p">():</span>
                    <span class="k">yield from</span> <span class="n">recurse</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">root</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">yield from</span> <span class="n">recurse</span><span class="p">(</span><span class="n">root</span><span class="p">)</span></div>

<div class="viewcode-block" id="plotsFromCheckedItems"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.plotsFromCheckedItems">[docs]</a><span class="k">def</span> <span class="nf">plotsFromCheckedItems</span><span class="p">(</span><span class="n">model_item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the list of plots for items in the model which are checked</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model_item</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItemModel</span><span class="p">)</span>

    <span class="n">plot_data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Iterate over model looking for items with checkboxes</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model_item</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">model_item</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">isCheckable</span><span class="p">()</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">()</span>
            <span class="n">plot_data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">item</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>

        <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">getChildrenFromItem</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">isCheckable</span><span class="p">()</span> <span class="ow">and</span> <span class="n">it</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">()</span>
                <span class="n">plot_data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">it</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">plot_data</span></div>

<div class="viewcode-block" id="infoFromData"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.infoFromData">[docs]</a><span class="k">def</span> <span class="nf">infoFromData</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given Data1D/Data2D object, extract relevant Info elements</span>
<span class="sd">    and add them to a model item</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">Data1D</span><span class="p">,</span> <span class="n">Data2D</span><span class="p">))</span>

    <span class="n">info_item</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="s2">&quot;Info&quot;</span><span class="p">)</span>

    <span class="n">title_item</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="s2">&quot;Title: &quot;</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
    <span class="n">info_item</span><span class="o">.</span><span class="n">appendRow</span><span class="p">(</span><span class="n">title_item</span><span class="p">)</span>
    <span class="n">run_item</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="s2">&quot;Run: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">run</span><span class="p">))</span>
    <span class="n">info_item</span><span class="o">.</span><span class="n">appendRow</span><span class="p">(</span><span class="n">run_item</span><span class="p">)</span>
    <span class="n">type_item</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="s2">&quot;Type: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
    <span class="n">info_item</span><span class="o">.</span><span class="n">appendRow</span><span class="p">(</span><span class="n">type_item</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
        <span class="n">path_item</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="s2">&quot;Path: &quot;</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="n">info_item</span><span class="o">.</span><span class="n">appendRow</span><span class="p">(</span><span class="n">path_item</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">instrument</span><span class="p">:</span>
        <span class="n">instr_item</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="s2">&quot;Instrument: &quot;</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">instrument</span><span class="p">)</span>
        <span class="n">info_item</span><span class="o">.</span><span class="n">appendRow</span><span class="p">(</span><span class="n">instr_item</span><span class="p">)</span>

    <span class="n">process_item</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="s2">&quot;Process&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">process</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">process</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">process</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">process</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">process</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">process_date</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">date</span>
            <span class="n">process_date_item</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="s2">&quot;Date: &quot;</span> <span class="o">+</span> <span class="n">process_date</span><span class="p">)</span>
            <span class="n">process_item</span><span class="o">.</span><span class="n">appendRow</span><span class="p">(</span><span class="n">process_date_item</span><span class="p">)</span>

            <span class="n">process_descr</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">description</span>
            <span class="n">process_descr_item</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="s2">&quot;Description: &quot;</span> <span class="o">+</span> <span class="n">process_descr</span><span class="p">)</span>
            <span class="n">process_item</span><span class="o">.</span><span class="n">appendRow</span><span class="p">(</span><span class="n">process_descr_item</span><span class="p">)</span>

            <span class="n">process_name</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">name</span>
            <span class="n">process_name_item</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="s2">&quot;Name: &quot;</span> <span class="o">+</span> <span class="n">process_name</span><span class="p">)</span>
            <span class="n">process_item</span><span class="o">.</span><span class="n">appendRow</span><span class="p">(</span><span class="n">process_name_item</span><span class="p">)</span>

    <span class="n">info_item</span><span class="o">.</span><span class="n">appendRow</span><span class="p">(</span><span class="n">process_item</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">info_item</span></div>

<div class="viewcode-block" id="dataFromItem"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.dataFromItem">[docs]</a><span class="k">def</span> <span class="nf">dataFromItem</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve Data1D/2D component from QStandardItem.</span>
<span class="sd">    The assumption - data stored in SasView standard, in child 0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="openLink"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.openLink">[docs]</a><span class="k">def</span> <span class="nf">openLink</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Open a URL in an external browser.</span>
<span class="sd">    Check the URL first, though.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parsed_url</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span><span class="p">:</span>
        <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Attempt at opening an invalid URL&quot;</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="showHelp"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.showHelp">[docs]</a><span class="k">def</span> <span class="nf">showHelp</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Open a local url in the default browser</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">location</span> <span class="o">=</span> <span class="n">HELP_DIRECTORY_LOCATION</span> <span class="o">+</span> <span class="n">url</span>
    <span class="c1">#WP: Added to handle OSX bundle docs</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">location</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">sas_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">location</span> <span class="o">=</span> <span class="n">sas_path</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">location</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;file://&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">location</span><span class="p">))</span>
    <span class="k">except</span> <span class="n">webbrowser</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Cannot display help. </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ex</span><span class="p">)</span></div>

<div class="viewcode-block" id="retrieveData1d"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.retrieveData1d">[docs]</a><span class="k">def</span> <span class="nf">retrieveData1d</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve 1D data from file and construct its text</span>
<span class="sd">    representation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">Data1D</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Incorrect type passed to retrieveData1d&quot;</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Unable to find min/max of </span><span class="se">\n</span><span class="s2"> data named </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> \
                    <span class="n">data</span><span class="o">.</span><span class="n">filename</span>
        <span class="c1">#logging.error(msg)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">text</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
    <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;Data Min Max:</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;X_min = </span><span class="si">%s</span><span class="s1">:  X_max = </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>
    <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;Y_min = </span><span class="si">%s</span><span class="s1">:  Y_max = </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">dy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;dY_min = </span><span class="si">%s</span><span class="s1">:  dY_max = </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">dy</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">dy</span><span class="p">))</span>
    <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Data Points:</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">x_st</span> <span class="o">=</span> <span class="s2">&quot;X&quot;</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">dy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">dy</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">index</span><span class="p">:</span>
            <span class="n">dy_val</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dy_val</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">dx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">dx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">index</span><span class="p">:</span>
            <span class="n">dx_val</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dx_val</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">dxl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">dxl</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">index</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">x_st</span> <span class="o">=</span> <span class="s2">&quot;Xl&quot;</span>
            <span class="n">dx_val</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dxl</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">data</span><span class="o">.</span><span class="n">dxw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">dxw</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">index</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">x_st</span> <span class="o">=</span> <span class="s2">&quot;Xw&quot;</span>
            <span class="n">dx_val</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dxw</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&lt;index&gt; </span><span class="se">\t</span><span class="s2">&lt;X&gt; </span><span class="se">\t</span><span class="s2">&lt;Y&gt; </span><span class="se">\t</span><span class="s2">&lt;dY&gt; </span><span class="se">\t</span><span class="s2">&lt;d</span><span class="si">%s</span><span class="s2">&gt;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">x_st</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="se">\t</span><span class="si">%s</span><span class="s2"> </span><span class="se">\t</span><span class="si">%s</span><span class="s2"> </span><span class="se">\t</span><span class="si">%s</span><span class="s2"> </span><span class="se">\t</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span>
                                                <span class="n">data</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                                                <span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                                                <span class="n">dy_val</span><span class="p">,</span>
                                                <span class="n">dx_val</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text</span></div>

<div class="viewcode-block" id="retrieveData2d"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.retrieveData2d">[docs]</a><span class="k">def</span> <span class="nf">retrieveData2d</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve 2D data from file and construct its text</span>
<span class="sd">    representation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">Data2D</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Incorrect type passed to retrieveData2d&quot;</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">text</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
    <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;Data Min Max:</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;I_min = </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">min</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;I_max = </span><span class="si">%s</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;Data (First 2501) Points:</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;Data columns include err(I).</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;ASCII data starts here.</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&lt;index&gt; </span><span class="se">\t</span><span class="s2">&lt;Qx&gt; </span><span class="se">\t</span><span class="s2">&lt;Qy&gt; </span><span class="se">\t</span><span class="s2">&lt;I&gt; </span><span class="se">\t</span><span class="s2">&lt;dI&gt; </span><span class="se">\t</span><span class="s2">&lt;dQparal&gt; </span><span class="se">\t</span><span class="s2">&lt;dQperp&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">di_val</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">dx_val</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">dy_val</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">len_data</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">qx_data</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">len_data</span><span class="p">):</span>
        <span class="n">x_val</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">qx_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">y_val</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">qy_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">i_val</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">err_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">di_val</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">err_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">dqx_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dx_val</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dqx_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">dqy_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dy_val</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dqy_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="se">\t</span><span class="si">%s</span><span class="s2"> </span><span class="se">\t</span><span class="si">%s</span><span class="s2"> </span><span class="se">\t</span><span class="si">%s</span><span class="s2"> </span><span class="se">\t</span><span class="si">%s</span><span class="s2"> </span><span class="se">\t</span><span class="si">%s</span><span class="s2"> </span><span class="se">\t</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span>
                                                        <span class="n">x_val</span><span class="p">,</span>
                                                        <span class="n">y_val</span><span class="p">,</span>
                                                        <span class="n">i_val</span><span class="p">,</span>
                                                        <span class="n">di_val</span><span class="p">,</span>
                                                        <span class="n">dx_val</span><span class="p">,</span>
                                                        <span class="n">dy_val</span><span class="p">)</span>
        <span class="c1"># Takes too long time for typical data2d: Break here</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="mi">2500</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;.............</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">break</span>

    <span class="k">return</span> <span class="n">text</span></div>

<div class="viewcode-block" id="onTXTSave"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.onTXTSave">[docs]</a><span class="k">def</span> <span class="nf">onTXTSave</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save file as formatted txt</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out</span><span class="p">:</span>
        <span class="n">has_errors</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">dy</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">dy</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">has_errors</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Sanity check</span>
        <span class="k">if</span> <span class="n">has_errors</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">dy</span><span class="p">):</span>
                    <span class="n">has_errors</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">has_errors</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">has_errors</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">dx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;X&gt;&quot;</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="mi">20</span><span class="o">+</span> <span class="s2">&quot;&lt;Y&gt;&quot;</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="mi">20</span><span class="o">+</span><span class="s2">&quot;&lt;dY&gt;&quot;</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="mi">20</span><span class="o">+</span><span class="s2">&quot;&lt;dX&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1">#out.write(&quot;&lt;X&gt;   &lt;Y&gt;   &lt;dY&gt;   &lt;dX&gt;\n&quot;)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;X&gt;&quot;</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="mi">20</span><span class="o">+</span> <span class="s2">&quot;&lt;Y&gt;&quot;</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="mi">20</span><span class="o">+</span><span class="s2">&quot;&lt;dY&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;X&gt;&quot;</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="mi">20</span><span class="o">+</span> <span class="s2">&quot;&lt;Y&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">has_errors</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">dx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                    <span class="k">if</span>  <span class="n">data</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.15e</span><span class="s2">  </span><span class="si">%.15e</span><span class="s2">  </span><span class="si">%.15e</span><span class="s2">  </span><span class="si">%.15e</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                        <span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                        <span class="n">data</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                        <span class="n">data</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.15e</span><span class="s2">  </span><span class="si">%.15e</span><span class="s2">  </span><span class="si">%.15e</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                    <span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                    <span class="n">data</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.15e</span><span class="s2">  </span><span class="si">%.15e</span><span class="s2">  </span><span class="si">%.15e</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                <span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                <span class="n">data</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.15e</span><span class="s2">  </span><span class="si">%.15e</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                        <span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span></div>

<div class="viewcode-block" id="saveData1D"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.saveData1D">[docs]</a><span class="k">def</span> <span class="nf">saveData1D</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save 1D data points</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">default_name</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">default_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">extension</span><span class="p">:</span>
        <span class="n">extension</span> <span class="o">=</span> <span class="s2">&quot;.txt&quot;</span>
    <span class="n">default_name</span> <span class="o">+=</span> <span class="s2">&quot;_out&quot;</span> <span class="o">+</span> <span class="n">extension</span>

    <span class="n">wildcard</span> <span class="o">=</span> <span class="s2">&quot;Text files (*.txt);;&quot;</span>\
                <span class="s2">&quot;CanSAS 1D files(*.xml);;&quot;</span>\
                <span class="s2">&quot;NXcanSAS files (*.h5)&quot;</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;caption&#39;</span>   <span class="p">:</span> <span class="s1">&#39;Save As&#39;</span><span class="p">,</span>
        <span class="c1">#&#39;directory&#39; : default_name,</span>
        <span class="s1">&#39;filter&#39;</span>    <span class="p">:</span> <span class="n">wildcard</span><span class="p">,</span>
        <span class="s1">&#39;parent&#39;</span>    <span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;options&#39;</span>   <span class="p">:</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">DontUseNativeDialog</span>
    <span class="p">}</span>
    <span class="c1"># Query user for filename.</span>
    <span class="n">filename_tuple</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">filename_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># User cancelled.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># Check/add extension</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="n">filename_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;Text files&#39;</span> <span class="ow">in</span> <span class="n">ext</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">+=</span> <span class="s1">&#39;.txt&#39;</span>
        <span class="k">elif</span> <span class="s1">&#39;CanSAS&#39;</span> <span class="ow">in</span> <span class="n">ext</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">+=</span> <span class="s1">&#39;.xml&#39;</span>
        <span class="k">elif</span> <span class="s1">&#39;NXcanSAS&#39;</span> <span class="ow">in</span> <span class="n">ext</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">+=</span> <span class="s1">&#39;.h5&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="c1">#Instantiate a loader</span>
    <span class="n">loader</span> <span class="o">=</span> <span class="n">Loader</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.txt&quot;</span><span class="p">:</span>
        <span class="n">onTXTSave</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.xml&quot;</span><span class="p">:</span>
        <span class="n">loader</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s2">&quot;.xml&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.h5&quot;</span><span class="p">:</span>
        <span class="n">nxcansaswriter</span> <span class="o">=</span> <span class="n">NXcanSASWriter</span><span class="p">()</span>
        <span class="n">nxcansaswriter</span><span class="o">.</span><span class="n">write</span><span class="p">([</span><span class="n">data</span><span class="p">],</span> <span class="n">filename</span><span class="p">)</span></div>

<div class="viewcode-block" id="saveData2D"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.saveData2D">[docs]</a><span class="k">def</span> <span class="nf">saveData2D</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save data2d dialog</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">default_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">default_name</span><span class="p">)</span>
    <span class="n">ext_format</span> <span class="o">=</span> <span class="s2">&quot;.dat&quot;</span>
    <span class="n">default_name</span> <span class="o">+=</span> <span class="s2">&quot;_out&quot;</span> <span class="o">+</span> <span class="n">ext_format</span>

    <span class="n">wildcard</span> <span class="o">=</span> <span class="s2">&quot;IGOR/DAT 2D file in Q_map (*.dat);;&quot;</span>\
                <span class="s2">&quot;NXcanSAS files (*.h5)&quot;</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;caption&#39;</span>   <span class="p">:</span> <span class="s1">&#39;Save As&#39;</span><span class="p">,</span>
        <span class="s1">&#39;filter&#39;</span>    <span class="p">:</span> <span class="n">wildcard</span><span class="p">,</span>
        <span class="s1">&#39;parent&#39;</span>    <span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;options&#39;</span>   <span class="p">:</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">DontUseNativeDialog</span>
    <span class="p">}</span>
    <span class="c1"># Query user for filename.</span>
    <span class="n">filename_tuple</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">filename_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># User cancelled.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># Check/add extension</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="n">filename_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;IGOR&#39;</span> <span class="ow">in</span> <span class="n">ext</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">+=</span> <span class="s1">&#39;.dat&#39;</span>
        <span class="k">elif</span> <span class="s1">&#39;NXcanSAS&#39;</span> <span class="ow">in</span> <span class="n">ext</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">+=</span> <span class="s1">&#39;.h5&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="c1">#Instantiate a loader</span>
    <span class="n">loader</span> <span class="o">=</span> <span class="n">Loader</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">ext_format</span><span class="p">:</span>
        <span class="n">loader</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ext_format</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.h5&quot;</span><span class="p">:</span>
        <span class="n">nxcansaswriter</span> <span class="o">=</span> <span class="n">NXcanSASWriter</span><span class="p">()</span>
        <span class="n">nxcansaswriter</span><span class="o">.</span><span class="n">write</span><span class="p">([</span><span class="n">data</span><span class="p">],</span> <span class="n">filename</span><span class="p">)</span></div>


<div class="viewcode-block" id="FormulaValidator"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.FormulaValidator">[docs]</a><span class="k">class</span> <span class="nc">FormulaValidator</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QValidator</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">FormulaValidator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

<div class="viewcode-block" id="FormulaValidator.validate"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.FormulaValidator.validate">[docs]</a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QValidator</span><span class="o">.</span><span class="n">Acceptable</span><span class="p">,</span> <span class="n">pos</span></div>

        <span class="c1">#try:</span>
        <span class="c1">#    Formula(str(input))</span>
        <span class="c1">#    self._setStyleSheet(&quot;&quot;)</span>
        <span class="c1">#    return QtGui.QValidator.Acceptable, pos</span>

        <span class="c1">#except Exception as e:</span>
        <span class="c1">#    self._setStyleSheet(&quot;background-color:pink;&quot;)</span>
        <span class="c1">#    return QtGui.QValidator.Intermediate, pos</span>

    <span class="k">def</span> <span class="nf">_setStyleSheet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="xyTransform"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.xyTransform">[docs]</a><span class="k">def</span> <span class="nf">xyTransform</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">xLabel</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">yLabel</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transforms x and y in View and set the scale</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Changing the scale might be incompatible with</span>
    <span class="c1"># currently displayed data (for instance, going</span>
    <span class="c1"># from ln to log when all plotted values have</span>
    <span class="c1"># negative natural logs).</span>
    <span class="c1"># Go linear and only change the scale at the end.</span>
    <span class="n">xscale</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span>
    <span class="n">yscale</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span>
    <span class="c1"># Local data is either 1D or 2D</span>
    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="s1">&#39;fit&#39;</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># make sure we have some function to operate on</span>
    <span class="k">if</span> <span class="n">xLabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xLabel</span> <span class="o">=</span> <span class="s1">&#39;log10(x)&#39;</span>
    <span class="k">if</span> <span class="n">yLabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">yLabel</span> <span class="o">=</span> <span class="s1">&#39;log10(y)&#39;</span>

    <span class="c1"># control axis labels from the panel itself</span>
    <span class="n">yname</span><span class="p">,</span> <span class="n">yunits</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span>
    <span class="n">xname</span><span class="p">,</span> <span class="n">xunits</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span>

    <span class="c1"># Goes through all possible scales</span>
    <span class="c1"># self.x_label is already wrapped with Latex &quot;$&quot;, so using the argument</span>

    <span class="c1"># X</span>
    <span class="k">if</span> <span class="n">xLabel</span> <span class="o">==</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">transformX</span><span class="p">(</span><span class="n">DataTransform</span><span class="o">.</span><span class="n">toX</span><span class="p">,</span> <span class="n">DataTransform</span><span class="o">.</span><span class="n">errToX</span><span class="p">)</span>
        <span class="n">xLabel</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">xname</span><span class="p">,</span> <span class="n">xunits</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xLabel</span> <span class="o">==</span> <span class="s2">&quot;x^(2)&quot;</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">transformX</span><span class="p">(</span><span class="n">DataTransform</span><span class="o">.</span><span class="n">toX2</span><span class="p">,</span> <span class="n">DataTransform</span><span class="o">.</span><span class="n">errToX2</span><span class="p">)</span>
        <span class="n">xunits</span> <span class="o">=</span> <span class="n">convertUnit</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">xunits</span><span class="p">)</span>
        <span class="n">xLabel</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">^</span><span class="si">{2}</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">xname</span><span class="p">,</span> <span class="n">xunits</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xLabel</span> <span class="o">==</span> <span class="s2">&quot;x^(4)&quot;</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">transformX</span><span class="p">(</span><span class="n">DataTransform</span><span class="o">.</span><span class="n">toX4</span><span class="p">,</span> <span class="n">DataTransform</span><span class="o">.</span><span class="n">errToX4</span><span class="p">)</span>
        <span class="n">xunits</span> <span class="o">=</span> <span class="n">convertUnit</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">xunits</span><span class="p">)</span>
        <span class="n">xLabel</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">^</span><span class="si">{4}</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">xname</span><span class="p">,</span> <span class="n">xunits</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xLabel</span> <span class="o">==</span> <span class="s2">&quot;ln(x)&quot;</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">transformX</span><span class="p">(</span><span class="n">DataTransform</span><span class="o">.</span><span class="n">toLogX</span><span class="p">,</span> <span class="n">DataTransform</span><span class="o">.</span><span class="n">errToLogX</span><span class="p">)</span>
        <span class="n">xLabel</span> <span class="o">=</span> <span class="s2">&quot;\ln{(</span><span class="si">%s</span><span class="s2">)}(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">xname</span><span class="p">,</span> <span class="n">xunits</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xLabel</span> <span class="o">==</span> <span class="s2">&quot;log10(x)&quot;</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">transformX</span><span class="p">(</span><span class="n">DataTransform</span><span class="o">.</span><span class="n">toX_pos</span><span class="p">,</span> <span class="n">DataTransform</span><span class="o">.</span><span class="n">errToX_pos</span><span class="p">)</span>
        <span class="n">xscale</span> <span class="o">=</span> <span class="s1">&#39;log&#39;</span>
        <span class="n">xLabel</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">xname</span><span class="p">,</span> <span class="n">xunits</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xLabel</span> <span class="o">==</span> <span class="s2">&quot;log10(x^(4))&quot;</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">transformX</span><span class="p">(</span><span class="n">DataTransform</span><span class="o">.</span><span class="n">toX4</span><span class="p">,</span> <span class="n">DataTransform</span><span class="o">.</span><span class="n">errToX4</span><span class="p">)</span>
        <span class="n">xunits</span> <span class="o">=</span> <span class="n">convertUnit</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">xunits</span><span class="p">)</span>
        <span class="n">xLabel</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">^</span><span class="si">{4}</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">xname</span><span class="p">,</span> <span class="n">xunits</span><span class="p">)</span>
        <span class="n">xscale</span> <span class="o">=</span> <span class="s1">&#39;log&#39;</span>

    <span class="c1"># Y</span>
    <span class="k">if</span> <span class="n">yLabel</span> <span class="o">==</span> <span class="s2">&quot;ln(y)&quot;</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">transformY</span><span class="p">(</span><span class="n">DataTransform</span><span class="o">.</span><span class="n">toLogX</span><span class="p">,</span> <span class="n">DataTransform</span><span class="o">.</span><span class="n">errToLogX</span><span class="p">)</span>
        <span class="n">yLabel</span> <span class="o">=</span> <span class="s2">&quot;\ln{(</span><span class="si">%s</span><span class="s2">)}(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">yname</span><span class="p">,</span> <span class="n">yunits</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">yLabel</span> <span class="o">==</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">transformY</span><span class="p">(</span><span class="n">DataTransform</span><span class="o">.</span><span class="n">toX</span><span class="p">,</span> <span class="n">DataTransform</span><span class="o">.</span><span class="n">errToX</span><span class="p">)</span>
        <span class="n">yLabel</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">yname</span><span class="p">,</span> <span class="n">yunits</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">yLabel</span> <span class="o">==</span> <span class="s2">&quot;log10(y)&quot;</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">transformY</span><span class="p">(</span><span class="n">DataTransform</span><span class="o">.</span><span class="n">toX_pos</span><span class="p">,</span> <span class="n">DataTransform</span><span class="o">.</span><span class="n">errToX_pos</span><span class="p">)</span>
        <span class="n">yscale</span> <span class="o">=</span> <span class="s1">&#39;log&#39;</span>
        <span class="n">yLabel</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">yname</span><span class="p">,</span> <span class="n">yunits</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">yLabel</span> <span class="o">==</span> <span class="s2">&quot;y^(2)&quot;</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">transformY</span><span class="p">(</span><span class="n">DataTransform</span><span class="o">.</span><span class="n">toX2</span><span class="p">,</span> <span class="n">DataTransform</span><span class="o">.</span><span class="n">errToX2</span><span class="p">)</span>
        <span class="n">yunits</span> <span class="o">=</span> <span class="n">convertUnit</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">yunits</span><span class="p">)</span>
        <span class="n">yLabel</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">^</span><span class="si">{2}</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">yname</span><span class="p">,</span> <span class="n">yunits</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">yLabel</span> <span class="o">==</span> <span class="s2">&quot;1/y&quot;</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">transformY</span><span class="p">(</span><span class="n">DataTransform</span><span class="o">.</span><span class="n">toOneOverX</span><span class="p">,</span> <span class="n">DataTransform</span><span class="o">.</span><span class="n">errOneOverX</span><span class="p">)</span>
        <span class="n">yunits</span> <span class="o">=</span> <span class="n">convertUnit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">yunits</span><span class="p">)</span>
        <span class="n">yLabel</span> <span class="o">=</span> <span class="s2">&quot;1/</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">yname</span><span class="p">,</span> <span class="n">yunits</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">yLabel</span> <span class="o">==</span> <span class="s2">&quot;y*x^(2)&quot;</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">transformY</span><span class="p">(</span><span class="n">DataTransform</span><span class="o">.</span><span class="n">toYX2</span><span class="p">,</span> <span class="n">DataTransform</span><span class="o">.</span><span class="n">errToYX2</span><span class="p">)</span>
        <span class="n">xunits</span> <span class="o">=</span> <span class="n">convertUnit</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">xunits</span><span class="p">)</span>
        <span class="n">yLabel</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> \ \ </span><span class="si">%s</span><span class="s2">^</span><span class="si">{2}</span><span class="s2">(</span><span class="si">%s%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">yname</span><span class="p">,</span> <span class="n">xname</span><span class="p">,</span> <span class="n">yunits</span><span class="p">,</span> <span class="n">xunits</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">yLabel</span> <span class="o">==</span> <span class="s2">&quot;y*x^(4)&quot;</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">transformY</span><span class="p">(</span><span class="n">DataTransform</span><span class="o">.</span><span class="n">toYX4</span><span class="p">,</span> <span class="n">DataTransform</span><span class="o">.</span><span class="n">errToYX4</span><span class="p">)</span>
        <span class="n">xunits</span> <span class="o">=</span> <span class="n">convertUnit</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">xunits</span><span class="p">)</span>
        <span class="n">yLabel</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> \ \ </span><span class="si">%s</span><span class="s2">^</span><span class="si">{4}</span><span class="s2">(</span><span class="si">%s%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">yname</span><span class="p">,</span> <span class="n">xname</span><span class="p">,</span> <span class="n">yunits</span><span class="p">,</span> <span class="n">xunits</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">yLabel</span> <span class="o">==</span> <span class="s2">&quot;1/sqrt(y)&quot;</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">transformY</span><span class="p">(</span><span class="n">DataTransform</span><span class="o">.</span><span class="n">toOneOverSqrtX</span><span class="p">,</span> <span class="n">DataTransform</span><span class="o">.</span><span class="n">errOneOverSqrtX</span><span class="p">)</span>
        <span class="n">yunits</span> <span class="o">=</span> <span class="n">convertUnit</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">yunits</span><span class="p">)</span>
        <span class="n">yLabel</span> <span class="o">=</span> <span class="s2">&quot;1/\sqrt{</span><span class="si">%s</span><span class="s2">}(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">yname</span><span class="p">,</span> <span class="n">yunits</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">yLabel</span> <span class="o">==</span> <span class="s2">&quot;ln(y*x)&quot;</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">transformY</span><span class="p">(</span><span class="n">DataTransform</span><span class="o">.</span><span class="n">toLogXY</span><span class="p">,</span> <span class="n">DataTransform</span><span class="o">.</span><span class="n">errToLogXY</span><span class="p">)</span>
        <span class="n">yLabel</span> <span class="o">=</span> <span class="s2">&quot;\ln{(</span><span class="si">%s</span><span class="s2"> \ \ </span><span class="si">%s</span><span class="s2">)}(</span><span class="si">%s%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">yname</span><span class="p">,</span> <span class="n">xname</span><span class="p">,</span> <span class="n">yunits</span><span class="p">,</span> <span class="n">xunits</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">yLabel</span> <span class="o">==</span> <span class="s2">&quot;ln(y*x^(2))&quot;</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">transformY</span><span class="p">(</span><span class="n">DataTransform</span><span class="o">.</span><span class="n">toLogYX2</span><span class="p">,</span> <span class="n">DataTransform</span><span class="o">.</span><span class="n">errToLogYX2</span><span class="p">)</span>
        <span class="n">xunits</span> <span class="o">=</span> <span class="n">convertUnit</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">xunits</span><span class="p">)</span>
        <span class="n">yLabel</span> <span class="o">=</span> <span class="s2">&quot;\ln (</span><span class="si">%s</span><span class="s2"> \ \ </span><span class="si">%s</span><span class="s2">^</span><span class="si">{2}</span><span class="s2">)(</span><span class="si">%s%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">yname</span><span class="p">,</span> <span class="n">xname</span><span class="p">,</span> <span class="n">yunits</span><span class="p">,</span> <span class="n">xunits</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">yLabel</span> <span class="o">==</span> <span class="s2">&quot;ln(y*x^(4))&quot;</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">transformY</span><span class="p">(</span><span class="n">DataTransform</span><span class="o">.</span><span class="n">toLogYX4</span><span class="p">,</span> <span class="n">DataTransform</span><span class="o">.</span><span class="n">errToLogYX4</span><span class="p">)</span>
        <span class="n">xunits</span> <span class="o">=</span> <span class="n">convertUnit</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">xunits</span><span class="p">)</span>
        <span class="n">yLabel</span> <span class="o">=</span> <span class="s2">&quot;\ln (</span><span class="si">%s</span><span class="s2"> \ \ </span><span class="si">%s</span><span class="s2">^</span><span class="si">{4}</span><span class="s2">)(</span><span class="si">%s%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">yname</span><span class="p">,</span> <span class="n">xname</span><span class="p">,</span> <span class="n">yunits</span><span class="p">,</span> <span class="n">xunits</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">yLabel</span> <span class="o">==</span> <span class="s2">&quot;log10(y*x^(4))&quot;</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">transformY</span><span class="p">(</span><span class="n">DataTransform</span><span class="o">.</span><span class="n">toYX4</span><span class="p">,</span> <span class="n">DataTransform</span><span class="o">.</span><span class="n">errToYX4</span><span class="p">)</span>
        <span class="n">xunits</span> <span class="o">=</span> <span class="n">convertUnit</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">xunits</span><span class="p">)</span>
        <span class="n">yscale</span> <span class="o">=</span> <span class="s1">&#39;log&#39;</span>
        <span class="n">yLabel</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> \ \ </span><span class="si">%s</span><span class="s2">^</span><span class="si">{4}</span><span class="s2">(</span><span class="si">%s%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">yname</span><span class="p">,</span> <span class="n">xname</span><span class="p">,</span> <span class="n">yunits</span><span class="p">,</span> <span class="n">xunits</span><span class="p">)</span>

    <span class="c1"># Perform the transformation of data in data1d-&gt;View</span>
    <span class="n">data</span><span class="o">.</span><span class="n">transformView</span><span class="p">()</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">xLabel</span><span class="p">,</span> <span class="n">yLabel</span><span class="p">,</span> <span class="n">xscale</span><span class="p">,</span> <span class="n">yscale</span><span class="p">)</span></div>

<div class="viewcode-block" id="formatNumber"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.formatNumber">[docs]</a><span class="k">def</span> <span class="nf">formatNumber</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a float in a standardized, human-readable formatted string.</span>
<span class="sd">    This is used to output readable (e.g. x.xxxe-y) values to the panel.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;NaN&quot;</span>
        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">high</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%-7.5g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">value</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%-5.3g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span></div>

<div class="viewcode-block" id="replaceHTMLwithUTF8"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.replaceHTMLwithUTF8">[docs]</a><span class="k">def</span> <span class="nf">replaceHTMLwithUTF8</span><span class="p">(</span><span class="n">html</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Replace some important HTML-encoded characters</span>
<span class="sd">    with their UTF-8 equivalents</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Angstrom</span>
    <span class="n">html_out</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;#x212B;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="c1"># infinity</span>
    <span class="n">html_out</span> <span class="o">=</span> <span class="n">html_out</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;#x221e;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="c1"># +/-</span>
    <span class="n">html_out</span> <span class="o">=</span> <span class="n">html_out</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;#177;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">html_out</span></div>

<div class="viewcode-block" id="replaceHTMLwithASCII"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.replaceHTMLwithASCII">[docs]</a><span class="k">def</span> <span class="nf">replaceHTMLwithASCII</span><span class="p">(</span><span class="n">html</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Replace some important HTML-encoded characters</span>
<span class="sd">    with their ASCII equivalents</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Angstrom</span>
    <span class="n">html_out</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;#x212B;&quot;</span><span class="p">,</span> <span class="s2">&quot;Ang&quot;</span><span class="p">)</span>
    <span class="c1"># infinity</span>
    <span class="n">html_out</span> <span class="o">=</span> <span class="n">html_out</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;#x221e;&quot;</span><span class="p">,</span> <span class="s2">&quot;inf&quot;</span><span class="p">)</span>
    <span class="c1"># +/-</span>
    <span class="n">html_out</span> <span class="o">=</span> <span class="n">html_out</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;#177;&quot;</span><span class="p">,</span> <span class="s2">&quot;+/-&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">html_out</span></div>

<div class="viewcode-block" id="convertUnitToUTF8"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.convertUnitToUTF8">[docs]</a><span class="k">def</span> <span class="nf">convertUnitToUTF8</span><span class="p">(</span><span class="n">unit</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert ASCII unit display into UTF-8 symbol</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;1/A&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;sup&gt;-1&lt;/sup&gt;&quot;</span>
    <span class="k">elif</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;1/cm&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;cm&lt;sup&gt;-1&lt;/sup&gt;&quot;</span>
    <span class="k">elif</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;Ang&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
    <span class="k">elif</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;1e-6/Ang^2&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;10&lt;sup&gt;-6&lt;/sup&gt;/&lt;sup&gt;2&lt;/sup&gt;&quot;</span>
    <span class="k">elif</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;inf&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
    <span class="k">elif</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;-inf&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;-&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">unit</span></div>

<div class="viewcode-block" id="convertUnitToHTML"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.convertUnitToHTML">[docs]</a><span class="k">def</span> <span class="nf">convertUnitToHTML</span><span class="p">(</span><span class="n">unit</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert ASCII unit display into well rendering HTML</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;1/A&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&amp;#x212B;&lt;sup&gt;-1&lt;/sup&gt;&quot;</span>
    <span class="k">elif</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;1/cm&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;cm&lt;sup&gt;-1&lt;/sup&gt;&quot;</span>
    <span class="k">elif</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;Ang&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&amp;#x212B;&quot;</span>
    <span class="k">elif</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;1e-6/Ang^2&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;10&lt;sup&gt;-6&lt;/sup&gt;/&amp;#x212B;&lt;sup&gt;2&lt;/sup&gt;&quot;</span>
    <span class="k">elif</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;inf&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&amp;#x221e;&quot;</span>
    <span class="k">elif</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;-inf&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;-&amp;#x221e;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">unit</span></div>

<div class="viewcode-block" id="parseName"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.parseName">[docs]</a><span class="k">def</span> <span class="nf">parseName</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">expression</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    remove &quot;_&quot; in front of a name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">word</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">word</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">item</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">name</span></div>

<div class="viewcode-block" id="toDouble"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.toDouble">[docs]</a><span class="k">def</span> <span class="nf">toDouble</span><span class="p">(</span><span class="n">value_string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    toFloat conversion which cares deeply about user&#39;s locale</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Holy shit this escalated quickly in Qt5.</span>
    <span class="c1"># No more float() cast on general locales.</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QLocale</span><span class="p">()</span><span class="o">.</span><span class="n">toFloat</span><span class="p">(</span><span class="n">value_string</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Try generic locale</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QLocale</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QLocale</span><span class="p">(</span><span class="s1">&#39;en_US&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">toFloat</span><span class="p">(</span><span class="n">value_string</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span></div>

<div class="viewcode-block" id="findNextFilename"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.findNextFilename">[docs]</a><span class="k">def</span> <span class="nf">findNextFilename</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">directory</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Finds the next available (non-existing) name for &#39;filename&#39; in &#39;directory&#39;.</span>
<span class="sd">    plugin.py -&gt; plugin (n).py  - for first &#39;n&#39; for which the file doesn&#39;t exist</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">basename</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="c1"># limit the number of copies</span>
    <span class="n">MAX_FILENAMES</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="c1"># Start with (1)</span>
    <span class="n">number_ext</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">proposed_filename</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">found_filename</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># Find the next available filename or exit if too many copies</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">found_filename</span> <span class="ow">or</span> <span class="n">number_ext</span> <span class="o">&gt;</span> <span class="n">MAX_FILENAMES</span><span class="p">:</span>
        <span class="n">proposed_filename</span> <span class="o">=</span> <span class="n">basename</span> <span class="o">+</span> <span class="s2">&quot; (&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">number_ext</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;)&quot;</span> <span class="o">+</span> <span class="n">ext</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">proposed_filename</span><span class="p">)):</span>
            <span class="n">number_ext</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">found_filename</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">proposed_filename</span></div>


<div class="viewcode-block" id="DoubleValidator"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.DoubleValidator">[docs]</a><span class="k">class</span> <span class="nc">DoubleValidator</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDoubleValidator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Allow only dots as decimal separator</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="DoubleValidator.validate"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.DoubleValidator.validate">[docs]</a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return invalid for commas</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">input</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s1">&#39;,&#39;</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QValidator</span><span class="o">.</span><span class="n">Invalid</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">DoubleValidator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span></div>

<div class="viewcode-block" id="DoubleValidator.fixup"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.DoubleValidator.fixup">[docs]</a>    <span class="k">def</span> <span class="nf">fixup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Correct (remove) potential preexisting content</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DoubleValidator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">fixup</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
        <span class="nb">input</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="checkModel"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.checkModel">[docs]</a><span class="k">def</span> <span class="nf">checkModel</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check that the model save in file &#39;path&#39; can run.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># The following return needs to be removed once</span>
    <span class="c1"># the unittest related changes in Sasmodels are commited</span>
    <span class="c1"># return True</span>
    <span class="c1"># try running the model</span>
    <span class="kn">from</span> <span class="nn">sasmodels.sasview_model</span> <span class="kn">import</span> <span class="n">load_custom_model</span>
    <span class="n">Model</span> <span class="o">=</span> <span class="n">load_custom_model</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">()</span>
    <span class="n">q</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evalDistribution</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="n">qx</span><span class="p">,</span> <span class="n">qy</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evalDistribution</span><span class="p">([</span><span class="n">qx</span><span class="p">,</span> <span class="n">qy</span><span class="p">])</span>

    <span class="c1"># check the model&#39;s unit tests run</span>
    <span class="kn">from</span> <span class="nn">sasmodels.model_test</span> <span class="kn">import</span> <span class="n">run_one</span>
    <span class="c1"># TestSuite module in Qt5 now deletes tests in the suite after running,</span>
    <span class="c1"># so suite[0] in run_one() in sasmodels/model_test.py will contain [None] and</span>
    <span class="c1"># test.info.tests will raise.</span>
    <span class="c1"># Not sure how to change the behaviour here, most likely sasmodels will have to</span>
    <span class="c1"># be modified</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">run_one</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="saveData"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.saveData">[docs]</a><span class="k">def</span> <span class="nf">saveData</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    save content of data to fp (a .write()-supporting file-like object)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">add_type</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
        <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;__type__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">type</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">return</span> <span class="nb">dict</span>

    <span class="k">def</span> <span class="nf">jdefault</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        objects that can&#39;t otherwise be serialized need to be converted</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># tuples and sets (TODO: default JSONEncoder converts tuples to lists, create custom Encoder that preserves tuples)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">set</span><span class="p">)):</span>
            <span class="n">content</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="p">}</span>
            <span class="k">return</span> <span class="n">add_type</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>

        <span class="c1"># &quot;simple&quot; types</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="p">(</span><span class="n">Sample</span><span class="p">,</span> <span class="n">Source</span><span class="p">,</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">FResult</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">add_type</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>
        <span class="c1"># detector</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="p">(</span><span class="n">Detector</span><span class="p">,</span> <span class="n">Process</span><span class="p">,</span> <span class="n">TransmissionSpectrum</span><span class="p">,</span> <span class="n">Aperture</span><span class="p">,</span> <span class="n">Collimation</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">add_type</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="p">(</span><span class="n">Plottable</span><span class="p">,</span> <span class="n">View</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">add_type</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>

        <span class="c1"># SasviewModel - unique</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">SasviewModel</span><span class="p">):</span>
            <span class="c1"># don&#39;t store parent</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">add_type</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">SasviewModel</span><span class="p">)</span>

        <span class="c1"># DataState</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="p">(</span><span class="n">Data1D</span><span class="p">,</span> <span class="n">Data2D</span><span class="p">,</span> <span class="n">FitData1D</span><span class="p">,</span> <span class="n">FitData2D</span><span class="p">)):</span>
            <span class="c1"># don&#39;t store parent</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">add_type</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>

        <span class="c1"># ndarray</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">content</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span><span class="n">o</span><span class="o">.</span><span class="n">tolist</span><span class="p">()}</span>
            <span class="k">return</span> <span class="n">add_type</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">FunctionType</span><span class="p">):</span>
            <span class="c1"># we have a pure function</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">add_type</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>

        <span class="c1"># not supported</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;data cannot be serialized to json: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">jdefault</span><span class="p">)</span></div>

<div class="viewcode-block" id="readDataFromFile"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.readDataFromFile">[docs]</a><span class="k">def</span> <span class="nf">readDataFromFile</span><span class="p">(</span><span class="n">fp</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Reads in Data1D/Data2 datasets from the file.</span>
<span class="sd">    Datasets are stored in the JSON format.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">supported</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nb">tuple</span><span class="p">,</span> <span class="nb">set</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">FunctionType</span><span class="p">,</span>
        <span class="n">Sample</span><span class="p">,</span> <span class="n">Source</span><span class="p">,</span> <span class="n">Vector</span><span class="p">,</span>
        <span class="n">Plottable</span><span class="p">,</span> <span class="n">Data1D</span><span class="p">,</span> <span class="n">Data2D</span><span class="p">,</span> <span class="n">PlottableTheory1D</span><span class="p">,</span> <span class="n">PlottableFit1D</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="n">Chisq</span><span class="p">,</span> <span class="n">View</span><span class="p">,</span>
        <span class="n">Detector</span><span class="p">,</span> <span class="n">Process</span><span class="p">,</span> <span class="n">TransmissionSpectrum</span><span class="p">,</span> <span class="n">Collimation</span><span class="p">,</span> <span class="n">Aperture</span><span class="p">,</span>
        <span class="n">DataState</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">FResult</span><span class="p">,</span> <span class="n">FitData1D</span><span class="p">,</span> <span class="n">FitData2D</span><span class="p">,</span> <span class="n">SasviewModel</span><span class="p">]</span>

    <span class="n">lookup</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span> <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">supported</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">TooComplexException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">simple_type</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">Empty</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">generate</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">level</span><span class="p">))</span>

        <span class="c1"># create target object</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">Empty</span><span class="p">()</span>
        <span class="n">o</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">=</span> <span class="bp">cls</span>

        <span class="k">return</span> <span class="n">o</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">[</span><span class="nb">type</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;unknown type: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># tuples and sets</span>
        <span class="k">if</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">set</span><span class="p">):</span>
            <span class="c1"># convert list to tuple/set</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">generate</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="n">level</span><span class="p">))</span>

        <span class="c1"># &quot;simple&quot; types</span>
        <span class="k">if</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="p">(</span><span class="n">Sample</span><span class="p">,</span> <span class="n">Source</span><span class="p">,</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">FResult</span><span class="p">,</span> <span class="n">FitData1D</span><span class="p">,</span> <span class="n">FitData2D</span><span class="p">,</span>
                   <span class="n">SasviewModel</span><span class="p">,</span> <span class="n">Detector</span><span class="p">,</span> <span class="n">Process</span><span class="p">,</span> <span class="n">TransmissionSpectrum</span><span class="p">,</span>
                   <span class="n">Collimation</span><span class="p">,</span> <span class="n">Aperture</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">simple_type</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">Plottable</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">cls</span> <span class="o">==</span> <span class="n">View</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">simple_type</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>

        <span class="c1"># DataState</span>
        <span class="k">if</span> <span class="bp">cls</span> <span class="o">==</span> <span class="n">DataState</span><span class="p">:</span>
            <span class="n">o</span> <span class="o">=</span> <span class="n">simple_type</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
            <span class="n">o</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># TODO: set to ???</span>
            <span class="k">return</span> <span class="n">o</span>

        <span class="c1"># ndarray</span>
        <span class="k">if</span> <span class="bp">cls</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="n">o</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="c1"># new format - ndarray as ascii list</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># pre-5.0-release format - binary ndarray</span>
                <span class="n">buffer</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
                <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;latin-1&#39;</span><span class="p">))</span>
                <span class="n">buffer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>

        <span class="c1"># function</span>
        <span class="k">if</span> <span class="bp">cls</span> <span class="o">==</span> <span class="n">types</span><span class="o">.</span><span class="n">FunctionType</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;not implemented: </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="bp">cls</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;</span> <span class="mi">16</span><span class="p">:</span> <span class="c1"># recursion limit (arbitrary number)</span>
            <span class="k">raise</span> <span class="n">TooComplexException</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">type</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;__type__&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="c1"># if dictionary doesn&#39;t have __type__ then it is assumed to be just an ordinary dictionary</span>
                <span class="n">o</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">o</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">generate</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">o</span>

            <span class="k">return</span> <span class="n">construct</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">generate</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="n">new_stored_data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new_stored_data</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">generate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">TooComplexException</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;unable to load </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">id</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new_stored_data</span></div>

<div class="viewcode-block" id="readProjectFromSVS"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.readProjectFromSVS">[docs]</a><span class="k">def</span> <span class="nf">readProjectFromSVS</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read old SVS file and convert to the project dictionary</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">sas.sascalc.dataloader.readers.cansas_reader</span> <span class="kn">import</span> <span class="n">Reader</span> <span class="k">as</span> <span class="n">CansasReader</span>
    <span class="kn">from</span> <span class="nn">sas.sascalc.fit.pagestate</span> <span class="kn">import</span> <span class="n">Reader</span>

    <span class="n">loader</span> <span class="o">=</span> <span class="n">Loader</span><span class="p">()</span>
    <span class="n">loader</span><span class="o">.</span><span class="n">associate_file_reader</span><span class="p">(</span><span class="s1">&#39;.svs&#39;</span><span class="p">,</span> <span class="n">Reader</span><span class="p">)</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

    <span class="c1"># CRUFT: SasView 4.x uses a callback interface to register bits of state</span>
    <span class="n">state_svs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">def</span> <span class="nf">collector</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">datainfo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">state_svs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
    <span class="n">state_reader</span> <span class="o">=</span> <span class="n">Reader</span><span class="p">(</span><span class="n">call_back</span><span class="o">=</span><span class="n">collector</span><span class="p">)</span>
    <span class="n">data_svs</span> <span class="o">=</span> <span class="n">state_reader</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">state_svs</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">state_svs</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">[(</span><span class="n">temp</span><span class="p">,</span> <span class="n">state_svs</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">output</span></div>

<div class="viewcode-block" id="convertFromSVS"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.convertFromSVS">[docs]</a><span class="k">def</span> <span class="nf">convertFromSVS</span><span class="p">(</span><span class="n">datasets</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read in properties from SVS and convert into a simple dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">content</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">:</span>
        <span class="c1"># we already have data - interested only in properties</span>
        <span class="c1">#[[item_1, state_1], [item_2, state_2],...]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">content</span><span class="p">[</span><span class="n">params</span><span class="o">.</span><span class="n">data_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">content</span><span class="p">[</span><span class="n">params</span><span class="o">.</span><span class="n">data_id</span><span class="p">][</span><span class="s1">&#39;fit_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;checked&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span> <span class="p">[]]</span>
        <span class="n">param_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;fitpage_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">params</span><span class="o">.</span><span class="n">categorycombobox</span><span class="p">]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;fitpage_model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">params</span><span class="o">.</span><span class="n">formfactorcombobox</span><span class="p">]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;fitpage_structure&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">params</span><span class="o">.</span><span class="n">structurecombobox</span><span class="p">]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;2D_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">is_2D</span><span class="p">)]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;chainfit_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;False&quot;</span><span class="p">]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;data_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">params</span><span class="o">.</span><span class="n">data_id</span><span class="p">]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;data_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">params</span><span class="o">.</span><span class="n">data_name</span><span class="p">]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;is_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">is_data</span><span class="p">)]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;magnetic_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">magnetic_on</span><span class="p">)]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;model_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">params</span><span class="o">.</span><span class="n">formfactorcombobox</span><span class="p">]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;polydisperse_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">enable_disp</span><span class="p">)]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;q_range_max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">qmax</span><span class="p">)]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;q_range_min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">qmin</span><span class="p">)]</span>
        <span class="c1"># Smearing is a bit trickier. 4.x has multiple keywords,</span>
        <span class="c1"># one for each combobox option</span>
        <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">enable_smearer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">slit_smearer</span><span class="p">:</span>
                <span class="n">w</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">params</span><span class="o">.</span><span class="n">pinhole_smearer</span><span class="p">:</span>
                <span class="n">w</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">w</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;smearing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">w</span><span class="p">)]</span>
        <span class="c1"># weighting is also tricky. 4.x has multiple keywords,</span>
        <span class="c1"># one for each radio box.</span>
        <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">dI_noweight</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">params</span><span class="o">.</span><span class="n">dI_didata</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">elif</span> <span class="n">params</span><span class="o">.</span><span class="n">dI_sqrdata</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="k">elif</span> <span class="n">params</span><span class="o">.</span><span class="n">dI_idata</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;weighting&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">w</span><span class="p">)]</span>

        <span class="c1"># 4.x multi_factor is really the multiplicity</span>
        <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">multi_factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;multiplicity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">multi_factor</span><span class="p">))]</span>

        <span class="c1"># playing with titles</span>
        <span class="n">data</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">file</span>
        <span class="n">data</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">data_name</span>
        <span class="n">data</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">data_name</span>

        <span class="c1"># main parameters</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
            <span class="n">p_name</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">param_dict</span><span class="p">[</span><span class="n">p_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="p">[]]</span>
        <span class="c1"># orientation parameters</span>
        <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">is_2D</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">orientation_params</span><span class="p">:</span>
                <span class="n">p_name</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">p_min</span> <span class="o">=</span> <span class="s2">&quot;-360.0&quot;</span>
                <span class="n">p_max</span> <span class="o">=</span> <span class="s2">&quot;360.0&quot;</span>
                <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">p_min</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">p_max</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">param_dict</span><span class="p">[</span><span class="n">p_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="kc">None</span><span class="p">,</span> <span class="n">p_min</span><span class="p">,</span> <span class="n">p_max</span><span class="p">,</span> <span class="p">[]]</span>

        <span class="c1"># disperse parameters</span>
        <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">enable_disp</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">fittable_param</span><span class="p">:</span>
                <span class="n">p_name</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">p_opt</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">p_err</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>
                <span class="n">p_width</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">p_min</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">p_max</span> <span class="o">=</span> <span class="s2">&quot;inf&quot;</span>
                <span class="n">param_npts</span> <span class="o">=</span> <span class="n">p_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.width&#39;</span><span class="p">,</span><span class="s1">&#39;.npts&#39;</span><span class="p">)</span>
                <span class="n">param_nsigmas</span> <span class="o">=</span> <span class="n">p_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.width&#39;</span><span class="p">,</span> <span class="s1">&#39;.nsigmas&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">is_2D</span> <span class="ow">and</span> <span class="n">p_name</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">disp_obj_dict</span><span class="p">:</span>
                    <span class="n">lookup</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">orientation_params_disp</span>
                    <span class="n">p_min</span> <span class="o">=</span> <span class="s2">&quot;-360.0&quot;</span>
                    <span class="n">p_max</span> <span class="o">=</span> <span class="s2">&quot;360.0&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lookup</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">fixed_param</span>
                <span class="n">p_npts</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">lookup</span> <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">param_npts</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">p_nsigmas</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">lookup</span> <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">param_nsigmas</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">p_name</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">disp_obj_dict</span><span class="p">:</span>
                    <span class="n">p_disp</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">disp_obj_dict</span><span class="p">[</span><span class="n">p_name</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">p_disp</span> <span class="o">=</span> <span class="s2">&quot;gaussian&quot;</span>
                <span class="n">param_dict</span><span class="p">[</span><span class="n">p_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p_opt</span><span class="p">,</span> <span class="n">p_width</span><span class="p">,</span> <span class="n">p_min</span><span class="p">,</span> <span class="n">p_max</span><span class="p">,</span> <span class="n">p_npts</span><span class="p">,</span> <span class="n">p_nsigmas</span><span class="p">,</span> <span class="n">p_disp</span><span class="p">]</span>

        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;is_batch_fitting&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;False&#39;</span><span class="p">]</span>
        <span class="n">content</span><span class="p">[</span><span class="n">params</span><span class="o">.</span><span class="n">data_id</span><span class="p">][</span><span class="s1">&#39;fit_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_dict</span>

    <span class="k">return</span> <span class="n">content</span></div>

<div class="viewcode-block" id="enum"><a class="viewcode-back" href="../../../../dev/sasview-api/sas.qtgui.Utilities.html#sas.qtgui.Utilities.GuiUtils.enum">[docs]</a><span class="k">def</span> <span class="nf">enum</span><span class="p">(</span><span class="o">*</span><span class="n">sequential</span><span class="p">,</span> <span class="o">**</span><span class="n">named</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create an enumeration object from a list of strings&quot;&quot;&quot;</span>
    <span class="n">enums</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">sequential</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sequential</span><span class="p">))),</span> <span class="o">**</span><span class="n">named</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;Enum&#39;</span><span class="p">,</span> <span class="p">(),</span> <span class="n">enums</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">SasView 5.0.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../../sas.html" >sas</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, The SasView Project.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.4.
    </div>
  </body>
</html>